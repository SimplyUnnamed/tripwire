Object.sort=function(t,e){var n,r;do{for(var i in n=!1,r=null,t){if(r&&Number(t[i][e])<Number(t[r][e])){var o=t[i];t[i]=t[r],t[r]=o,n=!0}r=i}}while(n)},Object.index=function(t,e,n,r){for(var i in t){if(!r&&t[i][e]==n)return i;if(t[i][e]&&t[i][e].toLowerCase()==n.toLowerCase())return i}},Object.find=function(t,e,n,r){for(var i in t){if(!r&&t[i][e]==n)return t[i];if(t[i][e]&&t[i][e].toLowerCase()==n.toLowerCase())return t[i]}return!1},Object.maxTime=function(t,e){var n,r="";for(var i in t)(!n||n<new Date(t[i][e]))&&(n=new Date(t[i][e]),r=t[i][e]);return r},Object.size=function(t){var e,n=0;for(e in t)t.hasOwnProperty(e)&&n++;return n},Object.time=function(t){var e,n=[];for(e in t)n.push(new Date(t[e].time));return n.length?n.sort()[n.length-1].getTime()/1e3:0},function(t){t.fn.serializeObject=function(){var e=this,n={},r={},i={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(t,e,n){return t[e]=n,t},this.push_counter=function(t){return void 0===r[t]&&(r[t]=0),r[t]++},t.each(t(this).serializeArray(),function(){if(i.validate.test(this.name)){for(var r,o=this.name.match(i.key),a=this.value,u=this.name;void 0!==(r=o.pop());)u=u.replace(new RegExp("\\["+r+"\\]$"),""),r.match(i.push)?a=e.build([],e.push_counter(u),a):r.match(i.fixed)?a=e.build([],r,a):r.match(i.named)&&(a=e.build({},r,a));n=t.extend(!0,n,a)}}),n}}(jQuery);var numFormat=function(t){var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},letterToNumbers=function(t){t=t.toUpperCase();var e,n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=0;for(e=0;e<t.length;e++)r+=Math.pow(n.length,e)*(n.indexOf(t.substr(-1*(e+1),1))+1);return r},sigFormat=function(t,e){if(!t)return"";for(var n=/^[a-zA-Z]+$/,r=/^[0-9]+$/,i="type"==e?options.chain.typeFormat||"":options.chain.classFormat||"",o=0,a=i.length;o<a;o++)if(i[o].match(n)){if("B"==i[o].toUpperCase()&&"a"==t)return"";i=i[o]==i[o].toUpperCase()?i.substr(0,o)+t.toUpperCase()+i.substr(o+1,a):i.substr(0,o)+t+i.substr(o+1,a)}else if(i[o].match(r)){if(2==i[o]&&"a"==t)return"";i=i.substr(0,o)+letterToNumbers(t)+i.substr(o+1,a)}return i},isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};function positionRelativeTo(t,e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return{left:n.left-r.left+e.scrollLeft,top:n.top-r.top+e.scrollTop}}function lookupMultiple(t,e,n,r){const i=n.split(","),o=[];for(var a=0;a<i.length;a++){const n=i[a],u=t[n];if(!u){if(r)return;throw"Value "+n+" did not match anything in "+t}o.push(u[e])}return o.join(",")}function lookupByPropertyMultiple(t,e,n,r){const i=n.split(","),o=[];for(var a=0;a<i.length;a++){const n=i[a],u=Object.index(t,e,n);if(!u){if(r)return;throw"Value "+n+" did not match anything by property "+e+" in "+t}o.push(u)}return o.join(",")}var getCookie=function(t){var e=document.cookie,n=e.indexOf(" "+t+"=");if(-1==n&&(n=e.indexOf(t+"=")),-1==n)e=null;else{n=e.indexOf("=",n)+1;var r=e.indexOf(";",n);-1==r&&(r=e.length),e=unescape(e.substring(n,r))}return e},setCookie=function(t,e,n){var r=new Date;r.setDate(r.getDate()+n);var i=escape(e)+(null==n?"":"; expires="+r.toUTCString());document.cookie=t+"="+i+";"+("https:"==document.location.protocol?"secure;":"")};!function(t){var e=t.fn.addClass,n=t.fn.removeClass;t.fn.addClass=function(t){var n=e.apply(this,arguments);return this.trigger("classchange",t),n},t.fn.removeClass=function(t){var e=n.apply(this,arguments);return this.trigger("classchange",t),e}}(jQuery);var parseHeaders=function(t){var e=t.trim().split(/[\r\n]+/),n={};return e.forEach(function(t){var e=t.split(": "),r=e.shift(),i=e.join(": ");n[r]=i}),n};
var viewingSystem=$("meta[name=system]").attr("content"),viewingSystemID=$("meta[name=systemID]").attr("content"),server=$("meta[name=server]").attr("content"),app_name=$("meta[name=app_name]").attr("content"),version=$("meta[name=version]").attr("content");"true"==getCookie("loadedFromBrowserCache")&&$("#pageTime").html("Page is Cached");
var options=new function(){var t,i=["grid"],s=JSON.parse(localStorage.getItem("tripwire_options"));this.userID=init.userID,this.character={id:init.characterID,name:init.characterName},this.background=null,this.uiscale=1,this.favorites=[],this.grid={},this.tracking={active:"new"},this.masks={active:init.corporationID+".2"},this.chain={typeFormat:null,classFormat:null,gridlines:!0,active:0,tabs:[],"node-reference":"type",zoom:1,sigNameLocation:"name",routingLimit:15,routeSecurity:"shortest",routeIgnore:{enabled:!1,systems:["Tama","Rancer"]},renderer:"orgChart"},this.signatures={editType:"unknown",copySeparator:",",pasteLife:72,alignment:{sigID:"centerAlign",sigType:"centerAlign",sigAge:"centerAlign",leadsTo:"centerAlign",sigLife:"centerAlign",sigMass:"centerAlign"}},this.buttons={follow:!1,chainWidget:{viewing:!1,favorites:!1},signaturesWidget:{autoMapper:!1}},this.saveDelay=function(i){t&&clearTimeout(t),t=setTimeout("options.save()",i)},this.save=function(){var t=JSON.stringify(window.options.get());return localStorage.setItem("tripwire_options",t),$.ajax({url:"options.php",data:{mode:"set",options:t},type:"POST",dataType:"JSON"})},this.load=function(t){t&&void 0!==t?this.set(this,t):s&&this.set(this,s),this.apply()},this.get=function(){var t={};for(var i in this)"function"!=typeof this[i]&&(t[i]=this[i]);return t},this.set=function(t,i){for(var s in i)i[s]&&i[s].constructor&&i[s].constructor===Object?t&&this.set(t[s],i[s]):t&&void 0!==t[s]&&(t[s]=i[s])},this.reset=function(){for(var t in this)"function"!=typeof this[t]&&(this[t]=JSON.parse(JSON.stringify(this.reset.defaults[t])))},this.apply=function(){if(s)for(key in i)this[i[key]]=s[i[key]];if(this.grid.hasOwnProperty("oog")&&!isEmpty(this.grid.oog)?$.each(this.grid.oog,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}):isEmpty(this.grid)||$.each(this.grid,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}),this.favorites=$.map(this.favorites,function(t){return parseInt(t)}),this.buttons.follow&&$("#follow").addClass("active"),this.buttons.chainWidget.home&&$("#home").addClass("active"),this.buttons.chainWidget.kspace&&$("#k-space").addClass("active"),this.buttons.chainWidget.viewing&&$("#show-viewing").addClass("active"),this.buttons.chainWidget.favorites&&$("#show-favorite").addClass("active"),this.buttons.chainWidget.evescout&&$("#eve-scout").addClass("active"),-1!==$.inArray(parseInt(viewingSystemID),this.favorites)&&$("#system-favorite").attr("data-icon","star").addClass("active"),this.buttons.signaturesWidget.autoMapper&&$("#toggle-automapper").addClass("active"),this.uiscale&&$("body").css("zoom",this.uiscale),this.chain.zoom&&$("#chainParent").css("zoom",this.chain.zoom),this.background){var t=$("<a>",{href:this.background})[0];$("#wrapper").attr("style","background-image: url(https://"+t.hostname+t.pathname+t.search+");")}else $("#wrapper").attr("style","");for(var a in $("#dialog-options #characters").html("<img src='https://image.eveonline.com/Character/"+init.characterID+"_64.jpg' />"),$("#dialog-options input[name='mask']").filter("[value='"+this.masks.active+"']").attr("checked",!0),$("#chainTabs").html(""),this.chain.tabs)if(this.chain.tabs[a]){var e=$("#chainTab .tab").clone();e.attr("id",a).find(".name").data("tab",this.chain.tabs[a].systemID).html(this.chain.tabs[a].name),a==this.chain.active&&e.addClass("current"),$("#chainTabs").append(e)}"undefined"!=typeof tripwire&&chain.redraw()},this.reset.defaults=JSON.parse(JSON.stringify(this.get())),this.load(init&&init.options?init.options:null)};
var grid=$(".gridster ul").gridster({widget_selector:"li.gridWidget",avoid_overlapped_widgets:!1,widget_base_dimensions:[50,50],widget_margins:[5,5],autogrow_cols:!0,helper:"clone",draggable:{start:function(i,e){$("div.gridster").width($("div.gridster ul").width())}},resize:{enabled:!0,handle_class:"grid-resize",max_size:[30,30],min_size:[4,4],start:function(i){$("div.gridster").width($("div.gridster ul").width())},stop:function(i,e,s){switch(s.attr("id")){case"infoWidget":setTimeout("activity.redraw();",300)}}},serialize_params:function(i,e){return{id:i.attr("id"),col:e.col,row:e.row,size_x:e.size_x,size_y:e.size_y,width:i.width(),height:i.height()}}}).data("gridster").disable();grid.disable_resize(),$(".grid-resize").addClass("hidden").attr("data-icon","resize"),$(".gridster").css({visibility:"visible"}),$(".gridster > *").addClass("gridster-transition"),$("#layout").click(function(){$(this).hasClass("active")?(grid.disable(),grid.disable_resize(),$(".grid-resize").addClass("hidden"),$(this).removeClass("active"),options.grid=grid.serialize(),options.save()):(grid.enable(),grid.enable_resize(),$(".grid-resize").removeClass("hidden"),$(this).addClass("active"))});
var tripwire=new function(){this.timer,this.xhr,this.version=version,this.client={signatures:{},wormholes:{}},this.server={signatures:{},wormholes:{}},this.signatures={list:{},undo:JSON.parse(sessionStorage.getItem("tripwire_undo"))||{},redo:JSON.parse(sessionStorage.getItem("tripwire_redo"))||{}},this.serverSignatureCount=0,this.activity={},this.data={tracking:{},esi:{}},this.refreshRate=5e3,this.connected=!0,this.ageFormat="HM",this.instance=window.name?window.name:((new Date).getTime(),window.name=(new Date).getTime()/1e3),this.stop=function(){return clearTimeout(this.timer),this.timer},this.start=function(){return this.sync()},this.setAgeFormat=function(e){e=void 0!==e?e:this.ageFormat;return $("span[data-age]").each(function(){$(this).countdown("option",{format:e})}),!0},this.serverTime=function(){this.time,this.serverTime.getTime=function(){return tripwire.serverTime.time}},this.serverTime(),this.chainMap=function(){this.chainMap.parse=function(e){chain.draw(e)}},this.chainMap(),this.pastEOL=function(){var e={since:$(this).countdown("option","until"),format:"HM",layout:"-{hnn}{sep}{mnn}&nbsp;"};$(this).countdown("option",e)},this.whTooltip=function(e){if(viewingSystemID==e.systemID)if($.inArray(e.type,$.map(tripwire.wormholes,function(e,t){return t}))>=0)var t=e.type,i="";else i="<b>Type:</b> "+(t=e.sig2Type)+"<br/>";else if($.inArray(e.sig2Type,$.map(tripwire.wormholes,function(e,t){return t}))>=0)t=e.sig2Type,i="";else i="<b>Type:</b> "+(t=e.type)+"<br/>";if($.inArray(t,$.map(tripwire.wormholes,function(e,t){return t}))>=0)var s=!0;else s=!1;if(i+="<b>Life:</b> "+(s?tripwire.wormholes[t].life:"Unknown")+"<br/>",s)switch(tripwire.wormholes[t].leadsTo.split(" ")[0]){case"High-Sec":i+="<b>Leads To:</b> <span class='hisec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Low-Sec":i+="<b>Leads To:</b> <span class='lowsec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Null-Sec":i+="<b>Leads To:</b> <span class='nullsec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Class":i+="<b>Leads To:</b> <span class='wh'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;default:i+="<b>Leads To:</b> <span>"+tripwire.wormholes[t].leadsTo+"</span><br/>"}else i+="<b>Leads To:</b> <span>Unknown</span><br/>";return i+="<b>Max Mass</b>: "+(s?numFormat(tripwire.wormholes[t].mass):"Unknown")+" Kg<br/>",i+="<b>Max Jumpable</b>: "+(s?numFormat(tripwire.wormholes[t].jump):"Unknown")+" Kg<br/>"},this.ageTooltip=function(e){var t=new Date(e.lifeTime),i='<table class="age-tooltip-table"><tr><th>Created:</th><td>'+(t.getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td><td>"+e.createdByName.replace(/'/g,"&#39;").replace(/"/g,"&#34;")+"</td></tr>";return e.lifeTime!=e.modifiedTime&&(i+="<tr><th>Last Modified:</th><td>"+((t=new Date(e.modifiedTime)).getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td><td>"+e.modifiedByName.replace(/'/g,"&#39;").replace(/"/g,"&#34;")+"</td></tr>"),i+="</table>"},this.refresh=function(e,t,i,s){e=e||"refresh";this.sync(e,t,i,s)}};
$("body").on("click","a[href^='.?system=']",function(e){e.preventDefault();var t=$(this).attr("href").replace(".?system=",""),i=Object.index(tripwire.systems,"name",t);tripwire.systemChange(i)}),$("body").on("submit","#systemSearch",function(e){e.preventDefault();var t=$(this).find("[name='system']").val(),i=Object.index(tripwire.systems,"name",t,!0)||!1;!1!==i&&(tripwire.systemChange(i),$(this).find("[name='system']").val(""),$("#search").click())}),$("body").on("click","#undo:not(.disabled)",function(){tripwire.undo()}),$("body").on("click","#redo:not(.disabled)",function(){tripwire.redo()}),$("#chainParent").on("mousewheel",function(e){e.preventDefault();var t=parseFloat($("#chainParent").css("zoom"))||1;e.originalEvent.wheelDelta/120>0&&t<2?$("#chainParent").css("zoom",t+.1):e.originalEvent.wheelDelta/120<0&&t>.6&&$("#chainParent").css("zoom",t-.1),$("#chain-zoom-reset").fadeIn(200),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout('$("#chain-zoom-reset").fadeOut(200);',3e3),options.chain.zoom=parseFloat($("#chainParent").css("zoom")),options.saveDelay(2e3)}),$("#chain-zoom-reset").on("click",function(){$("#chainParent").css("zoom",1),options.chain.zoom=1,options.saveDelay(2e3)}),$(document).keydown(function(e){if(!$(document.activeElement).is("textarea, input"))if(e.metaKey||e.ctrlKey)if(89!==e.keyCode||$("#redo").hasClass("disabled"))if(90!==e.keyCode||$("#undo").hasClass("disabled")){if(65===e.keyCode)e.preventDefault(),$("#sigTable tbody tr").addClass("selected"),$("#signaturesWidget #delete-signature").trigger("delete:refresh");else if(67===e.keyCode&&""===window.getSelection().toString()){var t="";$("#sigTable tbody tr.selected").each(function(e){var i=tripwire.client.signatures[$(this).data("id")];e=[];if(i.signatureID?e.push(i.signatureID.substring(0,3).toUpperCase()+"-"+(i.signatureID.substring(3,6)||"###")):e.push("null"),e.push(i.type),"wormhole"===i.type){var a=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0],s=i.id==a.initialID?tripwire.client.signatures[a.secondaryID]:tripwire.client.signatures[a.initialID];e.push(a.type||"null"),e.push(tripwire.systems[i.systemID]?tripwire.systems[i.systemID].name:tripwire.aSigSystems[i.systemID]),e.push(tripwire.systems[s.systemID]?tripwire.systems[s.systemID].name:tripwire.aSigSystems[s.systemID]),e.push(a.life),e.push(a.mass)}else e.push(i.name);e.push(i.createdByName),e.push(i.lifeTime),e.push(i.lifeLength),e.push(i.lifeLeft),e.push(i.modifiedByName),e.push(i.modifiedTime),t+=e.join(options.signatures.copySeparator)+"\r\n"}),$("#clipboard").text(t),$("#clipboard").focus(),$("#clipboard").select()}}else e.preventDefault(),$("#undo").click(),Notify.trigger("Undoing last action");else e.preventDefault(),$("#redo").click(),Notify.trigger("Redoing last undo");else 46==e.keyCode&&$("#sigTable tr.selected").length>0&&$("#delete-signature").click()}),$("#follow").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.follow=$(this).hasClass("active"),options.save()}),$("#show-viewing").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.viewing=$(this).hasClass("active"),options.save()}),$("#show-favorite").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.favorites=$(this).hasClass("active"),options.save()}),$("#system-favorite").click(function(){$(this).hasClass("active")?($(this).removeClass("active").attr("data-icon","star-empty"),options.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)),1)):($(this).attr("data-icon","star").addClass("active"),options.favorites.push(parseInt(viewingSystemID))),$("#show-favorite").hasClass("active")&&chain.redraw(),options.save()}),$("#search").click(function(e){$("#searchSpan").toggle(),$(this).hasClass("active")?($(this).removeClass("active"),tripwire.client.EVE&&tripwire.client.EVE.systemName&&$("#currentSpan").show()):($(this).addClass("active"),$("#currentSpan").hide(),$("#searchSpan input[name=system]").focus().select())}),$("#toggle-automapper").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.signaturesWidget.autoMapper=$(this).hasClass("active"),options.save()}),$("#track").on("click",".tracking-clone",function(){var e=$(this).attr("data-characterid");$("#tracking .tracking-clone").removeClass("active"),options.tracking.active==e?(options.tracking.active=null,tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")):(options.tracking.active=e,tripwire.esi.characters[options.tracking.active]&&($("#tracking .tracking-clone[data-characterid='"+options.tracking.active+"']").addClass("active"),tripwire.EVE(tripwire.esi.characters[options.tracking.active],!0)),$("#removeESI").removeAttr("disabled")),options.save()}),$("#login").on("click","#removeESI",function(){var e=options.tracking.active;options.tracking.active=null,tripwire.EVE(!1,!0),options.save(),$("#tracking .tracking-clone[data-characterid='"+e+"']").remove(),$("#removeESI").attr("disabled","disabled"),$.isArray(tripwire.data.esi.delete)?tripwire.data.esiDelete.push(e):tripwire.data.esiDelete=[e]}),$("#user").click(function(e){e.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active"),$("#login > #panel").css({display:"none"})):($(this).addClass("active"),$("#login > #panel").css({display:"inline"}),$("#loginForm input[name=username]").focus().select(),$("#wrapper").click(function(e){$("#login > #panel").css({display:"none"}),$("#user").removeClass("active")}),$("#login").click(function(e){e.stopPropagation()}))}),$("#logout").click(function(){window.location="logout.php"});var Notify=new function(){this.trigger=function(e,t,i,a){t=void 0!==t?t:"blue",i=void 0!==i?i:1e4,a=void 0!==a?a:null;new jBox("Notice",{id:a,content:e,offset:{y:35},animation:"flip",color:t,autoClose:i})}},ValidationTooltips=new jBox("Tooltip",{trigger:null,addClass:"validation-tooltip",animation:"flip",fade:0}),Tooltips=new jBox("Tooltip",{attach:$("[data-tooltip]"),getContent:"data-tooltip",position:{x:"right",y:"center"},outside:"x"}),SystemActivityToolTips=new jBox("Tooltip",{getContent:"data-tooltip",position:{y:"bottom"},appendTo:$("#chainParent"),reposition:!0,repositionOnOpen:!0,createOnInit:!0,offset:{y:9,x:3},onOpen:function(){var e=positionRelativeTo(this.target[0],document.getElementById("chainParent")),t=(this.source.closest("[data-nodeid]").position(),this.source.closest(".nodeActivity").position(),this.source.closest("[data-nodeid]").height(),this.container.parent().width());this.options.position={x:e.left+3-t/2,y:e.top+this.target[0].offsetHeight}}}),WormholeRouteToolTips=new jBox("Tooltip",{getContent:"data-tooltip",position:{y:"bottom"},appendTo:$("#chainParent"),reposition:!0,repositionOnOpen:!0,createOnInit:!0,offset:{y:9,x:3},onOpen:function(){var e=positionRelativeTo(this.target[0],document.getElementById("chainParent")),t=(this.source.closest("[data-nodeid]").height(),this.container.parent().width());this.options.position={x:e.left+3-t/2,y:e.top+this.target[0].offsetHeight}}}),WormholeTypeToolTips=new jBox("Tooltip",{attach:$("#chainMap .whEffect[data-icon]"),getContent:"data-tooltip",position:{x:"left",y:"center"},appendTo:$("#chainParent"),outside:"x",adjustDistance:100,responsiveWidth:!1,reposition:!0,repositionOnOpen:!0,createOnInit:!0,offset:{y:9,x:3},onOpen:function(){var e=positionRelativeTo(this.target[0],document.getElementById("chainParent")),t=this.container.parent().width();this.options.position={x:e.left-t-10,y:e.top-3}}}),OccupiedToolTips=new jBox("Tooltip",{pointer:"top:-3",position:{x:"right",y:"center"},appendTo:$("#chainParent"),outside:"x",minWidth:100,animation:"move",adjustDistance:100,responsiveWidth:!1,reposition:!0,repositionOnOpen:!0,repositionOnContent:!0,createOnInit:!0,offset:{y:9,x:3},onOpen:function(){var e=this;var t=this.source.closest("[data-nodeid]").data("nodeid"),i=positionRelativeTo(this.target[0],document.getElementById("chainParent"));this.options.position={x:i.left+this.target[0].offsetWidth,y:i.top-3},e.setContent("&nbsp;"),$.ajax({url:"occupants.php",dataType:"JSON",data:"systemID="+t,cache:!1}).done(function(t){if(t&&t.occupants){var i="<table>";for(var a in t.occupants.sort(function(e,t){return e.characterName.toLowerCase()<t.characterName.toLowerCase()?-1:e.characterName.toLowerCase()>t.characterName.toLowerCase()?1:0}),t.occupants)i+="<tr><td>"+t.occupants[a].characterName+"</td><td style='padding-left: 10px;'>"+(t.occupants[a].shipTypeName?t.occupants[a].shipTypeName:"")+"</td></tr>";i+="</table>",e.setContent(i)}})}});function linkSig(e){return["Average Frontier Deposit","Unexceptional Frontier Deposit","Common Perimeter Deposit","Exceptional Core Deposit","Infrequent Core Deposit","Unusual Core Deposit","Rarified Core Deposit","Isolated Core Deposit","Ordinary Permiter Deposit","Uncommon Core Deposit","Barren Perimeter Reservoir","Minor Perimeter Reservoir","Ordinary Perimeter Reservoir","Sizeable Perimeter Reservoir","Token Perimeter Reservoir","Bountiful Frontier Reservoir","Vast Frontier Reservoir","Instrumental Core Reservoir","Vital Core Reservoir","Perimeter Ambush Point","Perimeter Camp","Phase Catalyst Node","The Line","Forgotten Perimeter Coronation Platform","Forgotten Perimeter Power Array","Unsecured Perimeter Amplifier","Unsecured Perimeter Information Center","Perimeter Checkpoint","Perimeter Hangar","The Ruins of Enclave Cohort 27","Sleeper Data Sanctuary","Forgotten Perimeter Gateway","Forgotten Perimeter Habitation Coils","Unsecured Perimeter Comms Relay","Unsecured Perimeter Transponder Farm","Fortification Frontier Stronghold","Outpost Frontier Stronghold","Solar Cell","The Oruze Construct","Forgotten Frontier Quarantine Outpost","Forgotten Frontier Recursive Depot","Unsecured Frontier Database","Unsecured Frontier Receiver","Frontier Barracks","Frontier Command Post","Integrated Terminus","Sleeper Information Sanctum","Forgotten Frontier Conversion Module","Forgotten Frontier Evacuation Center","Unsecured Frontier Digital Nexus","Unsecured Frontier Trinary Hub","Core Garrison","Core Stronghold","Oruze Osobnyk","Quarantine Area","Forgotten Core Data Field","Forgotten Core Information Pen","Unsecured Frontier Enclave Relay","Unsecured Frontier Server Bank","Core Citadel","Core Bastion","Strange Energy Readings","The Mirror","Forgotten Core Assembly Hall","Forgotten Core Circuitry Disassembler","Unsecured Core Backup Array","Unsecured Core Emergence"].indexOf(e)>-1?'<a href="http://eve-survival.org/wikka.php?wakka='+e.replace(/ /g,"")+'" target="_blank" class="siteLink">'+e+"</a>":e}$("#chainTabs").sortable({items:"> .tab",axis:"x",delay:150,tolerance:"pointer",containment:"parent",update:function(e,t){var i=$("#chainTabs").sortable("toArray"),a=[];for(var s in i)a.push(options.chain.tabs[i[s]]),$("#chainTabs .tab:eq("+s+")").attr("id",s);options.chain.active=$(".tab.current").index(),options.chain.tabs=a,options.save()}}),$("#chainTabs").on("click",".tab",function(e){e.preventDefault(),chain.setActiveTab($(this).hasClass("current")?null:$(this).index())}),$("#chainTabs").on("click",".closeTab",function(e){e.stopPropagation();var t=$(this).closest(".tab");$("#dialog-confirm #msg").html("This tab will be removed, are you sure?"),$("#dialog-confirm").dialog("option",{buttons:{"Remove Tab":function(){var e=t.index();options.chain.active=$(".tab.current").index(),options.chain.tabs.splice(e,1),options.save(),t.remove(),0==$("#chainTabs .tab.current").length&&$("#chainTabs .tab:last").click();for(var i=0,a=$("#chainTabs .tab").length;i<a;i++)$("#chainTabs .tab:eq("+i+")").attr("id",i);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#newTab").on("click",function(){$("#dialog-newTab").hasClass("ui-dialog-content")?$("#dialog-newTab").dialog("isOpen")||$("#dialog-newTab").dialog("open"):$("#dialog-newTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#newTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-newTab .name").val(viewingSystem).focus(),$("#dialog-newTab .sigSystemsAutocomplete").val(viewingSystem)},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-newTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#newTab_form").submit(function(e){e.preventDefault();var t=$("#chainTab .tab").clone(),i=$("#dialog-newTab .name").val(),a=lookupByPropertyMultiple(tripwire.systems,"name",$("#dialog-newTab .sigSystemsAutocomplete").val(),!0),s=!!$("#tabThera")[0].checked;return i?!a&&$("#tabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-newTab .sigSystemsAutocomplete")}).setContent("Must have valid systems (comma separated if multiple)!"),!1):($("#tabType2")[0].checked&&(a=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",a).html(i),options.chain.tabs.push({systemID:a,name:i,evescout:s}),options.save(),$("#chainTabs").append(t),void $("#dialog-newTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-newTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-newTab .sigSystemsAutocomplete").click(function(e){$("#dialog-newTab #tabType1").click()})}})}),$("#chainTabs").on("click",".editTab",function(e){e.stopPropagation(),$("#dialog-editTab").hasClass("ui-dialog-content")?$("#dialog-editTab").dialog("isOpen")||$("#dialog-editTab").dialog("open"):$("#dialog-editTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#editTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-editTab .name").val(options.chain.tabs[options.chain.active].name).focus(),$("#dialog-editTab .sigSystemsAutocomplete").val(0!=options.chain.tabs[options.chain.active].systemID?lookupMultiple(tripwire.systems,"name",options.chain.tabs[options.chain.active].systemID):""),0!=options.chain.tabs[options.chain.active].systemID?$("#dialog-editTab #editTabType1")[0].checked=!0:$("#dialog-editTab #editTabType2")[0].checked=!0,$("#dialog-editTab #editTabThera")[0].checked=options.chain.tabs[options.chain.active].evescout},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-editTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#editTab_form").submit(function(e){e.preventDefault();var t=$("#chainTabs .tab").eq([options.chain.active]),i=$("#dialog-editTab .name").val(),a=lookupByPropertyMultiple(tripwire.systems,"name",$("#dialog-editTab .sigSystemsAutocomplete").val(),!0),s=!!$("#editTabThera")[0].checked;return i?!a&&$("#editTabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-editTab .sigSystemsAutocomplete")}).setContent("Must have valid systems (comma separated if multiple)!"),!1):($("#editTabType2")[0].checked&&(a=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",a).html(i),options.chain.tabs[options.chain.active]={systemID:a,name:i,evescout:s},options.save(),chain.redraw(),tripwire.parse(tripwire.client,"refresh"),void $("#dialog-editTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-editTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-editTab .sigSystemsAutocomplete").click(function(e){$("#dialog-editTab #editTabType1").click()})}})}),$("#signaturesWidget #sigTable thead").contextmenu({delegate:"th.sortable",menu:"#signatureColumnMenu",position:function(e,t){return{my:"left top",at:"center",of:t.target}},select:function(e,t){var i=$(t.target).parent().parent().children().index($(t.target).parent())+1;switch(i){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}switch(t.cmd){case"leftAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+i+")").removeClass("centerAlign rightAlign").addClass("leftAlign"),options.signatures.alignment[colName]="leftAlign";break;case"centerAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+i+")").removeClass("leftAlign rightAlign").addClass("centerAlign"),options.signatures.alignment[colName]="centerAlign";break;case"rightAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+i+")").removeClass("centerAlign leftAlign").addClass("rightAlign"),options.signatures.alignment[colName]="rightAlign"}options.save()},beforeOpen:function(e,t){switch($(t.target).parent().parent().children().index($(t.target).parent())+1){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}$(this).contextmenu("enableEntry","leftAlign",!0),$(this).contextmenu("enableEntry","centerAlign",!0),$(this).contextmenu("enableEntry","rightAlign",!0),$(this).contextmenu("enableEntry",options.signatures.alignment[colName],!1)}}),$("#chainParent").contextmenu({appendTo:"#chainParent",delegate:".nodeSystem a",position:function(e,t){return{my:"left top-1",at:"right top",of:t.target}},menu:"#chainMenu",show:{effect:"slideDown",duration:150},select:function(e,t){const i=$(t.target[0]).closest("[data-nodeid]");var a=i.data("nodeid");i.attr("id").replace("node","");switch(t.cmd){case"showInfo":tripwire.esi.showInfo(a,options.tracking.active);break;case"setDest":tripwire.esi.setDestination(a,options.tracking.active,!0);break;case"addWay":tripwire.esi.setDestination(a,options.tracking.active,!1);break;case"showMap":break;case"red":i.hasClass("redNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"yellow":i.hasClass("yellowNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"green":i.hasClass("greenNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"mass":$("#dialog-mass").data("id",i.data("sigid")).data("systemID",a).dialog("open");break;case"ping":$("#dialog-ping").data("id",i.data("sigid")||null).data("systemID",a).dialog("open");break;case"collapse":var s=!options.chain.tabs[options.chain.active]||-1==$.inArray(a,options.chain.tabs[options.chain.active].collapsed);chain.renderer.collapse(a,s);break;case"makeTab":const e=Object.index(options.chain.tabs,"systemID",""+a,!1);if(void 0!==e)chain.setActiveTab(e);else{const e=tripwire.systems[a].name;options.chain.tabs.push({systemID:""+a,name:e});var o=$("#chainTab .tab").clone();o.attr("id",options.chain.tabs.length-1).find(".name").data("tab",a).html(e),$("#chainTabs").append(o),chain.setActiveTab(options.chain.tabs.length-1)}}},beforeOpen:function(e,t){var i=$(t.target[0]).closest("[data-nodeid]").data("sigid")||null,a=$(t.target[0]).closest("[data-nodeid]").data("nodeid");tripwire.systems[a].class||!tripwire.esi.characters[options.tracking.active]?($(this).contextmenu("enableEntry","setDest",!1),$(this).contextmenu("enableEntry","addWay",!1),$(this).contextmenu("enableEntry","showMap",!1)):($(this).contextmenu("enableEntry","setDest",!0),$(this).contextmenu("enableEntry","addWay",!0),$(this).contextmenu("enableEntry","showMap",!1)),i?$(this).contextmenu("enableEntry","mass",!0):$(this).contextmenu("enableEntry","mass",!1);const s=Object.find(options.chain.tabs,"systemID",""+a,!1);$("#makeTabMenuItem").text(s?"View Tab":"Make Tab")},create:function(e,t){$(this).find(".ui-front").css("width","10em"),$(this).find(".ui-front").css("position",""),$("#dialog-mass").dialog({autoOpen:!1,width:"auto",height:"auto",dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Close:function(){$(this).dialog("close")}},open:function(){var e=$(this).data("id"),t=$(this).data("systemID"),i=tripwire.client.wormholes[e],a=tripwire.client.signatures[i.initialID],s=tripwire.client.signatures[i.secondaryID];$("#dialog-mass").dialog("option","title","From "+tripwire.systems[a.systemID].name+" to "+tripwire.systems[s.systemID].name),$("#dialog-mass #massTable tbody tr").remove();var o={wormholeID:i.id};$.ajax({url:"mass.php",type:"POST",data:o,dataType:"JSON"}).done(function(e){if(e&&e.mass){var i=0;for(x in e.mass)i+=parseFloat(e.mass[x].mass),$("#dialog-mass #massTable tbody").append("<tr><td>"+e.mass[x].characterName+"</td><td>"+(e.mass[x].toID==t?"In":"Out")+"</td><td>"+e.mass[x].shipType+"</td><td>"+numFormat(e.mass[x].mass)+"Kg</td><td>"+e.mass[x].time+"</td></tr>");$("#dialog-mass #massTable tbody").append("<tr><td></td><td></td><td></td><th>"+numFormat(i)+"Kg</th><td></td></tr>")}})}}),$.moogle.contextmenu.prototype.setFlare=function(e,t,i){var a={systemID:e,flare:t};$.ajax({url:"flares.php",type:"POST",data:a,dataType:"JSON"}).done(function(i){i&&i.result&&(chain.data.flares.flares.push({systemID:e,flare:t,time:null}),chain.flares(chain.data.flares))})},$.moogle.contextmenu.prototype.removeFlare=function(e,t){var i={systemID:e};$.ajax({url:"flares.php",type:"POST",data:i,dataType:"JSON"}).done(function(t){t&&t.result&&(chain.data.flares.flares.splice(Object.index(chain.data.flares.flares,"systemID",e),1),chain.flares(chain.data.flares))})}}}),$.widget("custom.inlinecomplete",$.ui.autocomplete,{_create:function(){return this.element.is("input")||this._selectInit(),this._super()},_value:function(){var e=this._superApply(arguments);return this.element.change(),e},_suggest:function(e){return this._super(e)},_initSource:function(){if(!$.isArray(this.options.source))return this._super();this.source=function(e,t){for(var i=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term),"i"),a=new Array,s=this.options.source,o=this.options.maxSize||25,n=0,r=s.length;n<r&&!(i.test(s[n])&&(a.push(s[n]),o&&a.length>o));n++);t(a)}},_close:function(e){return this.options.source=this.options.input_source?this.options.input_source:this.options.source,this._super(e)},addToSelect:function(e){this.options.select_added_value=e,this.options.select_source.unshift(e)},removeFromSelect:function(e){e?this.options.select_source.splice(e,1):this.options.select_added_value&&this.options.select_source.splice(this.options.select_added_value,1),this.options.select_added_value=null},_selectInit:function(){this.element.addClass("custom-combobox"),this.wrapper=this.element,this.element=this.wrapper.find("input:first"),this.select=this.wrapper.find("select:first").remove(),this.options.input_source=this.options.source,this.options.select_source=this.select.children("option[value!='']").map(function(){return $.trim(this.text)}).toArray(),this._createShowAllButton()},_createShowAllButton:function(){var e=this,t=!1;$("<a>").attr("tabIndex",e.element.prop("tabindex")).attr("title","").appendTo(e.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").on("mousedown",function(){t=e.widget().is(":visible")}).on("click",function(){e.element.trigger("focus"),t||(e.options.source=e.options.select_source,e._search(""))})}}),$("#sigTable").tablesorter({sortReset:!0,widgets:["saveSort"],textExtraction:{2:function(e){return $(e).find("span").data("age")}}}),$("#sigTable tbody").on("click","tr",function(e){e.metaKey||e.ctrlKey?$(this).toggleClass("selected"):e.shiftKey?($(this).addClass("selected"),$("#sigTable tbody tr.selected:first").nextUntil("#sigTable tbody tr.selected:last").addBack().add("#sigTable tbody tr.selected:last").addClass("selected")):($("#sigTable tbody tr.selected").removeClass("selected"),$(this).addClass("selected"))}),$(document).click(function(e){$(e.target).closest("#sigTable tbody").length||$(e.target).closest("#edit-signature").length||$(e.target).closest("#delete-signature").length||$("#sigTable tbody tr.selected").removeClass("selected")}),$("#sigTable tbody").on("classchange","tr",function(e,t){"selected"===t&&$("#signaturesWidget").trigger("selected:change")}),$("#signaturesWidget").on("selected:change",function(){0===$("#sigTable tr.selected").length?$("#signaturesWidget #delete-signature").addClass("disabled"):$("#signaturesWidget #delete-signature").removeClass("disabled"),1===$("#sigTable tr.selected").length?$("#signaturesWidget #edit-signature").removeClass("disabled"):$("#signaturesWidget #edit-signature").addClass("disabled")}),$("#dialog-error").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}},create:function(){$(this).dialog("option","show",{effect:"shake",duration:150,easing:"easeOutElastic"})}}),$("#dialog-msg").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}}}),$("#dialog-confirm").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Cancel:function(){$(this).dialog("close")}}}),-1!=window.location.href.indexOf("galileo")&&Notify.trigger("This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>");
const systemAnalysis=new function(){const s=[];this.addMutator=function(t){s.push(t)},this.analyse=function(t,e){if(e||(e=tripwire.systems[t]),!e)return e;const c=Object.assign({},e);return c.baseSecurity=1*e.security,c.pathSymbol="■",c.systemTypeModifiers=[],s.forEach(function(s){s.mutate(c,t)}),c.systemTypeClass=c.class?"wh class-"+c.class:500026==c.factionID?"triglavian":c.security>=.45?"hisec":c.security>0?"lowsec":c.security<=0?"nullsec":"unknown",c.systemTypeName=c.class?"C"+c.class:500026==c.factionID?"Trig":c.baseSecurity>=.45?"HS":c.baseSecurity>0?"LS":c.baseSecurity<=0?"NS":" ",c}};
var guidance=function(t){var r=function(t){var r=[];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.push(e);return r},e=function(t,r){return parseFloat(t)-parseFloat(r)};function n(t,r){if(!(r=systemAnalysis.analyse(3e7+1*r)))return t;switch(options.chain.routeIgnore.enabled&&options.chain.routeIgnore.systems.indexOf(r.name)>=0&&(t+=100),options.chain.routeSecurity){case"highsec":return t+(r.security<.45?100:0);case"avoid-high":return t+(r.security>=.45?100:0);case"avoid-null":return t+(r.security<=0?100:0);default:return t}}var o=function(t,o,a,i){i=i||1/0;var u,s={},c={0:[o]},h={},l=function(t,r){var e=""+t;c[e]||(c[e]=[]),c[e].push(r)};for(s[o]=0;c&&!s[a]&&(u=r(c)).length;){u.sort(e);var p=u[0],f=c[p],y=f.shift(),v=parseFloat(p),g=t[y]||{};for(var d in f.length||delete c[p],g)if(Object.prototype.hasOwnProperty.call(g,d)){var b=n(g[d],d)+v,m=s[d];(void 0===m||m>b)&&(s[d]=b,l(b,d),h[d]=y)}}return void 0===s[a]?null:h},a=function(t,r){for(var e=[],n=r;n;)e.push(n),predecessor=t[n],n=t[n];return e.reverse(),e},i=function(t,r){for(var e,n,i,u=r.shift(),s=[];r.length;){if(e=r.shift(),!(n=o(t,u,e)))return null;if(i=a(n,e),!r.length)return s.concat(i);s.push.apply(s,i.slice(0,-1)),u=e}},u=function(t,r){try{return Array.prototype.slice.call(t,r)}catch(a){for(var e=[],n=r||0,o=t.length;n<o;++n)e.push(t[n]);return e}},s=function(t){this.map=t};return s.prototype.findShortestPath=function(t,r){return"[object Array]"===Object.prototype.toString.call(t)?i(this.map,t):2===arguments.length?i(this.map,[t,r]):i(this.map,u(arguments))},s.findShortestPath=function(t,r,e){return"[object Array]"===Object.prototype.toString.call(r)?i(t,r):3===arguments.length?i(t,[r,e]):i(t,u(arguments,1))},s}();
const thera=new _TheraConnection;function _TheraConnection(){const e=this;this.links=[],this.active=function(){return options.chain.tabs[options.chain.active]&&options.chain.tabs[options.chain.active].evescout},this.nodeNameSuffix="eve-scout-thera",this.findLinks=function(t,n){if(!e.active())return;const i=[];for(var s=0;s<this.links.length;s++){const e=this.links[s],o="T-"+e.id,a={life:e.wormholeEol,mass:e.wormholeMass,id:o};e.solarSystemId==t?i.push(Object.assign({parent:{id:n.parentID,systemID:t,signatureID:e.wormholeDestinationSignatureId,type:e.sourceWormholeType.name},child:{id:n.nextChildID++,systemID:e.wormholeDestinationSolarSystemId,signatureID:e.signatureId,type:e.destinationWormholeType.name}},a)):e.wormholeDestinationSolarSystemId==t&&i.push(Object.assign({parent:{id:n.parentID,systemID:t,signatureID:e.signatureId,type:e.destinationWormholeType.name},child:{id:n.nextChildID++,systemID:e.solarSystemId,signatureID:e.wormholeDestinationSignatureId,type:e.sourceWormholeType.name}},a))}return i},this.refresh=function(){e.active()&&$.ajax({url:`https://api.allorigins.win/get?url=${encodeURIComponent("https://www.eve-scout.com/api/wormholes")}`,type:"GET",dataType:"JSON"}).done(function(t,n,i){const s=JSON.parse(t.contents);_.isEqual(s,e.links)||(console.info("Updating map for Thera update"),e.links=s,chain.redraw())}).fail(function(e,t,n){console.warn("Failed to fetch Thera from eve-scout.com: "+t,n)})},setInterval(this.refresh,6e4),this.refresh()}
const ChainMapRendererOrgchart=function(t){const n=this;this.init=function(){n.map=new google.visualization.OrgChart(document.getElementById("chainMap")),n.options={allowHtml:!0,allowCollapse:!0,size:"medium",nodeClass:"node"},google.visualization.events.addListener(n.map,"collapse",n.collapseHandler),n.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}]})),n.options)},this.ready=function(){return!this.drawing&&!!this.map},this.switchTo=function(){document.getElementById("chainGrid").style.display="",n.map||google.charts.setOnLoadCallback(this.init)},this.switchFrom=function(){document.getElementById("chainGrid").style.display="none",n.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}]})),n.options)},this.draw=function(t,n,a){for(var o in this.drawing=!0,this.map.draw(i(t),this.options),a){const t=a[o],n=$("#chainMap [data-nodeid='"+t+"']").attr("id");if(n){const t=n.split("node")[1];this.map.collapse(t-1,!0)}}e(t,n),this.drawing=!1};const i=function(t){return new google.visualization.DataView(new google.visualization.DataTable(t))},e=function(t,i){function e(n,i,e,a){function o(t,n){return r(t,n,function(t,n){t.addClass(n)})}function l(t,n){return r(t,n,function(t,n){t.removeClass(n)})}function r(t,n,i){return(n=n||[]).push(""),n.forEach(function(n){e.forEach(function(e){i(t,(n.length?n+"-":"")+e)})}),t}"string"==typeof e&&(e=[e]);var s=$("#chainMap #node"+n).parent();if(0==s.length)return!1;var c=Math.ceil((s[0].cellIndex+1)/2-1),d=o($(s.parent().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[c]),["left","right"]),h=$("#chainMap #node"+i).parent();if(0==h.length||0==d.length)return!1;var p=0,g=d[0].cellIndex;s.parent().prev().find("td").each(function(t){if(p+=this.colSpan,t==g)return!1});for(var u=Math.ceil((h[0].cellIndex+1)/2-1),f=u,v=0;v<=u;v++){var m=0;s.parent().prev().prev().prev().find("td > [data-nodeid]").each(function(t){if(t==v)return m=$(this).attr("id").replace("node",""),!1}),$.map(t.rows,function(t){return t.c[1].v==m?t:null}).length<=0&&f--}u=f;var w=o($(s.parent().prev().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[u]),["left","right"]),y=0,z=(i=!1,!1);s.parent().prev().prev().find("td").each(function(t,n){if(y+=this.colSpan,z&&i)return!1;if(void 0!==w[0]&&w[0].cellIndex==t){if(i=!0,o($(this),["left"]),z||y==p||o($(this),["bottom"]),p==y)return!1}else if(y==p)z=!0,o($(this),["bottom"]);else if(z||i){var e=0,a=!1,r=!1;if(s.parent().prev().find("td").each(function(t){if((e+=this.colSpan)==y&&($(this).hasClass("google-visualization-orgchart-lineleft")||$(this).hasClass("google-visualization-orgchart-lineright"))){if(0==i)return a=!0,l(w,["left","right"]),!1;1==i&&(l(w,["left","right"]),s.parent().prev().prev().find("td").each(function(t){t>=w[0].cellIndex&&l($(this),["bottom"])}),r=!0)}}),a)return!1;r||o($(this),["bottom"])}})}for(var a in n.lastLineData={map:t,lines:i},i)e(i[a][0],i[a][1],i[a][2],i[a][3])};this.collapseHandler=function(){if(n.drawing)return;const i=n.map.getCollapsedNodes(),a=[];for(x in i){var o=$("#chainMap #node"+(i[x]+1)).data("nodeid");a.push(o)}t.updateCollapsed(a),n.lastLineData&&e(n.lastLineData.map,n.lastLineData.lines)}};
const ChainMapRendererRadial=function(t){this.ready=function(){return!this.drawing},this.switchTo=function(){if(!document.getElementById("map-container")){const t=document.createElement("div");t.id="map-container",t.className="radial-map",document.getElementById("chainMap").appendChild(t)}this.container=document.getElementById("map-container"),this.container.style.display=""},this.switchFrom=function(){const t=document.getElementById("map-container");t&&t.parentNode.removeChild(t),this.container=null},this.collapse=function(n,e){e?this.mapData.collapsed.push(n):this.mapData.collapsed=this.mapData.collapsed.filter(t=>t!=n),t.updateCollapsed(this.mapData.collapsed),i(this.mapData.map,this.mapData.lines,this.mapData.collapsed)},this.draw=function(t,n,e){this.drawing=!0,this.mapData={map:t,lines:n,collapsed:e};try{i(t,n,e)}finally{this.drawing=!1}};const n={x:70,y:60,first_ring_delta:.3,ringX:function(t){return 0==t?0:(t+this.first_ring_delta)*this.x},ringY:function(t){return 0==t?0:(t+this.first_ring_delta)*this.y}},e=this,i=function(t,i,r){const c=[],d={};for(var l=0;l<t.rows.length;l++){const n=t.rows[l],e=n.c[0],o=e.v,s=n.c[1].v,a={id:o,children:[],systemID:e.systemID,minArc:0};if(null==s){const t={circles:[{arc:0,nodes:[a]}]};a.map=t,a.circle=0,c.push(t)}else{const t=d[s];if(!t)throw"Parent id "+s+" not on map yet";t.children.push(a),a.parent=t,a.connection=i.filter(function(t){return t[0]==o})[0]||[o,s,[],"?"],a.connection[2].unshift("connection"),a.map=t.map,a.circle=t.circle+1,a.map.circles.length<=a.circle?a.map.circles.push({arc:0,nodes:[a]}):a.map.circles[a.circle].nodes.push(a)}d[o]=a,a.markup=e.f}for(var p=0;p<c.length;p++){const t=c[p];for(var h=t.circles.length-1;h>=1;h--)for(var m=0;m<t.circles[h].nodes.length;m++){const n=t.circles[h].nodes[m];n.minArc*=h/(h+1),(n.minArc<1||r.indexOf(1*n.systemID)>=0)&&(n.minArc=1),n.parent.minArc+=n.minArc,t.circles[h].arc+=n.minArc}}for(p=0;p<c.length;p++){const t=c[p];var y=document.getElementById("map"+p);y||((y=document.createElement("div")).id="map"+p,y.className="map-chain-wrapper"),y.innerHTML='<div class="map-outer-container"><div class="map-inner-container"><canvas class="map-drawing" id="map-canvas-'+p+'"/></div></div>';const n=y.firstChild.firstChild;document.getElementById("map-container").appendChild(y),t.bounds=o(n,0,t.circles[0].nodes,0,2*Math.PI,r),t.domNode=y,t.innerContainer=n}for(p=0;p<c.length;p++){const t=c[p],i={w:200+t.bounds.x[1]-t.bounds.x[0],h:100+t.bounds.y[1]-t.bounds.y[0],cx:100-t.bounds.x[0],cy:50-t.bounds.y[0]};if(1==c.length){const t=-38+e.container.offsetWidth;i.w<t&&(i.cx+=.5*(t-i.w),i.w=t)}const o=document.getElementById("chainParent").offsetHeight;i.h<o&&(i.cy+=.5*(o-i.h),i.h=o),i.h>=2*(t.bounds.y[1]>-t.bounds.y[0]?t.bounds.y[1]:-t.bounds.y[0])&&(i.cy=i.h/2),i.w>=2*(t.bounds.x[1]>-t.bounds.x[0]?t.bounds.x[1]:-t.bounds.x[0])&&(i.cx=i.w/2),t.domNode.style.width=i.w+"px",t.domNode.style.height=i.h+"px";const r=t.domNode.firstChild;r.style.left=i.cx+"px",r.style.top=i.cy+"px";const d=r.getElementsByTagName("canvas")[0];d.width=1*i.w,d.style.width=i.w+"px",d.height=1*i.h,d.style.height=i.h+"px",d.style.left=-i.cx+"px",d.style.top=-i.cy+"px";const l=d.getContext("2d");l.scale(1,1),l.translate(i.cx,i.cy);for(h=t.bounds.maxCi;h>=1;h--)if(options.chain.gridlines&&(l.beginPath(),l.ellipse&&(l.lineWidth=.5,l.setLineDash([]),l.ellipse(0,0,n.ringX(h),n.ringY(h),0,0,2*Math.PI)),l.strokeStyle=a("grid-default","color"),l.stroke()),!(h>=t.circles.length))for(m=0;m<t.circles[h].nodes.length;m++){const n=t.circles[h].nodes[m];if(!n.position)continue;l.beginPath(),l.lineWidth=n.connection[2].reduce(function(t,n){return"frig"==n?1:t},3),l.moveTo(n.position.x,n.position.y);const e=s({r:n.radPosition.r-.5,theta:(n.radPosition.theta+2*n.parent.radPosition.theta)/3}),i=s({r:n.radPosition.r-.5,theta:(2*n.radPosition.theta+n.parent.radPosition.theta)/3});h>1?l.bezierCurveTo(i.x,i.y,e.x,e.y,n.parent.position.x,n.parent.position.y):l.lineTo(n.parent.position.x,n.parent.position.y);n.position.y,n.parent.position;l.strokeStyle=a(n.connection[2],"border-top-color"),l.setLineDash({dashed:[3,2]}[a(n.connection[2],"border-top-style")]||[]),l.stroke()}}for(p=c.length;;p++){const t=document.getElementById("map"+p);if(!t)break;t.parentNode.removeChild(t)}};function o(t,n,i,a,r,c){const d={x:[0,0],y:[0,0],maxCi:n};if(!i.length)return d;const l=c.indexOf(1*(i[0].parent||{}).systemID)>=0;if(n>0&&!l)for(var p=0;++p<2&&i.length>1.4*n*(r-a);)n++;const h=(r-a)/(l?i.length:i.reduce(function(t,n){return t+n.minArc},0));for(var m=a,y=0,u=0;u<i.length;u++){const a=i[u],r=document.createRange().createContextualFragment('<div class="node-wrapper">'+a.markup+"</div>");a.domNode=r.firstChild,t.appendChild(a.domNode);const p=1*a.systemID;$(a.domNode).dblclick(()=>e.collapse(p,c.indexOf(p)<0));const x=(l?1:a.minArc)*h,f=m+x/2;if(1==n&&0==u&&(y-=f),a.radPosition={r:n,theta:f+y},a.position=s(a.radPosition),a.position.x<d.x[0]&&(d.x[0]=a.position.x),a.position.x>d.x[1]&&(d.x[1]=a.position.x),a.position.y<d.y[0]&&(d.y[0]=a.position.y),a.position.y>d.y[1]&&(d.y[1]=a.position.y),a.domNode.style.left=a.position.x+"px",a.domNode.style.top=a.position.y+"px",l)a.domNode.style.display="none";else{const e=n>0&&x>a.minArc*n?x-a.minArc*n:0;if(a.children.length){const i=o(t,n+1,a.children,m+.5*e+y,m-.5*e+y+x,c);i.x[0]<d.x[0]&&(d.x[0]=i.x[0]),i.x[1]>d.x[1]&&(d.x[1]=i.x[1]),i.y[0]<d.y[0]&&(d.y[0]=i.y[0]),i.y[1]>d.y[1]&&(d.y[1]=i.y[1]),i.maxCi>d.maxCi&&(d.maxCi=i.maxCi)}}m+=x}return d}function s(t){return{x:n.ringX(t.r)*Math.sin(t.theta),y:n.ringY(t.r)*Math.cos(t.theta)}}function a(t,n){Array.isArray(t)&&(t=t.join(" "));var e=document.getElementById("temp-div-"+t);return e||((e=document.createElement("div")).id="temp-div-"+t,e.style.cssText="position:fixed;left:-100px;top:-100px;width:1px;height:1px",e.className=t+" temp",document.body.appendChild(e)),getComputedStyle(e).getPropertyValue(n)}};
var chain=new function(){var e=this;this.map,this.view,this.drawing,this.data={},thirdPartySuppliers=[thera];const s={orgChart:new ChainMapRendererOrgchart(this),radial:new ChainMapRendererRadial(this)};this.renderer=s[options.chain.renderer],this.renderer.switchTo(),this.useRenderer=function(e){if(!s[e])throw"Unknown renderer "+e;this.renderer!=s[e]&&(this.renderer.switchFrom(),this.renderer=s[e],this.renderer.switchTo(),this.redraw())},this.activity=function(e){for(var s=0,i=(t=document.querySelectorAll("#chainMap .nodeActivity span")).length;s<i;++s)t[s].className=t[s].className+" invisible";var t;for(s=0,i=(t=document.querySelectorAll("#chainMap [data-nodeid]")).length;s<i;++s){var a=t[s].getAttribute("data-nodeid");if(e[a]){var n=e[a].shipJumps,r=e[a].podKills,l=e[a].shipKills,c=e[a].npcKills,o=t[s].getElementsByClassName("nodeActivity")[0];if(n>0){var d=o.getElementsByClassName("jumps")[0];d.className=d.className.replace(/invisible/g,""),d.setAttribute("data-tooltip",n+" Jumps")}if(r>0){var p=o.getElementsByClassName("pods")[0];p.className=p.className.replace(/invisible/g,""),p.setAttribute("data-tooltip",r+" Pod Kills")}if(l>0){var h=o.getElementsByClassName("ships")[0];h.className=h.className.replace(/invisible/g,""),h.setAttribute("data-tooltip",l+" Ship Kills")}if(c>0){var m=o.getElementsByClassName("npcs")[0];m.className=m.className.replace(/invisible/g,""),m.setAttribute("data-tooltip",c+" NPC Kills")}}}return SystemActivityToolTips.attachedElements&&SystemActivityToolTips.attachedElements.length>0&&SystemActivityToolTips.detach($("#chainMap .whEffect")),SystemActivityToolTips.attach($("#chainMap .nodeActivity > span[data-tooltip]:not(.invisible)")),e},this.occupied=function(e){for(var s in $("#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge").addClass("invisible"),e)$("#chainMap [data-nodeid='"+e[s].systemID+"'] [data-icon='user']").removeClass("invisible"),$("#chainMap [data-nodeid='"+e[s].systemID+"'] [data-icon='user'] + .badge").removeClass("invisible").html(e[s].count);return OccupiedToolTips.attach($("#chainMap [data-icon='user']:not(.invisible)")),e},this.flares=function(e){if($("#chainMap div.node").removeClass("redNode yellowNode greenNode"),$("#chainGrid tr").removeClass("red yellow green"),e)for(var s in e.flares){var i=e.flares[s].systemID,t=e.flares[s].flare,a=($("#chainMap [data-nodeid="+i+"]").addClass(t+"Node").parent().index()-1)/3*2;a>0&&$("#chainGrid tr:eq("+a+")").addClass(t).next().addClass(t)}return e},this.grid=function(){if(0==options.chain.gridlines)return $("#chainGrid tr").addClass("hidden"),!1;$("#chainGrid tr").removeClass("hidden");var e=Math.max(0,2*$(".google-visualization-orgchart-table tr:has(.node)").length-1);$("#chainGrid tr:gt("+e+")").addClass("hidden")},this.nodes=function(e){var s={cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}],rows:[]},i=["Q003","E004","L005","Z006","M001","C008","G008","A009","SML"],t=[];function a(e,s){if(!e||!tripwire.systems[e])return!1;const i=options.chain.tabs[options.chain.active];return n(e,s,null,null,i&&0!=i.systemID&&0>i.systemID.indexOf(",")?options.chain.tabs[options.chain.active].name:void 0,"&nbsp;",["top-level"])}function n(e,s,i,t,a,n,r){var l=function(e){var s=systemAnalysis.analyse(e);if(!s){var i="string"==typeof e&&e.indexOf("|")>=0?tripwire.aSigSystems[e.substring(0,e.indexOf("|"))]:null;const t=i&&"Class-"==i.substring(0,6)?1*i.substring(6):void 0,a="High-Sec"==i?.8:"Low-Sec"==i?.4:"Null-Sec"==i?-.1:void 0,n="Triglavian"==i?500026:void 0;s=systemAnalysis.analyse(e,{security:a,class:t,factionID:n})}return"<span class='"+s.systemTypeClass+"'>"+s.systemTypeName+s.systemTypeModifiers.join("")+"</span>"}(e);const c=tripwire.systems[e];var o=null,d=null;if(c&&c.effect){switch(c.effect){case"Black Hole":o="blackhole";break;case"Cataclysmic Variable":o="cataclysmic-variable";break;case"Magnetar":o="magnetar";break;case"Pulsar":o="pulsar";break;case"Red Giant":o="red-giant";break;case"Wolf-Rayet Star":o="wolf-rayet"}d=c.effect}a=_.escape(a);const p="name"==options.chain.sigNameLocation?a||(c?c.name:"&nbsp;"):"name_prefix"==options.chain.sigNameLocation&&a?a+(c?" - "+c.name:""):c?c.name:"&nbsp;";var h={v:s,systemID:e},m="<div id='node"+s+"' data-nodeid='"+e+"'"+(i?" data-sigid='"+i+"'":"")+(t?" data-inSigid='"+t+"'":"")+" class='node "+(r||[]).join(" ")+"'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' "+(o?"data-icon='"+o+"' data-tooltip='"+d+"'":null)+"></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>"+l+"</h4><h4 class='nodeSystem'>"+(c?"<a href='.?system="+c.name+"'>"+p+"</a>":p)+"</h4><h4 class='nodeType'>"+n+"</h4><div class='statics'>"+function(e){if(!e)return"";const s={"High-Sec":"H","Low-Sec":"L","Null-Sec":"N",Triglavian:"▼","Class 1":"1","Class 2":"2","Class 3":"3","Class 4":"4","Class 5":5,"Class 6":6},i={H:"hisec",L:"lowsec",N:"nullsec","▼":"triglavian"};return e.map(function(e){const t=s[tripwire.wormholes[e].leadsTo];return'<span class="'+(i[t]||"class-"+t)+'" data-tooltip="'+tripwire.wormholes[e].leadsTo+" via "+e+'">'+t+"</span>"}).join("")}(c?c.statics:[])+"</div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>";return h.f=m,h}function r(e,s,i){var t=guidance.findShortestPath(tripwire.map.shortest,[i-3e7,s.child.systemID-3e7]);if(!t)return null;var a={calculated:!0,life:"Gate",parent:{}};return a.parent.id=s.child.id,a.parent.systemID=s.child.systemID,a.parent.name=s.child.name,a.parent.type=s.child.type,a.parent.nth=s.child.nth,a.child={},a.child.id=++e,a.child.systemID=i,a.child.name=tripwire.systems[i].name,a.child.path=t,a.child.jumps=t.length-1,a.child.nth=null,{childID:e,calcNode:a}}function l(e){if(e[0]<=0)return!1;var s=parseInt(e[1]),i=o.length;const t=[],a=function(e){$("#show-viewing").hasClass("active")&&tripwire.systems[e.child.systemID]&&!tripwire.systems[viewingSystemID].class&&!tripwire.systems[e.child.systemID].class&&viewingSystemID!=e.child.systemID&&((t=r(i,e,viewingSystemID))&&(i=t.childID,p.push(t.calcNode),o.push([0,i])));if($("#show-favorite").hasClass("active")&&tripwire.systems[e.child.systemID]&&!tripwire.systems[e.child.systemID].class)for(var s in options.favorites){var t;if(!(tripwire.systems[options.favorites[s]].regionID>=11e6||tripwire.systems[e.child.systemID].regionID>=11e6||options.favorites[s]==e.child.systemID))(t=r(i,e,options.favorites[s]))&&(i=t.childID,p.push(t.calcNode),o.push([0,i]))}};for(var n in d){var l=d[n];if(-1==$.inArray(l.id,h)){var c,m,y,u,v,f,g;if("secondary"==l.parent?(c=tripwire.client.signatures[l.secondaryID],m=tripwire.client.signatures[l.initialID]):(c=tripwire.client.signatures[l.initialID],m=tripwire.client.signatures[l.secondaryID]),y=l.type,"K162",c&&c.systemID==e[0])u=c,v=m,f="K162",g=y;else{if(!m||m.systemID!=e[0])continue;u=m,v=c,g="K162",f=y}var w={};w.id=l.id,w.life=l.life,w.mass=l.mass,w.time=u.modifiedTime,w.parent={},w.parent.id=s,w.parent.systemID=tripwire.systems[u.systemID]?u.systemID:u.systemID+"|"+Math.floor(Math.random()*Math.floor(1e4)),w.parent.name=u.name,w.parent.type=f,w.parent.typeBM=null,w.parent.classBM=null,w.parent.nth=null,w.parent.signatureID=v.signatureID,w.parent.sigIndex=v.id,w.child={},w.child.id=++i,w.child.systemID=tripwire.systems[v.systemID]?v.systemID:v.systemID+"|"+Math.floor(Math.random()*Math.floor(1e4)),w.child.name=v.name,w.child.type=g,w.child.typeBM=null,w.child.classBM=null,w.child.nth=null,w.child.signatureID=u.signatureID,w.child.sigIndex=u.id,p.push(w),o.push([w.child.systemID,w.child.id,e[2]]),h.push(w.id),tripwire.systems[v.systemID]&&t.push(1*v.systemID),a(w)}}thirdPartySuppliers.forEach(function(n){const r={parentID:s,nextChildID:++i},l=n.findLinks(1*e[0],r);if(l){i=r.nextChildID-1;for(var c=0;c<l.length;c++){var d=l[c];0>h.indexOf(d.id)&&(0>t.indexOf(d.child.systemID)&&(d.thirdParty=n.nodeNameSuffix,p.push(d),o.push([d.child.systemID,d.child.id,e[2]]),t.push(d.child.systemID),a(d)),h.push(d.id))}}})}if($("#chainTabs .current").length>0){var c=$("#chainTabs .current .name").data("tab").toString().split(","),o=[],d=e,p=[],h=[];if(0==c){let i=0;Object.keys(e).slice().forEach(t=>{const n=tripwire.client.signatures[e[t].initialID],r=tripwire.client.signatures[e[t].secondaryID];n&&tripwire.systems[n.systemID]&&void 0===tripwire.systems[n.systemID].class?(i++,s.rows.push({c:[a(n.systemID,i),{v:null}]}),o.push([n.systemID,i,n.systemID])):r&&tripwire.systems[r.systemID]&&void 0===tripwire.systems[r.systemID].class&&(i++,s.rows.push({c:[a(r.systemID,i),{v:null}]}),o.push([r.systemID,i,r.systemID]))})}else for(var m in c)s.rows.push({c:[a(c[m],parseInt(m)+1),{v:null}]}),o.push([c[m],parseInt(m)+1,c[m]]);for(var y=0;y<o.length;y++)l(o[y])}else{$("#chainError").hide();var u={c:[]},v=viewingSystemID;u.c.push(a(v,1),{v:null}),s.rows.push(u);for(o=[[v,1]],d=e,p=[],h=[],y=0;y<o.length;++y)l(o[y])}const f={};for(var m in p){var g=p[m];u={c:[]};const e="id"==options.chain["node-reference"]?g.child.signatureID?g.child.signatureID.substring(0,3):"???":(g.child.type||"(?)")+sigFormat(g.child.typeBM,"type"),a=g.child.path?this.renderPath(g.child.path):"<a href='#' onclick='openSignatureDialog({data: { signature: "+g.child.sigIndex+', mode: "update" }}); return false;\'>'+_.escape(g.parent.name&&"ref"==options.chain.sigNameLocation?g.parent.name:g.parent.name&&"ref_prefix"==options.chain.sigNameLocation?g.parent.name+" - "+e:e)+"</a>",r=g.calculated?["calc"]:f[g.child.systemID]?["loop"]:[];g.thirdParty&&r.push("third-party","third-party-"+g.thirdParty);const l=n(g.child.systemID,g.child.id,g.id,g.child.sigIndex,g.parent.name,a,r);var w={v:g.parent.id};u.c.push(l,w),s.rows.push(u);var I=[];"critical"==g.life&&I.push("eol"),"critical"==g.mass?I.push("critical"):"destab"==g.mass&&I.push("destab"),-1==$.inArray(g.parent.type,i)&&-1==$.inArray(g.child.type,i)||I.push("frig"),I.length&&t.push(Array(l.v,w.v,I,g.id)),g.calculated||(f[g.child.systemID]=u)}return t.reverse(),{map:s,lines:t}},this.renderPath=function(e){if(e.length<=1||e.length>options.chain.routingLimit)return""+e.length-1;for(var s=e.slice(0,e.length-1).reverse().map(function(e){const s=3e7+1*e,i=systemAnalysis.analyse(s);return'<span class="'+i.systemTypeClass+'" data-tooltip="'+i.name+" ("+i.security+')" onclick="tripwire.systemChange('+s+')">'+i.pathSymbol+"</span>"}),i='<span class="path">',t=0;t<s.length;t++)t>0&&0==t%5&&(i+="|"),i+=s[t];return i+"</span>"},this.setActiveTab=function(s){$("#chainTabs .tab").removeClass("current"),options.chain.active=s,null!=s&&$("#chainTabs .tab").eq(s).addClass("current"),options.save(),e.redraw(),tripwire.parse(tripwire.client,"refresh")},this.redraw=function(){this.useRenderer(options.chain.renderer);var e=$.extend(!0,{},this.data);e.map=$.extend(!0,{},e.rawMap),this.draw(e)};var i=null;this.draw=function(s){s=void 0!==s?s:{};if(clearTimeout(i),!this.renderer.ready()||Object.size(s.map)&&!tripwire.client.signatures)i=setTimeout(function(){e.draw(s)},100);else{if(s.map){this.drawing=!0,this.data.rawMap=$.extend(!0,{},s.map),Object.sort(s.map,"id"),$.extend(s,this.nodes(s.map)),$.extend(this.data,s);const e=options.chain.tabs[options.chain.active]&&options.chain.tabs[options.chain.active].collapsed||[];this.renderer.draw(s.map,s.lines,e),this.grid(),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attachedElements&&WormholeTypeToolTips.attachedElements.length>0&&WormholeTypeToolTips.detach($("#chainMap .whEffect")),WormholeTypeToolTips.attach($("#chainMap .whEffect[data-icon]")),WormholeRouteToolTips.attach($("#chainMap .path span[data-tooltip]")),SystemActivityToolTips.attach($("#chainMap .nodeClass span[data-tooltip]")),this.drawing=!1}!this.data.activity||new Date>this.data.activity.expires?(s.activity={},tripwire.esi.universeJumps().done(function(e,i,t){s.activity.expires=new Date(t.getResponseHeader("expires")),$.each(e,function(i){s.activity[e[i].system_id]={systemID:e[i].system_id,shipJumps:e[i].ship_jumps}})}).then(function(){return tripwire.esi.universeKills().done(function(e){$.each(e,function(i){s.activity[e[i].system_id]?(s.activity[e[i].system_id].podKills=e[i].pod_kills,s.activity[e[i].system_id].shipKills=e[i].ship_kills,s.activity[e[i].system_id].npcKills=e[i].npc_kills):s.activity[e[i].system_id]={systemID:e[i].system_id,podKills:e[i].pod_kills,shipKills:e[i].ship_kills,npcKills:e[i].npc_kills}})})}).then(function(){e.data.activity=e.activity(s.activity)})):s.map&&e.activity(this.data.activity),s.occupied&&(this.data.occupied=this.occupied(s.occupied)),s.flares&&(this.data.flares=this.flares(s.flares))}},this.updateCollapsed=function(s){options.chain.tabs[options.chain.active]&&(options.chain.tabs[options.chain.active].collapsed=s),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attachedElements&&WormholeTypeToolTips.attachedElements.length>0&&WormholeTypeToolTips.detach($("#chainMap .whEffect")),WormholeTypeToolTips.attach($("#chainMap .whEffect[data-icon]")),e.activity(e.data.activity),e.occupied(e.data.occupied),e.flares(e.data.flares),e.grid(),options.save()}};
tripwire.active=function(t){var i=[],a=[];for(var e in t){var d=JSON.parse(t[e].activity);i.push(parseInt(d.editSig)),a.push(parseInt(d.editComment)),d.editSig&&$("#sigTable tr[data-id='"+d.editSig+"']").addClass("editing").find("td").animate({backgroundColor:"#001b47"},1e3),d.editComment&&$("#commentWrapper .comment[data-id='"+d.editComment+"'] .cke").length>0&&$("#commentWrapper .comment[data-id='"+d.editComment+"']").addClass("editing").find(".commentStatus").html(t[e].characterName+" is editing").fadeIn()}$("#sigTable tr.editing").each(function(){-1==$.inArray($(this).data("id"),i)&&$("#sigTable tr[data-id='"+$(this).data("id")+"']").removeClass("editing").find("td").animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})})}),$("#commentWrapper .editing").each(function(){-1==$.inArray($(this).data("id"),a)&&$("#commentWrapper .editing[data-id='"+$(this).data("id")+"']").removeClass("editing").find(".commentStatus").fadeOut(function(){$(this).html("")})})};
tripwire.addSig=function(t,i,s){var e=void 0===(i=i||{}).animate||i.animate,a=(s=s||!1,{});if("wormhole"==t.type){if(!(a=Object.values(tripwire.client.wormholes).find(function(i){return i.initialID==t.id||i.secondaryID==t.id})))return!1;var n=t.id==a.initialID?tripwire.client.signatures[a.secondaryID]:tripwire.client.signatures[a.initialID];if(!n)return!1;t.name?leadsTo=tripwire.systems[n.systemID]?"<a href='.?system="+tripwire.systems[n.systemID].name+"'>"+t.name+"</a>":t.name:tripwire.aSigSystems[n.systemID]?leadsTo=tripwire.aSigSystems[n.systemID]:tripwire.systems[n.systemID]?leadsTo="<a href='.?system="+tripwire.systems[n.systemID].name+"'>"+tripwire.systems[n.systemID].name+"</a>":leadsTo="";var r="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(a)+'">'+(a[a.parent+"ID"]==t.id?a.type||"":a.parent?"K162":"")+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+(leadsTo||"")+"</td><td class='"+a.life+" "+options.signatures.alignment.sigLife+"'>"+a.life+"</td><td class='"+a.mass+" "+options.signatures.alignment.sigMass+"'>"+a.mass+"</td></tr>",o=$(r)}else r="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td></tr>",o=$(r);Tooltips.attach($(o).find("[data-tooltip]")),$("#sigTable").append(o),"critical"==a.life?$(o).find("span[data-age]").countdown({until:moment.utc(t.lifeLeft).toDate(),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(o).find("span[data-age]").countdown({since:moment.utc(t.lifeTime).toDate(),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),e&&($(o).find("td").wrapInner('<div class="hidden" />').parent().find("td > div").slideDown(700,function(){$set=$(this),$set.replaceWith($set.contents())}),$(o).find("td").animate({backgroundColor:"#004D16"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})}))};
tripwire.API=function(){this.indicator,this.APIrefresh,this.API.expire=function(){var e={since:tripwire.API.APIrefresh,until:null,format:"MS",layout:"-{mnn}{sep}{snn}"};$("#APItimer").countdown("option",e)},this.API.refresh=function(){$.ajax({url:"api_update.php",cache:!1,dataType:"JSON",data:"indicator="+tripwire.API.indicator}).done(function(e){if(e&&e.APIrefresh){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),activity.refresh();var i={until:tripwire.API.APIrefresh,since:null,layout:"{mnn}{sep}{snn}"};$("#APItimer").countdown("option",i),setTimeout("tripwire.API.refresh();",$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)}else"-{mnn}{sep}{snn}"!==$("#APItimer").countdown("option","layout")&&$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))>120?setTimeout("tripwire.API.refresh();",1e3*($.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)):setTimeout("tripwire.API.refresh();",15e3)})},this.API.init=function(){$.ajax({url:"api_update.php",cache:!0,dataType:"JSON",data:"init=true"}).done(function(e){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),$("#APItimer").countdown({until:tripwire.API.APIrefresh,onExpiry:tripwire.API.expire,alwaysExpire:!0,compact:!0,format:"MS",serverSync:tripwire.serverTime.getTime,onTick:function(e){$("#APIclock").val(e[5]+1).trigger("change")}});var i="-{mnn}{sep}{snn}"===$("#APItimer").countdown("option","layout")?15:$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30;setTimeout("tripwire.API.refresh();",1e3*i)})},this.API.init()};
tripwire.autoMapper=function(e,i){var t=[];if(!$("#toggle-automapper").hasClass("active")||$("#toggle-automapper").hasClass("disabled"))return!1;if(!tripwire.systems[e]||!tripwire.systems[i])return!1;if(e==i)return!1;if(tripwire.client.EVE&&tripwire.client.EVE.stationID)return!1;if(tripwire.client.EVE&&tripwire.client.EVE.shipTypeID&&$.inArray(parseInt(tripwire.client.EVE.shipTypeID),[33328,670])>=0)return!1;if(void 0!==tripwire.map.shortest[e-3e7]&&void 0!==tripwire.map.shortest[e-3e7][i-3e7])return!1;if($.map(tripwire.client.wormholes,function(t){const s=tripwire.client.signatures[t.initialID],r=tripwire.client.signatures[t.secondaryID];return s&&r&&(s.systemID==e&&r.systemID==i||s.systemID==i&&r.systemID==e)?t:null}).length>0)return!1;var s,r={signatures:{add:[],update:[]}};s=tripwire.systems[i].class?"Class-"+tripwire.systems[i].class:tripwire.systems[i].security>=.45?"High-Sec":tripwire.systems[i].security>0?"Low-Sec":"Null-Sec";var n=$.map(tripwire.client.wormholes,function(i){if(void 0!==tripwire.client.signatures[i.initialID]&&void 0!==tripwire.client.signatures[i.secondaryID]&&tripwire.client.signatures[i.initialID].systemID==e&&!tripwire.systems[tripwire.client.signatures[i.secondaryID].systemID]){if(tripwire.aSigSystems[tripwire.client.signatures[i.secondaryID].systemID]==s)return i;if(i.type&&tripwire.wormholes[i.type]&&tripwire.wormholes[i.type].leadsTo.replace(" ","-")==s)return i;if(!(null!==tripwire.client.signatures[i.secondaryID].systemID||i.type&&tripwire.wormholes[i.type]))return i}});if(n.length)if(n.length>1)$("#dialog-select-signature").dialog({autoOpen:!0,title:"Which Signature?",width:390,buttons:{Cancel:function(){$(this).dialog("close")},Ok:function(){var e=$("#dialog-select-signature [name=sig]:checked").val(),s=n[e],a=tripwire.client.signatures[s.initialID],l=tripwire.client.signatures[s.secondaryID];r.signatures.update.push({wormhole:{id:s.id},signatures:[{id:a.id},{id:l.id,systemID:i}]});tripwire.refresh("refresh",r,function(e){e.resultSet&&1==e.resultSet[0].result&&(t.push({wormhole:s,signatures:[a,l]}),$("#dialog-select-signature").dialog("close"))})}},open:function(){$("#dialog-select-signature .optionsTable tbody").empty(),$.each(n,function(e){var i=tripwire.client.signatures[n[e].initialID],t="<tr><td><input type='radio' name='sig' value='"+e+"' id='sig"+e+"' /></td>"+$("#sigTable tr[data-id='"+i.id+"']").html()+"</tr>";$("#dialog-select-signature .optionsTable tbody").append(t),$("#dialog-select-signature .optionsTable tbody td").wrapInner("<label for='sig"+e+"' />")})}});else{var a=n[0],l=tripwire.client.signatures[a.initialID],u=tripwire.client.signatures[a.secondaryID];r.signatures.update.push({wormhole:{id:a.id},signatures:[{id:l.id},{id:u.id,systemID:i}]}),t.push({wormhole:a,signatures:[l,u]})}else r.signatures.add.push({wormhole:{type:null,parent:"initial",life:"stable",mass:"stable"},signatures:[{systemID:e,type:"wormhole"},{systemID:i,type:"wormhole"}]});if(r.signatures.add.length||r.signatures.update.length){tripwire.refresh("refresh",r,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),e.results&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:e.results}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:e.results}]),t.length&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:t}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:t}]),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}};
tripwire.comments=function(){this.comments.data={},this.comments.parse=function(t){for(var e in t){var m=t[e].id;if(Object.find(tripwire.comments.data,"id",m)||0!=$(".comment[data-id='"+m+"']").length){if(Object.find(tripwire.comments.data,"id",m)&&Object.find(tripwire.comments.data,"id",m).modified!=t[e].modified){i=$(".comment[data-id='"+m+"']");try{i.find(".commentBody").html(t[e].comment)}catch(t){i.find(".commentFooter").show(),i.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),i.find(".commentFooter .commentControls").hide()}i.find(".commentModified").html("Edited by "+t[e].modifiedByName+" at "+t[e].modified),i.find(".commentSticky").addClass(t[e].sticky?"active":"")}}else{var i=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(i),i.attr("data-id",m);try{i.find(".commentBody").html(t[e].comment)}catch(t){i.find(".commentFooter").show(),i.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),i.find(".commentFooter .commentControls").hide()}i.find(".commentModified").html("Edited by "+t[e].modifiedByName+" at "+t[e].modified),i.find(".commentCreated").html("Posted by "+t[e].createdByName+" at "+t[e].created),i.find(".commentBody").attr("id","comment"+o),i.find(".commentSticky").addClass(t[e].sticky?"active":""),i.removeClass("hidden"),Tooltips.attach(i.find("[data-tooltip]"))}}for(var e in tripwire.comments.data){m=tripwire.comments.data[e].id;if(!Object.find(t,"id",m))(i=$(".comment[data-id='"+m+"']")).remove()}tripwire.comments.data=t}},tripwire.comments();
tripwire.deleteSig=function(e){var a=$("#sigTable tr[data-id='"+e+"']");$(a).find("td:empty, a:empty").append("&nbsp;"),$(a).find("td").wrapInner("<div />").parent().find("td > div").animate({backgroundColor:"#4D0000"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3).slideUp(700,function(){$(a).find("span[data-age]").countdown("destroy"),$(this).parent().parent().remove(),$("#sigTable").trigger("update")})};
tripwire.editSig=function(t,i){i=i||!1;var s={};if("wormhole"==t.type){if(!(s=$.map(tripwire.client.wormholes,function(i){if(i.initialID==t.id||i.secondaryID==t.id)return i})[0]))return!1;var e=t.id==s.initialID?tripwire.client.signatures[s.secondaryID]:tripwire.client.signatures[s.initialID];if(!e)return!1;t.name?leadsTo=tripwire.systems[e.systemID]?"<a href='.?system="+tripwire.systems[e.systemID].name+"'>"+t.name+"</a>":t.name:tripwire.aSigSystems[e.systemID]?leadsTo=tripwire.aSigSystems[e.systemID]:tripwire.systems[e.systemID]?leadsTo="<a href='.?system="+tripwire.systems[e.systemID].name+"'>"+tripwire.systems[e.systemID].name+"</a>":leadsTo="";var a="<tr data-id='"+t.id+"' data-tooltip='' "+(i?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(s)+'">'+(s[s.parent+"ID"]==t.id?s.type||"":s.parent?"K162":"")+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+(leadsTo||"")+"</td><td class='"+s.life+" "+options.signatures.alignment.sigLife+"'>"+s.life+"</td><td class='"+s.mass+" "+options.signatures.alignment.sigMass+"'>"+s.mass+"</td></tr>",n=$(a)}else a="<tr data-id='"+t.id+"' data-tooltip='' "+(i?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td></tr>",n=$(a);Tooltips.attach($(n).find("[data-tooltip]")),$("#sigTable tr[data-id='"+t.id+"']").find("span[data-age]").countdown("destroy"),$("#sigTable tr[data-id='"+t.id+"']").replaceWith(n),$("#sigTable").trigger("update"),"critical"==s.life?$(n).find("span[data-age]").countdown({until:moment.utc(t.lifeLeft).toDate(),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(n).find("span[data-age]").countdown({since:moment.utc(t.lifeTime).toDate(),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),$(n).effect("pulsate")};
tripwire.esi=function(){var e,a,r,t="https://esi.evetech.net",i="Tripwire Client "+tripwire.version+" ("+window.location.hostname+") - "+window.navigator.userAgent;this.esi.connection=!0,this.esi.characters={};var s=function(e){return moment.utc(e).subtract(5,"minutes").isBefore(moment())};this.esi.location=function(){for(characterID in clearTimeout(e),tripwire.esi.characters){var a=tripwire.esi.characters[characterID];s(a.tokenExpire)?tripwire.data.esi={expired:!0}:$.ajax({url:t+"/v1/characters/"+characterID+"/location/?"+$.param({token:a.accessToken,user_agent:i}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,r){var t=tripwire.esi.characters[this.characterID];t&&(t.locationDate=moment(r.getResponseHeader("last-modified"),"ddd, DD MMMM YYYY HH:mm:ss").format(),t.systemID!=e.solar_system_id&&(t.systemID=e.solar_system_id||null,t.systemName=tripwire.systems[e.solar_system_id]?tripwire.systems[e.solar_system_id].name:null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".system").html(t.systemName||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,stationID:t.stationID,stationName:t.stationName,shipID:t.shipID,shipName:t.shipName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName}),t.stationID!=e.station_id&&(t.stationID=e.station_id||null,e.station_id?tripwire.esi.stationLookup(e.station_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.stationName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".station").html(e.name.substring(0,17)+"..."||"&nbsp;").attr("data-tooltip",e.name),Tooltips.attach($("#tracking .tracking-clone[data-characterid='"+this.reference+"'] .station[data-tooltip]")),tripwire.data.tracking[this.reference]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(t.stationName=null,Tooltips.detach($("#tracking .tracking-clone[data-characterid='"+this.characterID+"'] .station[data-tooltip]")),tripwire.data.tracking[this.characterID]={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,stationID:t.stationID,stationName:t.stationName,shipID:t.shipID,shipName:t.shipName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName})),options.tracking.active==this.characterID&&tripwire.EVE(tripwire.esi.characters[options.tracking.active]))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a,r){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"));var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})}e=setTimeout("tripwire.esi.location()",5e3)},this.esi.ship=function(){for(characterID in clearTimeout(a),tripwire.esi.characters){var e=tripwire.esi.characters[characterID];s(e.tokenExpire)?tripwire.data.esi={expired:!0}:$.ajax({url:t+"/v1/characters/"+characterID+"/ship/?"+$.param({token:e.accessToken,user_agent:i}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,r){var t=tripwire.esi.characters[this.characterID];t&&(t.shipDate=moment(r.getResponseHeader("last-modified"),"ddd, DD MMMM YYYY HH:mm:ss").format(),t.shipID!=e.ship_item_id&&(t.shipID=e.ship_item_id||null,tripwire.data.tracking[this.characterID]={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,stationID:t.stationID,stationName:t.stationName,shipID:t.shipID,shipName:t.shipName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName}),t.shipName!=e.ship_name&&(t.shipName=e.ship_name||null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".shipname").html(e.ship_name||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,stationID:t.stationID,stationName:t.stationName,shipID:t.shipID,shipName:t.shipName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName}),t.shipTypeID!=e.ship_type_id&&(t.shipTypeID=e.ship_type_id||null,e.ship_type_id?tripwire.esi.typeLookup(e.ship_type_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.shipTypeName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".ship").html(e.name||"&nbsp;"),tripwire.data.tracking[this.reference]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(t.shipTypeName=null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".ship").html("&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,stationID:t.stationID,stationName:t.stationName,shipID:t.shipID,shipName:t.shipName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName})))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a,r){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"));var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})}a=setTimeout("tripwire.esi.ship()",5e3)},this.esi.online=function(){for(characterID in clearTimeout(r),tripwire.esi.characters){var e=tripwire.esi.characters[characterID];tripwire.esi.characterStatus(e.characterID,e).done(function(e){e.online?$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("critical").addClass("stable"):$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")}).fail(function(e){var a;e&&403==e.status&&(a=this.reference.characterID,$("#tracking .tracking-clone[data-characterid='"+a+"']").find(".alert").show()),$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")})}r=setTimeout("tripwire.esi.online()",6e4)},this.esi.typeLookup=function(e,a){return $.ajax({url:t+"/v3/universe/types/"+e+"/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON",reference:a}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.stationLookup=function(e,a){return $.ajax({url:t+"/v2/universe/stations/"+e+"/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON",reference:a}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.setDestination=function(e,a,r,s){return r=r||!1,s=s||!1,$.ajax({url:t+"/v2/ui/autopilot/waypoint/?"+$.param({destination_id:e,clear_other_waypoints:r,add_to_beginning:s}),headers:{Authorization:"Bearer "+tripwire.esi.characters[a].accessToken,"X-User-Agent":i},type:"POST",dataType:"JSON"}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.showInfo=function(e,a){return $.ajax({url:t+"/v1/ui/openwindow/information/?"+$.param({target_id:e}),headers:{Authorization:"Bearer "+tripwire.esi.characters[a].accessToken,"X-User-Agent":i},type:"POST",dataType:"JSON"}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.characterStatus=function(e,a){return $.ajax({url:t+"/v2/characters/"+e+"/online/?"+$.param({token:tripwire.esi.characters[e].accessToken,user_agent:i}),type:"GET",dataType:"JSON",reference:a}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.eveStatus=function(){return $.ajax({url:t+"/v1/status/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON"}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.idLookup=function(e){return $.ajax({url:t+"/v2/universe/names/?"+$.param({user_agent:i}),type:"POST",dataType:"JSON",contentType:"application/json",processData:!1,data:JSON.stringify(e)}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.characterLookup=function(e,a,r){r=void 0===r||r;return $.ajax({url:t+"/latest/characters/"+e+"/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON",async:r,eveID:e,reference:a}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.corporationLookup=function(e,a,r){r=void 0===r||r;return $.ajax({url:t+"/v4/corporations/"+e+"/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON",async:r,eveID:e,reference:a}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.allianceLookup=function(e,a,r){r=void 0===r||r;return $.ajax({url:t+"/v3/alliances/"+e+"/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON",async:r,eveID:e,reference:a}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.search=function(e,a,r){return $.ajax({url:t+"/v2/search/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON",contentType:"application/json",data:{search:e,categories:a,strict:r}}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.universeJumps=function(){return $.ajax({url:t+"/v1/universe/system_jumps/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON"}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.universeKills=function(){return $.ajax({url:t+"/v2/universe/system_kills/?"+$.param({user_agent:i}),type:"GET",dataType:"JSON"}).always(function(e,a,r){var t=parseHeaders(r.getAllResponseHeaders());t.warning&&console.log("ESI API Warning: ",t.warning,this.url)})},this.esi.fullLookup=function(e){var a=$.Deferred();return tripwire.esi.idLookup(e).done(function(e){for(item in e)"character"==e[item].category?tripwire.esi.characterLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),tripwire.esi.corporationLookup(a.corporation_id,this.reference,!1).done(function(a){e[item].corporation=a,a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})})}):"corporation"==e[item].category&&tripwire.esi.corporationLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})});a.resolve(e)}),a},this.esi.parse=function(e){for(characterID in tripwire.esi.characters)characterID in e||(delete tripwire.esi.characters[characterID],$("#tracking .tracking-clone[data-characterid='"+characterID+"']").remove(),options.tracking.active==characterID&&(tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")));for(characterID in e){if("new"==options.tracking.active&&(options.tracking.active=characterID),!(characterID in tripwire.esi.characters)){var a=$("#tracking-clone").clone();a.attr("data-characterid",characterID),a.find(".avatar img").attr("src","https://image.eveonline.com/Character/"+characterID+"_32.jpg"),a.find(".name").html(e[characterID].characterName),a.removeAttr("id"),a.removeClass("hidden"),a.addClass("tracking-clone"),options.tracking.active==characterID&&(a.addClass("active"),$("#removeESI").removeAttr("disabled")),$("#tracking").append(a)}tripwire.esi.characters[characterID]=e[characterID]}tripwire.esi.ship(),tripwire.esi.location(),tripwire.esi.online()}},tripwire.esi();
tripwire.EVE=function(e,t){var s=this.client.EVE&&this.client.EVE.systemChange||!1;e?(t||(this.client.EVE&&this.client.EVE.systemID!=e.systemID||1==s)&&(s=!0,s=!1,tripwire.autoMapper(this.client.EVE.systemID,e.systemID)),!t&&options.buttons.follow&&this.client.EVE&&this.client.EVE.systemID!=e.systemID&&0==$(".ui-dialog:visible").length&&tripwire.systemChange(e.systemID),$("#search").hasClass("active")||$("#currentSpan").show(),$("#toggle-automapper").removeClass("disabled"),e.systemID&&($("#dialog-signature [data-autocomplete='sigSystems']").hasClass("custom-combobox")&&($("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete("removeFromSelect"),$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete("addToSelect",tripwire.systems[e.systemID].name)),$("#EVEsystem").html(tripwire.systems[e.systemID].name).attr("href",".?system="+tripwire.systems[e.systemID].name))):($("#EVEsystem").html(""),$("#currentSpan").hide(),$("#toggle-automapper").addClass("disabled"),$("#dialog-signature [data-autocomplete='sigSystems']").hasClass("custom-combobox")&&$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete("removeFromSelect")),this.client.EVE={characterID:e.characterID,characterName:e.characterName,systemID:e.systemID,systemName:e.systemName,shipTypeID:e.shipTypeID,shipTypeName:e.shipTypeName,stationID:e.stationID,stationName:e.stationName,locationDate:e.locationDate,shipDate:e.shipDate,systemChange:s}};
tripwire.parse=function(i,s){var t=$.extend(!0,{},i),e=!1;if((null==options.chain.active||options.chain.tabs[options.chain.active]&&1!=options.chain.tabs[options.chain.active].evescout)&&"273.0"!=options.masks.active)for(var n in t.signatures)"273.0"==t.signatures[n].mask&&delete t.signatures[n];if("refresh"==s){var a=this.client.EVE;for(var n in this.client=i,this.client.EVE=a,t.signatures)if(t.signatures[n].systemID==viewingSystemID){var r="273.0"==t.signatures[n].mask&&"273.0"!=options.masks.active;if(tripwire.signatures.list[n]){if(tripwire.signatures.list[n].modifiedTime!==t.signatures[n].modifiedTime){var g=!1;for(column in t.signatures[n])t.signatures[n][column]!=tripwire.signatures.list[n][column]&&"editing"!=column&&(g=!0);g&&this.editSig(t.signatures[n],r)}}else tripwire.signatures.list[n]=t.signatures[n],this.addSig(t.signatures[n],{animate:!0},r),e=!0}for(var n in tripwire.signatures.list)t.signatures[n]||this.deleteSig(n)}else if("init"==s||"change"==s)for(var n in this.client=i,t.signatures)if(t.signatures[n].systemID==viewingSystemID){r="273.0"==t.signatures[n].mask&&"273.0"!=options.masks.active;tripwire.signatures.list[n]||(this.addSig(t.signatures[n],{animate:!1},r),e=!0),t.signatures[n].editing&&this.sigEditing(t.signatures[n])}e&&$("#sigTable").trigger("update"),tripwire.signatures.list=t.signatures;var u=0;$.map(t.signatures,function(i){i.systemID==viewingSystemID&&u++}),$("#signature-count").html(u)};
tripwire.pasteSignatures=function(){var e=!1,i=function(e){var i={},t=e.split("\t"),s=["Cosmic Signature","Cosmic Anomaly","Kosmische Anomalie","Kosmische Signatur","Скрытый сигнал","Космическая аномалия","코즈믹 시그니처","코즈믹 어노말리"],r={"Gas Site":"Gas","Data Site":"Data","Relic Site":"Relic","Ore Site":"Ore","Combat Site":"Combat",Wormhole:"Wormhole",Gasgebiet:"Gas",Datengebiet:"Data",Reliktgebiet:"Relic",Mineraliengebiet:"Ore",Kampfgebiet:"Combat",Wurmloch:"Wormhole","Газовый район":"Gas","Информационный район":"Data","Археологический район":"Relic","Астероидный район":"Ore","Боевой район":"Combat","Червоточина":"Wormhole","가스 사이트":"Gas","데이터 사이트":"Data","유물 사이트":"Relic","채광 사이트":"Ore","전투 사이트":"Combat","웜홀":"Wormhole"};for(var n in t)t[n].match(/^([A-Z]{3}[-]\d{3})$/)?i.id=t[n].split("-"):t[n].match(/(\d([.|,]\d)?[ ]?(%))/)||t[n].match(/(\d[.|,]?\d+\s(AU|AE|km|m|а.е.|км|м))/i)||(-1==$.inArray(t[n],s)?r[t[n]]?i.type=r[t[n]]:""!=t[n]&&(i.name=t[n].trim()):i.scanGroup=t[n]);return!(!i.id||2!==i.id.length)&&i};this.pasteSignatures.parsePaste=function(t){t=t.split("\n");var s={signatures:{add:[],update:[]},systemID:viewingSystemID},r=[];for(var n in e=!0,t){var a=i(t[n]);if(a.id){var u=$.map(tripwire.client.signatures,function(e){if(e.signatureID&&e.signatureID.toUpperCase()==a.id[0]+a.id[1])return e})[0];if(u)if("Wormhole"==a.type&&"wormhole"!=u.type){var o=$.map(tripwire.client.wormholes,function(e){if(e.initialID==u.id||e.secondaryID==u.id)return e})[0]||{},l=o.id?u.id==o.initialID?tripwire.client.signatures[o.secondaryID]:tripwire.client.signatures[o.initialID]:{};s.signatures.update.push({wormhole:{id:o.id||null,type:o.type||null,life:o.life||"stable",mass:o.mass||"stable"},signatures:[{id:u.id,signatureID:u.signatureID,systemID:viewingSystemID,type:"wormhole",name:u.name},{id:l.id||null,signatureID:l.signatureID||null,systemID:l.systemID||null,type:"wormhole",name:l.name}]}),tripwire.client.wormholes[o.id]?r.push({wormhole:tripwire.client.wormholes[o.id],signatures:[tripwire.client.signatures[u.id],tripwire.client.signatures[l.id]]}):r.push(tripwire.client.signatures[u.id])}else"wormhole"!=u.type&&(a.type&&a.type.toLowerCase()!=u.type||a.name&&a.name!=u.name)&&(s.signatures.update.push({id:u.id,systemID:viewingSystemID,type:a.type||"unknown",name:a.name,lifeLength:60*options.signatures.pasteLife*60}),r.push(tripwire.client.signatures[u.id]));else"Wormhole"==a.type?s.signatures.add.push({wormhole:{type:null,parent:"initial",life:"stable",mass:"stable"},signatures:[{signatureID:a.id[0]+a.id[1],systemID:viewingSystemID,type:"wormhole",lifeLength:60*options.signatures.pasteLife*60},{signatureID:null,systemID:null,type:"wormhole",lifeLength:60*options.signatures.pasteLife*60}]}):s.signatures.add.push({signatureID:a.id[0]+a.id[1],systemID:viewingSystemID,type:a.type||"unknown",name:a.name,lifeLength:60*options.signatures.pasteLife*60})}}if(s.signatures.add.length||s.signatures.update.length){tripwire.refresh("refresh",s,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),e.results&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:e.results}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:e.results}]),r.length&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:r}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:r}]),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){e=!1})}else e=!1},this.pasteSignatures.init=function(){$(document).keydown(function(i){if((i.metaKey||i.ctrlKey)&&(86==i.keyCode||91==i.keyCode)&&!e){if($(document.activeElement).is("textarea, input"))return;$("#clipboard").focus()}}),$("body").on("click","#fullPaste",function(e){e.preventDefault();var t=$(this).data("paste").split("\n"),s=[],r=[],n=[];for(var a in t)(scan=i(t[a]))&&s.push((scan.id[0]+scan.id[1]).toLowerCase());for(var a in tripwire.client.signatures){var u=tripwire.client.signatures[a];if(u.systemID==viewingSystemID&&u.signatureID&&-1===$.inArray(u.signatureID.toLowerCase(),s)&&"???"!==u.signatureID)if("wormhole"==u.type){var o=$.map(tripwire.client.wormholes,function(e){if(e.initialID==u.id||e.secondaryID==u.id)return e})[0]||{},l=o.id?u.id==o.initialID?tripwire.client.signatures[o.secondaryID]:tripwire.client.signatures[o.initialID]:{};"GATE"!==o.type&&(r.push(o),n.push({wormhole:o,signatures:[u,l]}))}else r.push(u.id),n.push(u)}if(r.length>0){var p={signatures:{remove:r}};tripwire.refresh("refresh",p,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:n}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:n}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}}),$("#clipboard").on("paste",function(e){e.preventDefault();var i=window.clipboardData?window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData.getData("text/plain");$("#clipboard").blur(),Notify.trigger("Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)"),$("#fullPaste").data("paste",i),tripwire.pasteSignatures.parsePaste(i)})},this.pasteSignatures.init()},tripwire.pasteSignatures();
tripwire.redo=function(){if(tripwire.signatures.redo[viewingSystemID].length>0){$("#redo").addClass("disabled");var i=tripwire.signatures.redo[viewingSystemID].length-1,e={systemID:viewingSystemID,signatures:{add:[],remove:[],update:[]}},r=tripwire.signatures.redo[viewingSystemID][i],t=$.map(r.signatures,function(i){if(i.wormhole&&tripwire.client.wormholes[i.wormhole.id])return{wormhole:tripwire.client.wormholes[i.wormhole.id],signatures:[tripwire.client.signatures[i.signatures[0].id],tripwire.client.signatures[i.signatures[1].id]]};if(tripwire.client.signatures[i.id]&&"wormhole"==tripwire.client.signatures[i.id].type){var e=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0];return{wormhole:e,signatures:[tripwire.client.signatures[e.initialID],tripwire.client.signatures[e.secondaryID]]}}return i.wormhole&&tripwire.client.signatures[i.signatures[0].id]?tripwire.client.signatures[i.signatures[0].id]:tripwire.client.signatures[i.id]});switch(r.action){case"add":e.signatures.add=e.signatures.add.concat(r.signatures);break;case"remove":e.signatures.remove=e.signatures.remove.concat($.map(r.signatures,function(i){return i.wormhole?i.wormhole:i.id}));break;case"update":e.signatures.update=e.signatures.update.concat(r.signatures)}tripwire.refresh("refresh",e,function(i){i.resultSet&&1==i.resultSet[0].result&&(tripwire.signatures.redo[viewingSystemID].pop(),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?"add"==r.action?tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:i.results}):"update"==r.action?tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:t}):tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:r.signatures}):"add"==r.action?tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:i.results}]:"update"==r.action?tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:t}]:tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:r.signatures}],sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){tripwire.signatures.redo[viewingSystemID].length>0&&$("#redo").removeClass("disabled")})}};
tripwire.serverStatus=function(){this.data,this.timer,clearTimeout(tripwire.serverStatus.timer),tripwire.esi.eveStatus().always(function(t){t&&t.players&&t.players>0?(tripwire.serverStatus.data&&tripwire.serverStatus.data.players===t.players||($("#serverStatus").html("<span class='"+(t.players>0?"stable":"critical")+"'>TQ</span>: "+numFormat(t.players)),tripwire.serverStatus.data&&$("#serverStatus").effect("pulsate",{times:5})),tripwire.serverStatus.data=t):$("#serverStatus").html("<span class='critical'>TQ</span>"),tripwire.serverStatus.timer=setTimeout("tripwire.serverStatus();",15e3)})},tripwire.serverStatus();
tripwire.sync=function(e,i,t,r){i="object"==typeof i?$.extend(!0,{},i):{};return $.extend(!0,i,tripwire.data),this.timer&&clearTimeout(this.timer),this.xhr?(console.log("Awaiting existing XHR "+this.xhr.data.mode+": ",this.xhr),tripwire.data=i,this.timer=setTimeout(function(){tripwire.sync(e,i,t,r)},50),!1):("refresh"==e||"change"==e?(i.signatureCount=tripwire.serverSignatureCount,i.signatureTime=Object.maxTime(this.client.signatures,"modifiedTime"),i.flareCount=chain.data.flares?chain.data.flares.flares.length:0,i.flareTime=chain.data.flares?chain.data.flares.last_modified:0,i.commentCount=Object.size(this.comments.data),i.commentTime=Object.maxTime(this.comments.data,"modified"),i.activity=this.activity):($.extend(this,appData),this.aSystems=$.map(this.systems,function(e){return e.name}),this.aSigSystems=["Null-Sec","Low-Sec","High-Sec","Class-1","Class-2","Class-3","Class-4","Class-5","Class-6","Class-13","Triglavian"],$.merge(this.aSigSystems,this.aSystems.slice()),$(".systemsAutocomplete").inlinecomplete({source:this.aSystems,maxSize:10,delay:0})),i.mode="init"!=e?"refresh":"init",i.systemID=viewingSystemID,i.systemName=viewingSystem,i.instance=tripwire.instance,i.version=tripwire.version,this.xhr=$.ajax({url:"refresh.php",data:i,type:"POST",dataType:"JSON",cache:!1}).done(function(i){if(i){if(tripwire.server=i,i.signatures&&(tripwire.serverSignatureCount=Object.size(i.signatures)),i.wormholes){var r={},s={};for(var a in Object.values(i.wormholes).forEach(function(e){r[parseInt(e.initialID)]=e.id,s[parseInt(e.secondaryID)]=e.id}),i.signatures)if("wormhole"==i.signatures[a].type){var n=i.signatures[a].id;void 0===r[n]&&void 0===s[n]&&delete i.signatures[a]}}i.esi&&tripwire.esi.parse(i.esi),i.sync&&(tripwire.serverTime.time=new Date(i.sync)),i.signatures&&tripwire.parse(i,e),i.comments&&tripwire.comments.parse(i.comments),i.wormholes||i.occupied||i.flares?tripwire.chainMap.parse({map:i.wormholes||null,occupied:i.occupied||null,flares:i.flares||null}):chain.data.occupied&&chain.data.occupied.length&&!i.occupied&&tripwire.chainMap.parse({occupied:[]}),tripwire.active(i.activity),i.notify&&!$("#serverNotification")[0]&&Notify.trigger(i.notify,"yellow",!1,"serverNotification"),$("[data-command=ping]")[i.discord_integration?"show":"hide"]()}tripwire.data={tracking:{},esi:{}},t&&t(i)}).always(function(e,i){tripwire.timer=setTimeout("tripwire.refresh();",tripwire.refreshRate),r&&r(e),403==e.status?window.location.href=".":"success"!=i&&"abort"!=i&&1==tripwire.connected?(tripwire.connected=!1,$("#ConnectionSuccess").click(),Notify.trigger("Error syncing with server","red",!1,"connectionError")):"success"==i&&0==tripwire.connected&&(tripwire.connected=!0,$("#connectionError").click(),Notify.trigger("Successfully reconnected with server","green",5e3,"connectionSuccess")),tripwire.xhr=null}),this.xhr.data=i,!0)},tripwire.sync("init");
tripwire.systemChange=function(e,t){const s=systemAnalysis.analyse(e);if("init"!=t&&($("#infoSecurity").removeClass(),$("#infoStatics").empty(),viewingSystem=s.name,viewingSystemID=e,activity.refresh(!0),$("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=null,chain.redraw(),$("#notesWidget .content .comment:visible").remove(),tripwire.comments.data=null,history.replaceState(null,null,"?system="+viewingSystem),tripwire.refresh("change")),document.title=s.name+" - "+app_name,$("#infoSystem").text(s.name),-1!=$.inArray(parseInt(viewingSystemID),options.favorites)?$("#system-favorite").attr("data-icon","star").addClass("active"):$("#system-favorite").attr("data-icon","star-empty").removeClass("active"),s.class){if($("#infoSecurity").html("<span class='wh pointer'>Class "+s.class+"</span>"),s.effect){var i='<table cellpadding="0" cellspacing="1">';for(var a in tripwire.effects[s.effect]){var n=tripwire.effects[s.effect][a].name,r=tripwire.effects[s.effect][a].base,o=tripwire.effects[s.effect][a].bad,c=s.class>6?6:s.class,l=0;switch(Math.abs(r)){case 15:l=r>0?7:-7;break;case 30:l=r>0?14:-14;break;case 60:l=r>0?28:-28}i+="<tr><td>"+n+'</td><td style="padding-left: 25px; text-align: right;" class="'+(o?"critical":"stable")+'">',i+=r+l*(c-1)+"%</td></tr>"}i+="</table>",$("#infoSecurity").append("&nbsp;<span class='pointer' data-tooltip='"+i+"'>"+s.effect+"</span>")}for(var a in s.statics){var d=s.statics[a],p=tripwire.wormholes[d],f="wh";switch(p.leadsTo){case"High-Sec":f="hisec";break;case"Low-Sec":f="lowsec";break;case"Null-Sec":f="nullsec"}$("#infoStatics").append("<div><span class='"+f+"'>&#9679;</span> <b>"+p.leadsTo+"</b> via <span class='"+f+"'>"+d+"</span></div>")}$("#infoFaction").html("&nbsp;")}else{const e={HS:"High-Sec",LS:"Low-Sec",NS:"Null-Sec",Trig:"Triglavian"}[s.systemTypeName];for(var m in $("#infoSecurity").addClass(s.systemTypeClass).html(e+" "+s.baseSecurity.toFixed(2)+s.systemTypeModifiers.join(" ")),$("#infoFaction").html(s.factionID?tripwire.factions[s.factionID].name:"&nbsp;"),options.favorites){const e=options.favorites[m],t=guidance.findShortestPath(tripwire.map.shortest,e-3e7,viewingSystemID-3e7);t&&$("#infoStatics").append('<p><b><a href=".?system='+tripwire.systems[e].name+'">'+tripwire.systems[e].name+"</a></b>: "+chain.renderPath(t)+"</p>")}}Tooltips.attach($("#infoStatics [data-tooltip]")),Tooltips.attach($("#infoSecurity [data-tooltip]")),$("#infoRegion").text(tripwire.regions[s.regionID].name),$("#infoWidget .infoLink").each(function(){this.href=$(this).data("href").replace(/\$systemName/gi,s.name).replace(/\$systemID/gi,e)}),tripwire.signatures.undo[e]&&tripwire.signatures.undo[e].length>0?$("#undo").removeClass("disabled"):$("#undo").addClass("disabled"),tripwire.signatures.redo[e]&&tripwire.signatures.redo[e].length>0?$("#redo").removeClass("disabled"):$("#redo").addClass("disabled"),0==$("#sigTable tr.selected").length?$("#signaturesWidget #delete-signature").addClass("disabled"):$("#signaturesWidget #delete-signature").removeClass("disabled")},tripwire.systemChange(viewingSystemID,"init");
var tutorial;$("#infoWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#infoWidget"),intro:"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>"},{element:document.querySelector("#infoGeneral"),intro:"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>"},{element:document.querySelector("#activityGraph"),intro:"<p>This is the graph containing historical ship jump and kill information from the EVE API.</p><br/><p>This data is only available for K-Space systems and not wormhole systems.</p><br/><p>The EVE API updates this data each hour, so this graph will update itself at the top of every hour.</p>"},{element:$("#activityGraph svg > g > g:nth-child(5)")[0],intro:"<p>Each category can be toggled by clicking these keys to drill down the graph into finer detail.</p>"},{element:document.querySelector("#activityGraphControls"),intro:"<p>Select different lengths of historical data to adjust the graph to display more or less information.</p>"},{element:document.querySelector("#infoStatics"),intro:"<p>If a wormhole system is selected, the publicaly known static wormholes will appear here.</p>"},{element:document.querySelector("#infoLinks"),intro:"<p>These are some quick links to various sites for this specific system.</p>"},{element:document.querySelector("#system-favorite"),intro:"<p>This toggles wether this is a 'favorite' system, orange is active.</p><br/><p>'Favorite' systems can be rendered in the chain map to be able to see how far away trade hub systems are from your wormhole chain K-Space exits.</p>"}]}).start()}),$("#signaturesWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#signaturesWidget"),intro:"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>"},{element:document.querySelector("#add-signature"),intro:"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>"},{element:document.querySelector("#delete-signature"),intro:"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>"},{element:document.querySelector("#signature-count"),intro:"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>"},{element:document.querySelector("#undo"),intro:"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#redo"),intro:"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#toggle-automapper"),intro:"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>"},{element:document.querySelector("#sigTable"),intro:"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>"}]}).start()}),$("#notesWidget .tutorial").click(function(t){t.preventDefault(),(tutorial=introJs().setOptions({showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,skipLabel:"Abort",steps:[{element:document.querySelector("#notesWidget"),intro:"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>"},{element:document.querySelector("#add-comment"),intro:"<p>Now click the + icon to begin adding a new comment in this system ("+viewingSystem+").</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Type some basic text now and click save.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Click on the <b>Edit</b> now on our comment.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>"}]}).start()).onchange(function(t){switch(tutorial._currentStep){case 1:$(".introjs-prevbutton, .introjs-nextbutton").hide(),console.log("switch mask to private"),tutorial.previousMask=options.masks.active,options.masks.active=options.character.id+".1",options.save(),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[2].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(3),tutorial.exiting=!0},200)},$("#notesWidget #add-comment").on("click",tutorial.stepFunc);break;case 2:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),tutorial.stepFunc=function(){tutorial.comment=$(this).closest(".comment"),setTimeout(function(){tutorial._options.steps[3].element=tutorial.comment[0],tutorial._options.steps[4].element=tutorial.comment.find(".commentSticky")[0],tutorial._options.steps[5].element=tutorial.comment.find(".commentControls")[0],tutorial._options.steps[6].element=tutorial.comment.find(".commentControls")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(4),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentSave",tutorial.stepFunc);break;case 6:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[7].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial._options.steps[8].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(8),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentEdit",tutorial.stepFunc)}}),tutorial.onexit(function(){if(tutorial.exiting){if($(".commentCancel:visible").click(),tutorial.comment){var t={mode:"delete",commentID:tutorial.comment.data("id")};$.ajax({url:"comments.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){t&&1==t.result&&tutorial.comment.remove()})}tutorial.previousMask&&setTimeout(function(){console.log("change mask back, delete comment",tutorial.previousMask),options.masks.active=tutorial.previousMask,options.save()},200),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),$("#notesWidget").off("click",".commentEdit",tutorial.stepFunc),$("#notesWidget").off("click",".cke_toolgroup:has(.cke_button__toolbarswitch)",tutorial.stepFunc)}}),tutorial.previousMask,tutorial.comment,tutorial.stepFunc,tutorial.exiting=!0});
tripwire.undo=function(){if(tripwire.signatures.undo[viewingSystemID].length>0){$("#undo").addClass("disabled");var i=tripwire.signatures.undo[viewingSystemID].length-1,e={systemID:viewingSystemID,signatures:{add:[],remove:[],update:[]}},r=tripwire.signatures.undo[viewingSystemID][i],t=$.map(r.signatures,function(i){if(i.wormhole&&tripwire.client.wormholes[i.wormhole.id])return{wormhole:tripwire.client.wormholes[i.wormhole.id],signatures:[tripwire.client.signatures[i.signatures[0].id],tripwire.client.signatures[i.signatures[1].id]]};if(tripwire.client.signatures[i.id]&&"wormhole"==tripwire.client.signatures[i.id].type){var e=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0];return{wormhole:e,signatures:[tripwire.client.signatures[e.initialID],tripwire.client.signatures[e.secondaryID]]}}return i.wormhole&&tripwire.client.signatures[i.signatures[0].id]?tripwire.client.signatures[i.signatures[0].id]:tripwire.client.signatures[i.id]});switch(r.action){case"add":e.signatures.remove=e.signatures.remove.concat($.map(r.signatures,function(i){return i.wormhole?i.wormhole:i.id}));break;case"remove":e.signatures.add=e.signatures.add.concat(r.signatures);break;case"update":e.signatures.update=e.signatures.update.concat(r.signatures)}tripwire.refresh("refresh",e,function(i){i.resultSet&&1==i.resultSet[0].result&&(tripwire.signatures.undo[viewingSystemID].pop(),$("#redo").removeClass("disabled"),viewingSystemID in tripwire.signatures.redo?"remove"==r.action?tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:i.results}):"update"==r.action?tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:t}):tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:r.signatures}):"remove"==r.action?tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:i.results}]:"update"==r.action?tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:t}]:tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:r.signatures}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)))},function(i){tripwire.signatures.undo[viewingSystemID].length>0&&$("#undo").removeClass("disabled")})}};
var activity=new function(){this.graph,this.options,this.view,this.span=24,this.columns=[{id:"time",label:"Time",role:"domain",type:"string",calc:function(t,i){return t.getValue(i,0)+"h"}},{id:"jumps",label:"Jumps",role:"data",type:"number",sourceColumn:1,column:1,title:"Jumps"},{id:"podkills",label:"Pod Kills",role:"data",type:"number",sourceColumn:2,column:2,title:"Pod Kills"},{id:"shipkills",label:"Ship Kills",role:"data",type:"number",sourceColumn:3,column:3,title:"Ship Kills"},{id:"npckills",label:"NPC Kills",role:"data",type:"number",sourceColumn:4,column:4,title:"NPC Kills"}],this.getData=function(t,i){t=void 0!==t?t:this.span,i=void 0===i||i;return activity.graph?$.ajax({url:"activity_graph.php",data:{systemID:viewingSystemID,time:t},type:"GET",dataType:"JSON",cache:i}).done(function(t){t&&(t.rows.reverse(),activity.view=new google.visualization.DataView(new google.visualization.DataTable(t)),activity.view.setColumns(activity.columns),activity.graph.draw(activity.view,activity.options))}):(setTimeout(function(){activity.getData(t,i)},500),!1)},this.selectHandler=function(){var t=activity.graph.getSelection();if(t[0]&&null==t[0].row){var i=t[0].column;activity.columns[i].sourceColumn?(activity.columns[i].label=activity.columns[i].title+" (off)",delete activity.columns[i].sourceColumn):(activity.columns[i].sourceColumn=activity.columns[i].column,activity.columns[i].label=activity.columns[i].title),activity.view.setColumns(activity.columns),activity.options.animation.duration=0,activity.graph.draw(activity.view,activity.options),activity.options.animation.duration=500}},this.init=function(){activity.graph=new google.visualization.AreaChart(document.getElementById("activityGraph")),activity.options={isStacked:!1,backgroundColor:"transparent",hAxis:{textStyle:{color:"#999",fontName:"Verdana",fontSize:10},showTextEvery:3},vAxis:{textStyle:{color:"#666",fontName:"Verdana",fontSize:10},viewWindowMode:"maximized",viewWindow:{min:0},maxValue:5},gridlineColor:"#454545",pointSize:2,lineWidth:1,chartArea:{left:"10%",top:"5%",width:"88%",height:"85%"},legend:{position:"in",textStyle:{color:"#CCC",fontName:"Verdana",fontSize:8.5}},animation:{duration:500,easing:"inAndout"},tooltip:{showColorCode:!0},annotations:{style:"line",textStyle:{fontSize:12,color:"#ccc"},domain:0},focusTarget:"category"},google.visualization.events.addListener(activity.graph,"select",activity.selectHandler),activity.getData(activity.span)},this.time=function(t){switch(t){case 24:this.options.hAxis.showTextEvery=3;break;case 48:this.options.hAxis.showTextEvery=6;break;case 168:this.options.hAxis.showTextEvery=24}this.span=t,this.getData(t)},this.redraw=function(){this.graph.draw(this.view,this.options)},this.refresh=function(t){this.getData(this.span,t)},google.charts.setOnLoadCallback(this.init)};
var CKConfig={skin:"custom",height:100,allowedContent:!0,extraPlugins:"toolbarswitch,autogrow,autolink",enterMode:CKEDITOR.ENTER_BR,removeDialogTabs:"link:advanced",autoGrow_onStartup:!0,autoGrow_minHeight:100,toolbar_minToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike"]},{name:"paragraph",items:["BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize"]},{name:"tools",items:["Toolbarswitch"]}],toolbar_maxToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize","Font"]},{name:"tools",items:["Source","Toolbarswitch"]}],toolbar:"minToolbar",smallToolbar:"minToolbar",maximizedToolbar:"maxToolbar",fontSize_style:{element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]}};CKEDITOR.on("instanceLoaded",function(e){e.editor.on("contentDom",function(){e.editor.on("key",function(t){return 27==t.data.keyCode?($(e.editor.element.$).closest(".comment").find(".commentCancel").click(),!1):t.data.domEvent.$.altKey&&83==t.data.domEvent.$.keyCode?($(e.editor.element.$).closest(".comment").find(".commentSave").click(),!1):void 0})}),$(".cke_combo__font a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>'),$(".cke_combo__fontsize a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>')}),CKEDITOR.on("instanceReady",function(e){e.editor.focus();var t=e.editor.getSelection(),o=t.getRanges(),n=o[0].startContainer,a=n.getParents(!0);if(!(n=a[a.length-2].getFirst()))return!1;for(;;){var i=n.getNext();if(null==i)break;n=i}t.selectElement(n),(o=t.getRanges())[0].collapse(!1),t.selectRanges(o)}),CKEDITOR.on("dialogDefinition",function(e){"link"==e.data.name&&(e.data.definition.getContents("target").get("linkTargetType").default="_blank")});
$("body").on("dblclick",".comment",function(e){e.preventDefault(),document.getSelection().removeAllRanges(),$(this).find(".commentEdit").click()}),$("body").on("click",".commentEdit",function(e){if(e.preventDefault(),$(".cke").length)return!1;var t=$(this).closest(".comment");t.find(".commentToolbar").hide(),CKEDITOR.replace(t.find(".commentBody").attr("id"),CKConfig).on("instanceReady",function(){t.find(".commentStatus").html(""),t.find(".commentFooter").show(),t.find(".commentFooter .commentControls").show()}),tripwire.activity.editComment=t.data("id"),tripwire.refresh("refresh")}),$("body").on("click",".commentSave, .commentCancel",function(e){e.preventDefault();var t=$(this);if(t.attr("disabled"))return!1;var o=t.closest(".comment");if(t.attr("disabled","true"),t.hasClass("commentSave")){var n={mode:"save",commentID:o.data("id"),systemID:o.find(".commentSticky").hasClass("active")?0:viewingSystemID,comment:CKEDITOR.instances[o.find(".commentBody").attr("id")].getData()};$.ajax({url:"comments.php",type:"POST",data:n,dataType:"JSON"}).done(function(e){e&&1==e.result&&(o.find(".commentModified").html("Edited by "+e.comment.modifiedByName+" at "+e.comment.modifiedDate),o.find(".commentCreated").html("Posted by "+e.comment.createdByName+" at "+e.comment.createdDate),Tooltips.attach(o.find("[data-tooltip]")),CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!1),o.attr("data-id",e.comment.id),o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),t.removeAttr("disabled"))})}else CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!0),o.attr("data-id")?(o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),t.removeAttr("disabled")):o.remove();o.find(".commentStatus").html(""),delete tripwire.activity.editComment,tripwire.refresh("refresh")}),$("body").on("click",".commentDelete",function(e){e.preventDefault();var t=$(this).closest(".comment");$("#dialog-deleteComment").hasClass("ui-dialog-content")?$("#dialog-deleteComment").dialog("isOpen")||$("#dialog-deleteComment").data("comment",t).dialog("open"):$("#dialog-deleteComment").data("comment",t).dialog({resizable:!1,minHeight:0,position:{my:"center",at:"center",of:$("#notesWidget")},dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("disable");var e=$(this).data("comment"),t={mode:"delete",commentID:e.data("id")};$.ajax({url:"comments.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){t&&1==t.result&&($("#dialog-deleteComment").dialog("close"),e.remove())}).always(function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}}})}),$("body").on("click","#add-comment",function(e){if(e.preventDefault(),$(".cke").length)return!1;var t=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(t),t.find(".commentBody").attr("id","comment"+o),t.removeClass("hidden").find(".commentEdit").click()}),$("body").on("click",".commentSticky",function(e){e.preventDefault();var t=$(this).closest(".comment"),o={mode:"sticky",commentID:t.data("id"),systemID:t.find(".commentSticky").hasClass("active")?viewingSystemID:0};$.ajax({url:"comments.php",type:"POST",data:o,dataType:"JSON"}).done(function(e){e&&1==e.result&&(t.find(".commentSticky").hasClass("active")?t.find(".commentSticky").removeClass("active"):t.find(".commentSticky").addClass("active"))})});
$("#admin").click(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return!1;if($("#dialog-admin").hasClass("ui-dialog-content"))$("#dialog-admin").dialog("isOpen")||$("#dialog-admin").dialog("open");else{var i=null,d=null,t=null;function o(){t&&t.abort(),d.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length),t=$.ajax({url:"admin.php",type:"POST",data:{mode:$("#dialog-admin .menu .active").attr("data-window")},dataType:"JSON"}).done(function(a){if(a&&a.results){for(var i=a.results,t=[],o=0,e=i.length;o<e;o++){var n=$("#dialog-admin .window .hasFocus tbody tr[data-id='"+i[o].id+"']");if(t.push(i[o].id),n.length)for(col in i[o]){(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?numFormat(i[o][col]):i[o][col])||"&nbsp;")}else{for(col in(n=$("#dialog-admin .window .hasFocus table tr.hidden").clone()).attr("data-id",i[o].id),i[o]){var l;(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?numFormat(i[o][col]):i[o][col])||"&nbsp;")}n.removeClass("hidden"),$("#dialog-admin .window .hasFocus tbody").append(n)}}$("#dialog-admin .window .hasFocus table tr[data-id]").each(function(){-1==$.inArray($(this).data("id").toString(),t)&&$(this).remove()}),$("#dialog-admin .window .hasFocus table").trigger("update",[!0])}else $("#dialog-admin .window .hasFocus table tr[data-id]").remove();d.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length)}),$("#dialog-admin").dialog("isOpen")&&$("#dialog-admin .menu .active").attr("data-refresh")&&(i=setTimeout(o,$("#dialog-admin .menu .active").attr("data-refresh")))}$("#dialog-admin").dialog({autoOpen:!0,modal:!0,height:350,width:800,buttons:{Close:function(){$(this).dialog("close")}},create:function(){$("#dialog-admin").on("click",".menu li",function(a){a.preventDefault(),$menuItem=$(this),clearTimeout(i),$("#dialog-admin .menu .active").removeClass("active"),$menuItem.addClass("active"),$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane").html(""),$("#dialog-admin .window [data-window]").removeClass("hasFocus").hide(),$("#dialog-admin .window [data-window='"+$menuItem.data("window")+"']").addClass("hasFocus").show(),o()}),$("#dialog-admin [data-sortable='true']").tablesorter({sortReset:!0,widgets:["saveSort"],sortList:[[0,0]]}),$($(this)[0].parentElement).find(".ui-dialog-buttonpane").append("<div class='ui-dialog-traypane'></div>"),d=$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane")},open:function(){$menuItem=$("#dialog-admin .menu li.active"),o()},close:function(){clearTimeout(i)}})}});
$("#wrapper").addClass("transition"),$(document).on("dialogopen",".ui-dialog",function(i,e){2==$(".ui-dialog:visible").length&&$(this).hasClass("dialog-modal")?$("body").append($("<div id='overlay' class='overlay' />").css("z-index",$(this).css("z-index")-1)):$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-1),$(this).hasClass("dialog-noeffect")||$("#wrapper").addClass("blur")}),$(document).on("dialogclose",".ui-dialog",function(i,e){$(".ui-dialog").is(":visible")||$("#wrapper").removeClass("blur"),1==$(".ui-dialog:visible").length?$("#overlay").remove():$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-2)}),$(document).on("click","#overwrite",function(){var i={signatures:{remove:[]},systemID:viewingSystemID},e=[],s=tripwire.client.signatures[$(this).data("id")];if("wormhole"!=s.type)e.push(s),i.signatures.remove.push(s.id);else{var t=$.map(tripwire.client.wormholes,function(i){if(i.initialID==s.id||i.secondaryID==s.id)return i})[0];e.push({wormhole:t,signatures:[tripwire.client.signatures[t.initialID],tripwire.client.signatures[t.secondaryID]]}),i.signatures.remove.push(t)}$("#overwrite").attr("disable",!0);tripwire.refresh("refresh",i,function(i){i.resultSet&&1==i.resultSet[0].result&&(ValidationTooltips.close(),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:e}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:e}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),$("#dialog-signature").parent().find(":button:contains('Save')")?$("#dialog-signature").parent().find(":button:contains('Save')").click():$("#dialog-signature").parent().find(":button:contains('Add')").click())},function(){$("#overwrite").removeAttr("disable")})});
$(".options").click(function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return!1;$("#dialog-options").dialog({autoOpen:!1,width:450,minHeight:400,modal:!0,buttons:{Save:function(){JSON.stringify(options);var e=!1;$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!0).addClass("ui-state-disabled"),options.chain.typeFormat=$("#dialog-options #typeFormat").val(),options.chain.classFormat=$("#dialog-options #classFormat").val(),options.chain.sigNameLocation=$("#dialog-options #chainSigNameLocation").val(),options.chain.routingLimit=1*$("#dialog-options #chainRoutingLimit").val(),options.chain.routeSecurity=$("#dialog-options #chainRouteSecurity").val(),options.chain.routeIgnore.enabled=$("#dialog-options #route-ignore-enabled").prop("checked"),options.chain.routeIgnore.systems=$("#dialog-options #route-ignore").val().split(",").map(e=>e.trim()),options.chain.gridlines=JSON.parse($("#dialog-options input[name=gridlines]:checked").val()),options.chain["node-reference"]=$("#dialog-options input[name=node-reference]:checked").val(),options.chain.renderer=$("#dialog-options #renderer").val(),options.signatures.editType=$("#dialog-options #editType").val(),options.signatures.pasteLife=$("#dialog-options #pasteLife").val(),options.signatures.copySeparator=$("#dialog-options #copySeparator").val(),options.background=$("#dialog-options #background-image").val(),options.uiscale=$("#dialog-options #uiscale-slider").slider("value"),options.masks.active!=$("#dialog-options input[name='mask']:checked").val()&&(e=!0),options.masks.active=$("#dialog-options input[name='mask']:checked").val(),options.apply(),options.save().done(function(){e&&($("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=[],tripwire.refresh("change"))}),$("#dialog-options").dialog("close"),$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!1).removeClass("ui-state-disabled"),$("#dialog-options input[name='mask']:checked").data("admin")?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")},Reset:function(){$("#dialog-confirm #msg").html("Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>"),$("#dialog-confirm").dialog("option",{buttons:{Reset:function(){options.reset(),options.apply(),$("#dialog-options").dialog("close"),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")},Close:function(){$(this).dialog("close")}},open:function(){$.ajax({url:"user_stats.php",type:"POST",dataType:"JSON"}).done(function(e){for(i in e.stats)for(x in e.stats[i])$("#optionsAccordion #"+x).text(e.stats[i][x]);$("#optionsAccordion #systems_visited").text(e.system_visits),$("#optionsAccordion #logins").text(e.account.logins),$("#optionsAccordion #lastLogin").text(e.account.lastLogin),$("#optionsAccordion #username").text(e.username)}),$.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(e){if(e&&e.masks){for(var a in $("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html(""),e.masks){var o=e.masks[a],i=$('<input type="radio" name="mask" id="mask'+a+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+a+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+e.masks[e.active].mask+"']").attr("checked",!0).trigger("change"),e.masks[e.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-options #editType").val(options.signatures.editType),$("#dialog-options #pasteLife").val(options.signatures.pasteLife),$("#dialog-options #copySeparator").val(options.signatures.copySeparator),$("#dialog-options #typeFormat").val(options.chain.typeFormat),$("#dialog-options #chainRoutingLimit").val(options.chain.routingLimit),$("#dialog-options #chainSigNameLocation").val(options.chain.sigNameLocation),$("#dialog-options #chainRouteSecurity").val(options.chain.routeSecurity),$("#dialog-options #route-ignore-enabled").prop("checked",options.chain.routeIgnore.enabled),$("#dialog-options #route-ignore").val(options.chain.routeIgnore.systems.join(",")),$("#dialog-options #renderer").val(options.chain.renderer),$("#dialog-options #classFormat").val(options.chain.classFormat),$("#dialog-options input[name='node-reference'][value='"+options.chain["node-reference"]+"']").prop("checked",!0),$("#dialog-options input[name='gridlines'][value='"+options.chain.gridlines+"']").prop("checked",!0),$("#dialog-options #background-image").val(options.background)},create:function(){$("#optionsAccordion").accordion({heightStyle:"content",collapsible:!0,active:!1}),$("#uiscale-slider").slider({min:.7,max:1.4,step:.05,value:options.uiscale||1,change:function(e,a){$("body").css("zoom",a.value)},slide:function(e,a){$("label[for='uiscale-slider']").html(a.value)}}),$("label[for='uiscale-slider']").html($("#uiscale-slider").slider("value")),$("#dialog-pwChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#pwForm").submit()},Cancel:function(){$(this).dialog("close")}},close:function(){$("#pwForm input[name='password'], #pwForm input[name='confirm']").val(""),$("#pwError").text("").hide()}}),$("#pwChange").click(function(){$("#dialog-pwChange").dialog("open")}),$("#pwForm").submit(function(e){e.preventDefault(),$("#pwError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?($("#dialog-msg #msg").text("Password changed"),$("#dialog-msg").dialog("open"),$("#dialog-pwChange").dialog("close")):e&&e.error?$("#pwError").text(e.error).show("slide",{direction:"up"}):$("#pwError").text("Unknown error").show("slide",{direction:"up"})})}),$("#dialog-usernameChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#usernameForm").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#usernameForm #username").html($("#dialog-options #username").html())},close:function(){$("#usernameForm [name='username']").val(""),$("#usernameError").text("").hide()}}),$("#usernameChange").click(function(){$("#dialog-usernameChange").dialog("open")}),$("#usernameForm").submit(function(e){e.preventDefault(),$("#usernameError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?($("#dialog-msg #msg").text("Username changed"),$("#dialog-msg").dialog("open"),$("#dialog-options #username").html(e.result),$("#dialog-usernameChange").dialog("close")):e&&e.error?$("#usernameError").text(e.error).show("slide",{direction:"up"}):$("#usernameError").text("Unknown error").show("slide",{direction:"up"})})}),$("#masks").on("change","input.selector:checked",function(){$(this).data("owner")?($("#maskControls #edit").removeAttr("disabled"),$("#maskControls #delete").removeAttr("disabled")):($("#maskControls #edit").attr("disabled","disabled"),$("#maskControls #delete").attr("disabled","disabled")),0!=$(this).val()&&0==$(this).val().split(".")[1]?$("#dialog-options #leave").removeAttr("disabled"):$("#dialog-options #leave").attr("disabled","disabled")}),$("#dialog-joinMask").dialog({autoOpen:!1,resizable:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){var e=$("#dialog-joinMask #results input:checked"),a=$("#dialog-joinMask #results input:checked+label");$.ajax({url:"masks.php",type:"POST",data:{mask:e.val(),mode:"join"},dataType:"JSON"}).done(function(o){o&&o.result&&(a.css("width",""),a.find(".info").remove(),a.append('<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>'),$("#dialog-options #masks #"+o.type+" input.selector:last").before(e).before(a),$("#dialog-joinMask").dialog("close"))})},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-joinMask form").submit(function(e){e.preventDefault(),$("#dialog-joinMask #results").html(""),$("#dialog-joinMask #loading").show(),$("#dialog-joinMask input[type='submit']").attr("disabled","disabled"),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).then(function(e){if(e&&e.results&&e.results.length)return tripwire.esi.fullLookup(e.eveIDs).done(function(a){if(a)for(var o in a){var i=e.results[o],t=$('<input type="radio" name="mask" id="mask'+i.mask+'" value="'+i.mask+'" class="selector" data-owner="false" data-admin="'+i.admin+'" /><label for="mask'+i.mask+'" style="width: 100%; margin-left: -5px;">\t<img src="'+i.img+'" />\t<span class="selector_label">'+i.label+'</span>\t<div class="info">\t\t'+a[o].name+"<br/>\t\t"+("character"==a[o].category?a[o].corporation.name+"<br/>":null)+"\t\t"+(a[o].alliance?a[o].alliance.name:"")+"<br/>\t</div></label>");$("#dialog-joinMask #results").append(t)}});e&&e.error?($("#dialog-error #msg").text(e.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))}).then(function(){$("#dialog-joinMask #loading").hide(),$("#dialog-joinMask input[type='submit']").removeAttr("disabled")})})},close:function(){$("#dialog-joinMask #results").html(""),$("#dialog-joinMask input[name='name']").val("")}}),$("#dialog-options #masks").on("click","input[name='find']+label",function(){$("#dialog-joinMask input[name='find']").val($(this).prev().val()),$("#dialog-joinMask").dialog("open")}),$("#dialog-options #masks").on("click",".closeIcon",function(){var e=$(this).closest("input.selector+label").prev();$("#dialog-confirm #msg").text("Are you sure you want to remove this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Remove:function(){var a={mode:"leave",mask:e.val()};$.ajax({url:"masks.php",type:"POST",data:a,dataType:"JSON"}).done(function(a){a&&a.result?(e.next().remove(),e.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#maskControls #delete").click(function(){var e=$("#masks input.selector:checked");$("#dialog-confirm #msg").text("Are you sure you want to delete this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Delete:function(){var a={mode:"delete",mask:e.val()};$.ajax({url:"masks.php",type:"POST",data:a,dataType:"JSON"}).done(function(a){a&&a.result?(e.next().remove(),e.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#dialog-createMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Create:function(){$("#dialog-createMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-createMask #accessList").on("click","#create_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-createMask form").submit(function(e){e.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?($.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(e){if(e&&e.masks){for(var a in $("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html(""),e.masks){var o=e.masks[a],i=$('<input type="radio" name="mask" id="mask'+a+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+a+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+e.masks[e.active].mask+"']").attr("checked",!0).trigger("change"),e.masks[e.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-createMask").dialog("close")):e&&e.error?($("#dialog-error #msg").text(e.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})}),$("#dialog-createMask select").selectmenu({width:100})},open:function(){$("#dialog-createMask input[name='name']").val(""),$("#dialog-createMask #accessList :not(.static)").remove()}}),$("#maskControls #create").click(function(){$("#dialog-createMask").dialog("open")}),$("#dialog-createMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().remove(),$(this).closest("label").remove()}),$("#dialog-editMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#dialog-editMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-editMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().attr("name","deletes[]").hide(),$(this).closest("label").hide()}),$("#dialog-editMask #accessList").on("click","#edit_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-editMask form").submit(function(e){e.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?$("#dialog-editMask").dialog("close"):e&&e.error?($("#dialog-error #msg").text(e.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})})},open:function(){var e=$("#dialog-options input[name='mask']:checked").val();$("#dialog-editMask input[name='mask']").val(e),$("#dialog-editMask #accessList label.static").hide(),$("#dialog-editMask #loading").show(),$("#dialog-editMask #name").text($("#dialog-options input[name='mask']:checked+label .selector_label").text()),$.ajax({url:"masks.php",type:"POST",data:{mode:"edit",mask:e},dataType:"JSON"}).then(function(e){if(e&&e.results&&e.results.length)return tripwire.esi.fullLookup(e.results).done(function(e){if(e)for(var a in e)if("character"==e[a].category){var o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+e[a].id+'_1373" value="'+e[a].id+'_1373" class="selector" /><label for="edit_'+e[a].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+e[a].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+e[a].corporation.name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}else if("corporation"==e[a].category){o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+e[a].id+'_2" value="'+e[a].id+'_2" class="selector" /><label for="edit_'+e[a].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+e[a].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}})}).then(function(e){$("#dialog-editMask #accessList label.static").show(),$("#dialog-editMask #loading").hide()})},close:function(){$("#dialog-editMask #accessList :not(.static)").remove()}}),$("#maskControls #edit").click(function(){$("#dialog-editMask").dialog("open")}),$("#dialog-EVEsearch").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){if($("#accessList input[value='"+$("#EVESearchResults input").val()+"']").length)return $("#dialog-error #msg").text("Already has access"),$("#dialog-error").dialog("open"),!1;$("#EVESearchResults .info").append('<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />'),$("#EVESearchResults input:checked").attr("checked","checked"),$("#EVESearchResults input:checked").attr("onclick","return false");var e=$("#EVESearchResults .maskNode:has(input:checked)");$("#dialog-createMask").dialog("isOpen")?$("#dialog-createMask #accessList .static:first").before(e):$("#dialog-editMask").dialog("isOpen")&&$("#dialog-editMask #accessList .static:first").before(e),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},create:function(){$("#EVEsearch").submit(function(e){if(e.preventDefault(),""==$("#EVEsearch input[name='name']").val())return!1;$("#EVESearchResults, #searchCount").html(""),$("#EVEsearch #searchSpinner").show(),$("#EVEsearch input[type='submit']").attr("disabled","disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").attr("disabled",!0).addClass("ui-state-disabled"),tripwire.esi.search($("#EVEsearch input[name='name']").val(),$("#EVEsearch input[name='category']:checked").val(),$("#EVEsearch input[name='exact']")[0].checked).done(function(e){if(e&&(e.character||e.corporation))return e=$.merge(e.character||[],e.corporation||[]),total=e.length,e=e.slice(0,10),tripwire.esi.fullLookup(e).done(function(e){if($("#EVEsearch #searchCount").html("Found: "+total+"<br/>Showing: "+(total<10?total:10)),e)for(var a in e)if("character"==e[a].category){var o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+e[a].id+'_1373" value="'+e[a].id+'_1373" class="selector" /><label for="find_'+e[a].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+e[a].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+e[a].corporation.name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}else if("corporation"==e[a].category){o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+e[a].id+'_2" value="'+e[a].id+'_2" class="selector" /><label for="find_'+e[a].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+e[a].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}}).always(function(){$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")});$("#dialog-error #msg").text("No Results"),$("#dialog-error").dialog("open"),$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")})})},close:function(){$("#EVEsearch input[name='name']").val(""),$("#EVESearchResults, #searchCount").html("")}})}}),$("#dialog-options").dialog("open")});
$("#dialog-ping").dialog({autoOpen:!1,height:"auto",dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Send:function(){var t={systemName:this.systemName,systemText:this.systemText,message:$("#ping-text").val()};const e=this;$.ajax({url:"ping.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){$(e).dialog("close")}).error(function(t){alert(t&&t.error?t.error:t)})},Cancel:function(){$(this).dialog("close")}},open:function(){const t=$(this).data("id"),e=$(this).data("systemID"),i=tripwire.client.wormholes[t],s=i?tripwire.client.signatures[i.initialID]:{name:null};this.systemName=tripwire.systems[e].name,this.systemText=this.systemName+(null!==s.name&&s.name.length?" ("+s.name+")":""),$("#dialog-ping").dialog("option","title","Ping about "+this.systemText),$("#ping-text").val(""),$("#ping-text").focus()}});
$("#signaturesWidget").on("click","#delete-signature",function(e){return e.preventDefault(),!$(this).closest("tr").attr("disabled")&&(0!=$("#sigTable tr.selected").length&&($("#dialog-sigEdit").hasClass("ui-dialog-content")&&$("#dialog-sigEdit").dialog("isOpen")?($("#dialog-sigEdit").parent().effect("shake",300),!1):void($("#dialog-deleteSig").hasClass("ui-dialog-content")?$("#dialog-deleteSig").dialog("isOpen")||$("#dialog-deleteSig").dialog("open"):$("#dialog-deleteSig").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("disable");var e={signatures:{remove:[]},systemID:viewingSystemID},i=[],t=$.map($("#sigTable tr.selected"),function(e){var t=tripwire.client.signatures[$(e).data("id")];if("wormhole"!=t.type)return i.push(t),t.id;var s=$.map(tripwire.client.wormholes,function(e){if(e.initialID==t.id||e.secondaryID==t.id)return e})[0];return i.push({wormhole:s,signatures:[tripwire.client.signatures[s.initialID],tripwire.client.signatures[s.secondaryID]]}),s});e.signatures.remove=t;tripwire.refresh("refresh",e,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#dialog-deleteSig").dialog("close"),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:i}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:i}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(e){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}},close:function(){$("#sigTable tr.selected").removeClass("selected")}}))))});
$("#sigTable tbody").on("dblclick","tr",{mode:"update",source:"sig-row"},openSignatureDialog),$("#edit-signature").on("click",{mode:"update",source:"edit-sig"},openSignatureDialog),$("#add-signature").click({mode:"add"},openSignatureDialog);const sigDialogVM={};function openSignatureDialog(e){switch(e.preventDefault&&e.preventDefault(),sigDialogVM.mode=e.data.mode,sigDialogVM.mode){case"update":if("sig-row"==e.data.source)$("#sigTable tr.selected").removeClass("selected"),$(this).closest("tr").addClass("selected"),sigDialogVM.sigId=$(this).data("id");else if("edit-sig"==e.data.source){var i=$("#sigTable tbody tr.selected");if(1!==i.length)return!1;sigDialogVM.sigId=$(i[0]).data("id")}else sigDialogVM.sigId=e.data.signature;break;default:delete sigDialogVM.sigId}sigDialogVM.viewingSystemID=sigDialogVM.sigId?tripwire.client.signatures[sigDialogVM.sigId].systemID:viewingSystemID,sigDialogVM.viewingSystem=tripwire.systems[sigDialogVM.viewingSystemID],$("#dialog-signature").hasClass("ui-dialog-content")?$("#dialog-signature").dialog("isOpen")||$("#dialog-signature").dialog("open"):$("#dialog-signature").dialog({autoOpen:!0,resizable:!1,dialogClass:"dialog-noeffect ui-dialog-shadow",position:{my:"center",at:"center",of:$("#signaturesWidget")},buttons:{Save:function(){$("#form-signature").submit()},Add:function(){$("#form-signature").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){var e=$.map(tripwire.wormholes,function(e,i){return i});e.splice(26,0,"K162"),e.push("GATE"),e.push("SML"),e.push("MED"),e.push("LRG"),e.push("XLG"),$("#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']").selectmenu({width:100}),$("#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']").selectmenu({width:80}),$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#dialog-signature [data-autocomplete='sigType']").inlinecomplete({source:e,maxSize:10,delay:0}),$("#dialog-signature #durationPicker").durationPicker(),$("#dialog-signature #durationPicker").on("change",function(){this.value<0&&(this.value=0,$(this).change())}),$("#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']").on("input",function(){for(;!/^[a-zA-Z?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature [name='signatureID_Alpha']").on("input",function(){3===this.value.length&&$("#dialog-signature [name='signatureID_Numeric']").select()}),$("#dialog-signature [name='signatureID2_Alpha']").on("input",function(){3===this.value.length&&$("#dialog-signature [name='signatureID2_Numeric']").select()}),$("#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']").on("input",function(){for(;!/^[0-9?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature .signatureID, #dialog-signature .wormholeType").on("click",function(){$(this).select()}),$("#dialog-signature .wormholeType").on("input, change",function(){this.value.length>0&&-1!=$.inArray(this.value.toUpperCase(),e)&&"K162"!=this.value.toUpperCase()?($("#dialog-signature .wormholeType").not(this).val("K162"),tripwire.wormholes[this.value.toUpperCase()]&&$("#dialog-signature #durationPicker").val(60*tripwire.wormholes[this.value.toUpperCase()].life.substring(0,2)*60).change()):"K162"===this.value.toUpperCase()?-1!==$.inArray($("#dialog-signature .wormholeType").not(this).val().toUpperCase(),e)&&"K162"!==$("#dialog-signature .wormholeType").not(this).val().toUpperCase()||$("#dialog-signature .wormholeType").not(this).val("????"):"????"==this.value&&$("#dialog-signature .wormholeType").not(this).val("K162")}),$("#dialog-signature").on("selectmenuchange","[name='signatureType']",function(){"wormhole"==this.value?($("#dialog-signature #site").slideUp(200,function(){$(this).hide(0)}),$("#dialog-signature #wormhole").slideDown(200,function(){$(this).show(200)})):($("#dialog-signature #site").slideDown(200,function(){$(this).show(200)}),$("#dialog-signature #wormhole").slideUp(200,function(){$(this).hide(0)})),ValidationTooltips.close()}),$("#form-signature").submit(function(i){i.preventDefault();var t=$(this).serializeObject(),a=!0;if(ValidationTooltips.close(),$.each($("#dialog-signature .signatureID:visible"),function(){if(this.value.length>0&&this.value.length<3)return ValidationTooltips.open({target:$(this)}).setContent("Must be 3 characters in length!"),$(this).select(),a=!1,!1}),!a)return!1;if(3===t.signatureID_Alpha.length&&3===t.signatureID_Numeric.length&&0!=Object.find(tripwire.client.signatures,"signatureID",t.signatureID_Alpha+t.signatureID_Numeric,!0)&&Object.find(tripwire.client.signatures,"signatureID",t.signatureID_Alpha+t.signatureID_Numeric,!0).id!=$("#dialog-signature").data("signatureid")){let e={signatures:{remove:[]},systemID:viewingSystemID},i=[];if(currentSignature=Object.find(tripwire.client.signatures,"signatureID",t.signatureID_Alpha+t.signatureID_Numeric),"wormhole"!=currentSignature.type)i.push(currentSignature),e.signatures.remove.push(currentSignature.id);else{let t=$.map(tripwire.client.wormholes,function(e){if(e.initialID==currentSignature.id||e.secondaryID==currentSignature.id)return e})[0];i.push({wormhole:t,signatures:[tripwire.client.signatures[t.initialID],tripwire.client.signatures[t.secondaryID]]}),e.signatures.remove.push(t)}return tripwire.refresh("refresh",e,function(e){e.resultSet&&1==e.resultSet[0].result&&(ValidationTooltips.close(),$("#undo").removeClass(".disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:i}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:i}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),$("#dialog-signature").parent().find(":button:contains('Save')")?$("#dialog-signature").parent().find(":button:contains('Save')").click():$("#dialog-signature").parent().find(":button:contains('Add')").click())}),$("#overwrite").focus(),a=!1,!1}if(!a)return!1;if($.each($("#dialog-signature .wormholeType:visible"),function(){if(this.value.length>0&&-1==$.inArray(this.value.toUpperCase(),e)&&"????"!=this.value)return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid wormhole type!"),$(this).select(),a=!1,!1}),!a)return!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if(this.value.length>0&&-1==tripwire.aSigSystems.findIndex(e=>this.value.toLowerCase()===e.toLowerCase()))return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid leads to system!"),$(this).select(),a=!1,!1}),!a)return!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if(this.value.length>0&&this.value.toLowerCase()===sigDialogVM.viewingSystem.name.toLowerCase())return ValidationTooltips.open({target:$(this)}).setContent("Wormhole cannot lead to the same system it comes from!"),$(this).select(),a=!1,!1}),!a)return!1;var s={},r=[];if("wormhole"===t.signatureType){var n={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:sigDialogVM.viewingSystemID,type:"wormhole",name:t.wormholeName,lifeLength:t.signatureLength},o=null;Object.index(tripwire.systems,"name",t.leadsTo,!0)?o=Object.index(tripwire.systems,"name",t.leadsTo,!0):tripwire.wormholes[t.wormholeType.toUpperCase()]?tripwire.aSigSystems.findIndex(e=>tripwire.wormholes[t.wormholeType.toUpperCase()].leadsTo.replace(" ","-").toLowerCase()===e.toLowerCase())>-1&&(o=tripwire.aSigSystems.findIndex(e=>tripwire.wormholes[t.wormholeType.toUpperCase()].leadsTo.replace(" ","-").toLowerCase()===e.toLowerCase())):-1!==tripwire.aSigSystems.findIndex(e=>t.leadsTo.toLowerCase()===e.toLowerCase())&&(o=tripwire.aSigSystems.findIndex(e=>t.leadsTo.toLowerCase()===e.toLowerCase()));var l={signatureID:t.signatureID2_Alpha+t.signatureID2_Numeric,systemID:o,type:"wormhole",name:t.wormholeName2,lifeLength:t.signatureLength},g=null,u=null;t.wormholeType.length>0&&-1!=$.inArray(t.wormholeType.toUpperCase(),e)&&"K162"!=t.wormholeType.toUpperCase()?(u="initial",g=t.wormholeType.toUpperCase()):t.wormholeType2.length>0&&-1!=$.inArray(t.wormholeType2.toUpperCase(),e)&&"K162"!=t.wormholeType2.toUpperCase()?(u="secondary",g=t.wormholeType2.toUpperCase()):"K162"==t.wormholeType.toUpperCase()?(u="secondary",g="????"):"K162"==t.wormholeType2.toUpperCase()&&(u="initial",g="????");var d={type:g,parent:u,life:t.wormholeLife,mass:t.wormholeMass};"update"==sigDialogVM.mode?(n.id=$("#dialog-signature").data("signatureid"),l.id=$("#dialog-signature").data("signature2id"),d.id=$("#dialog-signature").data("wormholeid"),tripwire.client.wormholes[d.id]&&(t.wormholeType.length>0&&-1!=$.inArray(t.wormholeType.toUpperCase(),e)&&"K162"!=t.wormholeType.toUpperCase()?(d.parent=tripwire.client.wormholes[d.id].initialID==n.id?"initial":"secondary",d.type=t.wormholeType.toUpperCase()):t.wormholeType2.length>0&&-1!=$.inArray(t.wormholeType2.toUpperCase(),e)&&"K162"!=t.wormholeType2.toUpperCase()?(d.parent=tripwire.client.wormholes[d.id].initialID==n.id?"secondary":"initial",d.type=t.wormholeType2.toUpperCase()):"K162"==t.wormholeType.toUpperCase()?(d.parent=tripwire.client.wormholes[d.id].initialID==n.id?"secondary":"initial",d.type="????"):"K162"==t.wormholeType2.toUpperCase()&&(d.parent=tripwire.client.wormholes[d.id].initialID==n.id?"initial":"secondary",d.type="????")),s={signatures:{update:[{wormhole:d,signatures:[n,l]}]}},tripwire.client.wormholes[d.id]?r.push({wormhole:tripwire.client.wormholes[d.id],signatures:[tripwire.client.signatures[n.id],tripwire.client.signatures[l.id]]}):r.push(tripwire.client.signatures[n.id])):s={signatures:{add:[{wormhole:d,signatures:[n,l]}]}}}else{if("update"==sigDialogVM.mode)if(s={signatures:{update:[n={id:$("#dialog-signature").data("signatureid"),signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:sigDialogVM.viewingSystemID,type:t.signatureType,name:t.signatureName,lifeLength:t.signatureLength}]}},"wormhole"==tripwire.client.signatures[n.id].type){d=$.map(tripwire.client.wormholes,function(e){if(e.initialID==n.id||e.secondaryID==n.id)return e})[0],l=n.id==d.initialID?tripwire.client.signatures[d.secondaryID]:tripwire.client.signatures[d.initialID];r.push({wormhole:tripwire.client.wormholes[d.id],signatures:[tripwire.client.signatures[n.id],tripwire.client.signatures[l.id]]})}else r.push(tripwire.client.signatures[n.id]);else s={signatures:{add:[n={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:sigDialogVM.viewingSystemID,type:t.signatureType,name:t.signatureName,lifeLength:t.signatureLength}]}}}$("#dialog-signature").parent().find(":button:contains('Save')").button("disable");tripwire.refresh("refresh",s,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#dialog-signature").dialog("close"),$("#undo").removeClass("disabled"),"add"==sigDialogVM.mode&&(r=e.results),sigDialogVM.viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[sigDialogVM.viewingSystemID].push({action:sigDialogVM.mode,signatures:r}):tripwire.signatures.undo[sigDialogVM.viewingSystemID]=[{action:sigDialogVM.mode,signatures:r}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(){$("#sigEditForm input[type=submit]").removeAttr("disabled"),$("#dialog-signature").parent().find(":button:contains('Save')").button("enable")})})},open:function(){$("#dialog-signature").data("signatureid",""),$("#dialog-signature").data("signature2id",""),$("#dialog-signature").data("wormholeid",""),$("#dialog-signature input").val(""),$("#dialog-signature [name='signatureType']").val("unknown").selectmenu("refresh"),$("#dialog-signature [name='wormholeLife']").val("stable").selectmenu("refresh"),$("#dialog-signature [name='wormholeMass']").val("stable").selectmenu("refresh"),$("#dialog-signature #site").show(),$("#dialog-signature #wormhole").hide(),$("#dialog-signature .sideLabel:first").html(sigDialogVM.viewingSystem.name+" Side"),$("#dialog-signature .sideLabel:last").html("Other Side"),$("#dialog-signature #durationPicker").val(60*options.signatures.pasteLife*60).change();var e=sigDialogVM.sigId;if("update"==sigDialogVM.mode&&e&&tripwire.client.signatures[e]){var i=tripwire.client.signatures[e];if($("#dialog-signature").data("signatureid",e),$("#dialog-signature").parent().find("button:contains('Add')").hide(),$("#dialog-signature").parent().find("button:contains('Save')").show(),$("#dialog-signature").dialog("option","title","Edit Signature"),"wormhole"==i.type){var t=$.map(tripwire.client.wormholes,function(i){if(i.initialID==e||i.secondaryID==e)return i})[0],a=e==t.initialID?tripwire.client.signatures[t.secondaryID]:tripwire.client.signatures[t.initialID];$("#dialog-signature").data("signature2id",a.id),$("#dialog-signature").data("wormholeid",t.id);const s=i.signatureID?i.signatureID.substr(0,3):"???";$("#dialog-signature input[name='signatureID_Alpha']").val(s),$("#dialog-signature input[name='signatureID_Numeric']").val(i.signatureID?i.signatureID.substr(3,5):""),$("#dialog-signature [name='signatureType']").val(i.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='wormholeName']").val(i.name),$("#dialog-signature [name='leadsTo']").val(tripwire.systems[a.systemID]?tripwire.systems[a.systemID].name:tripwire.aSigSystems[a.systemID]?tripwire.aSigSystems[a.systemID]:""),$("#dialog-signature input[name='signatureID2_Alpha']").val(a.signatureID?a.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID2_Numeric']").val(a.signatureID?a.signatureID.substr(3,5):""),$("#dialog-signature [name='wormholeName2']").val(a.name),$("#dialog-signature [name='wormholeLife']").val(t.life).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='wormholeMass']").val(t.mass).selectmenu("refresh").trigger("selectmenuchange"),t[t.parent+"ID"]==i.id?$("#dialog-signature input[name='wormholeType']").val(t.type).change():t[t.parent+"ID"]==a.id&&$("#dialog-signature input[name='wormholeType2']").val(t.type).change(),$("#dialog-signature #durationPicker").val(i.lifeLength).change(),"???"!=s?$("#dialog-signature input[name='wormholeName']").select():$("#dialog-signature input[name='signatureID_Alpha']").select()}else $("#dialog-signature input[name='signatureID_Alpha']").val(i.signatureID?i.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID_Numeric']").val(i.signatureID?i.signatureID.substr(3,5):""),$("#dialog-signature [name='signatureType']").val(i.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='signatureName']").val(i.name),$("#dialog-signature #durationPicker").val(i.lifeLength).change(),$("#dialog-signature input[name='signatureID_Alpha']").select()}else $("#dialog-signature").parent().find("button:contains('Add')").show(),$("#dialog-signature").parent().find("button:contains('Save')").hide(),$("#dialog-signature").dialog("option","title","Add Signature"),$("#dialog-signature [name='signatureType']").val(options.signatures.editType||"unknown").selectmenu("refresh"),"wormhole"===$("#dialog-signature [name='signatureType']").val()&&($("#dialog-signature #site").hide(),$("#dialog-signature #wormhole").show())},close:function(){ValidationTooltips.close(),$("#sigTable tr.selected").removeClass("selected"),$("#dialog-signature").data("signatureid",""),$("#dialog-signature").data("signature2id",""),$("#dialog-signature").data("wormholeid","")}})}
const invasions=new _Invasions;function _Invasions(){const i=this,s={stellar_reconnaissance:"◆",triglavian_minor_victory:"▽",escalating_liminality:"▽",final_liminality:"▼",edencom_minor_victory:"△",redoubt:"△",bulwark:"△",fortress:"▲"},t={stellar_reconnaissance:"Stellar Reconnaissance",triglavian_minor_victory:"Triglavian Minor Victory",escalating_liminality:"Escalating Liminality",final_liminality:"Final Liminality",edencom_minor_victory:"EDENCOM Minor Victory",redoubt:"Redoubt",bulwark:"Bulwark",fortress:"EDENCOM Fortress"};this.invasions={},this.mutate=function(i,n){const a=this.invasions[n];if(a){a.derived_security_status&&(i.security=1*a.derived_security_status),i.pathSymbol=s[a.status];const n=t[a.status]+(a.derived_security_status?"<br>Effective security lowered to "+a.derived_security_status:"");i.systemTypeModifiers.push('<span class="invasion '+a.status+'" data-tooltip="'+n+'">'+i.pathSymbol+"</span>")}},this.refresh=function(){$.ajax({url:"cached_third_party.php?key=invasions",type:"GET",dataType:"JSON"}).done(function(s,t,n){_.isEqual(s,i.invasions)||(console.info("Updating map for invasions update"),i.invasions=_.keyBy(s,function(i){return i.system_id}),chain.redraw(),tripwire.systemChange(viewingSystemID))}).fail(function(i,s,t){console.warn("Failed to fetch invasion data from kybernaut.space: "+s,t)})},setInterval(this.refresh,36e5),this.refresh()}systemAnalysis.addMutator(invasions);
//# sourceMappingURL=app.min.js.map
