Object.sort=function(e,t){var n,r;do{for(var i in n=!1,r=null,e){if(r&&Number(e[i][t])<Number(e[r][t])){var o=e[i];e[i]=e[r],e[r]=o,n=!0}r=i}}while(n)},Object.index=function(e,t,n,r){for(var i in e){if(!r&&e[i][t]==n)return i;if(e[i][t]&&e[i][t].toLowerCase()==n.toLowerCase())return i}},Object.find=function(e,t,n,r){for(var i in e){if(!r&&e[i][t]==n)return e[i];if(e[i][t]&&e[i][t].toLowerCase()==n.toLowerCase())return e[i]}return!1},Object.maxTime=function(e,t){var n,r="";for(var i in e)(!n||n<new Date(e[i][t]))&&(n=new Date(e[i][t]),r=e[i][t]);return r},Object.time=function(e){var t,n=[];for(t in e)n.push(new Date(e[t].time));return n.length?n.sort()[n.length-1].getTime()/1e3:0},function(e){e.fn.serializeObject=function(){var t=this,n={},r={},i={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,t,n){return e[t]=n,e},this.push_counter=function(e){return void 0===r[e]&&(r[e]=0),r[e]++},e.each(e(this).serializeArray(),function(){if(i.validate.test(this.name)){for(var r,o=this.name.match(i.key),a=this.value,s=this.name;void 0!==(r=o.pop());)s=s.replace(new RegExp("\\["+r+"\\]$"),""),r.match(i.push)?a=t.build([],t.push_counter(s),a):r.match(i.fixed)?a=t.build([],r,a):r.match(i.named)&&(a=t.build({},r,a));n=e.extend(!0,n,a)}}),n}}(jQuery);var letterToNumbers=function(e){e=e.toUpperCase();var t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=0;for(t=0;t<e.length;t++)r+=Math.pow(n.length,t)*(n.indexOf(e.substr(-1*(t+1),1))+1);return r},sigFormat=function(e,t){if(!e)return"";for(var n=/^[a-zA-Z]+$/,r=/^[0-9]+$/,i="type"==t?options.chain.typeFormat||"":options.chain.classFormat||"",o=0,a=i.length;o<a;o++)if(i[o].match(n)){if("B"==i[o].toUpperCase()&&"a"==e)return"";i=i[o]==i[o].toUpperCase()?i.substr(0,o)+e.toUpperCase()+i.substr(o+1,a):i.substr(0,o)+e+i.substr(o+1,a)}else if(i[o].match(r)){if(2==i[o]&&"a"==e)return"";i=i.substr(0,o)+letterToNumbers(e)+i.substr(o+1,a)}return i};function positionRelativeTo(e,t){const n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{left:n.left-r.left+t.scrollLeft,top:n.top-r.top+t.scrollTop}}function lookupMultiple(e,t,n,r){const i=n.split(","),o=[];for(var a=0;a<i.length;a++){const n=i[a],s=e[n];if(!s){if(r)return;throw"Value "+n+" did not match anything in "+e}o.push(s[t])}return o.join(",")}var getCookie=function(e){var t=document.cookie,n=t.indexOf(" "+e+"=");if(-1==n&&(n=t.indexOf(e+"=")),-1==n)t=null;else{n=t.indexOf("=",n)+1;var r=t.indexOf(";",n);-1==r&&(r=t.length),t=unescape(t.substring(n,r))}return t},setCookie=function(e,t,n){var r=new Date;r.setDate(r.getDate()+n);var i=escape(t)+(null==n?"":"; expires="+r.toUTCString());document.cookie=e+"="+i+";"+("https:"==document.location.protocol?"secure;":"")};!function(e){var t=e.fn.addClass,n=e.fn.removeClass;e.fn.addClass=function(e){var n=t.apply(this,arguments);return this.trigger("classchange",e),n},e.fn.removeClass=function(e){var t=n.apply(this,arguments);return this.trigger("classchange",e),t}}(jQuery);
const eveScout=new _EveScoutSignatureConnection;function _EveScoutSignatureConnection(){const t=this;this.links=[],this.active=function(){return"undefined"!=typeof options&&options.chain.tabs[options.chain.active]&&options.chain.tabs[options.chain.active].evescout},this.nodeNameSuffix="eve-scout",this.findLinks=function(t,e){if(!this.active())return[];const i=[];for(var s=0;s<this.links.length;s++){const n=this.links[s],a="ES-"+n.id,o={life:n.remaining_hours>=4?"stable":"critical",mass:"stable",id:a};n.out_system_id==t?i.push(Object.assign({parent:{id:e.parentID,systemID:t,signatureID:n.in_signature,type:n.wh_exits_outward?n.wh_type:"K162"},child:{id:e.nextChildID++,systemID:n.in_system_id,signatureID:n.out_signature,type:n.wh_exits_outward?"K162":n.wh_type}},o)):n.in_system_id==t&&i.push(Object.assign({parent:{id:e.parentID,systemID:t,signatureID:n.out_signature,type:n.wh_exits_outward?"K162":n.wh_type},child:{id:e.nextChildID++,systemID:n.out_system_id,signatureID:n.in_signature,type:n.wh_exits_outward?n.wh_type:"K162"}},o))}return i},this.refresh=function(){t.active()&&$.ajax({url:"cached_third_party.php?key=eve-scout-signatures",type:"GET",dataType:"JSON"}).done(function(e,i,s){_.isEqual(e,t.links)||(console.info("Updating map for EvE Scout update"),t.links=e,chain.redraw())}).fail(function(t,e,i){console.warn("Failed to fetch signatures from eve-scout.com: "+e,i)})},setInterval(this.refresh,6e4),setTimeout(this.refresh,0)}
function findSystemID(e){for(let t in appData.systems)if(appData.systems[t].name.toUpperCase()===e.toUpperCase())return t}var viewingSystem=$("meta[name=system]").attr("content"),viewingSystemID=findSystemID(viewingSystem),server=$("meta[name=server]").attr("content"),app_name=$("meta[name=app_name]").attr("content"),version=$("meta[name=version]").attr("content");"true"==getCookie("loadedFromBrowserCache")&&$("#pageTime").html("Page is Cached"),viewingSystemID||(window.stop(),window.location="?system=Jita");
var options=new function(){var t,i=["grid"],s=JSON.parse(localStorage.getItem("tripwire_options"));this.userID=init.userID,this.character={id:init.characterID,name:init.characterName},this.background=null,this.uiscale=1,this.favorites=[],this.grid={},this.tracking={active:"new"},this.masks={active:init.corporationID+".2"},this.chain={typeFormat:null,classFormat:null,gridlines:!0,aura:!0,active:0,tabs:[],"node-reference":"type",zoom:1,sigNameLocation:"name",routingLimit:15,routeSecurity:"shortest",routeIgnore:{enabled:!1,systems:["Tama","Rancer"]},renderer:"radial",nodeSpacing:{x:1,y:1}},this.signatures={editType:"unknown",copySeparator:",",pasteLife:72,alignment:{sigID:"centerAlign",sigType:"centerAlign",sigAge:"centerAlign",leadsTo:"centerAlign",sigLife:"centerAlign",sigMass:"centerAlign"}},this.buttons={follow:!1,chainWidget:{viewing:!1,favorites:!1},signaturesWidget:{autoMapper:!1}},this.saveDelay=function(i){t&&clearTimeout(t),t=setTimeout("options.save()",i)},this.save=function(){var t=JSON.stringify(window.options.get());return localStorage.setItem("tripwire_options",t),$.ajax({url:"options.php",data:{mode:"set",options:t},type:"POST",dataType:"JSON"})},this.load=function(t){t&&void 0!==t?this.set(this,t):s&&this.set(this,s),this.apply(),tripwire&&set_tracking_text()},this.get=function(){var t={};for(var i in this)"function"!=typeof this[i]&&(t[i]=this[i]);return t},this.set=function(t,i){for(var s in i)i[s]&&i[s].constructor&&i[s].constructor===Object?t&&this.set(t[s],i[s]):t&&void 0!==t[s]&&(t[s]=i[s])},this.reset=function(){for(var t in this)"function"!=typeof this[t]&&(this[t]=JSON.parse(JSON.stringify(this.reset.defaults[t])))},this.apply=function(){if(s)for(key in i)this[i[key]]=s[i[key]];if(this.grid.hasOwnProperty("oog")&&Object.keys(this.grid.oog||{}).length?$.each(this.grid.oog,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}):Object.keys(this.grid||{}).length&&$.each(this.grid,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}),this.favorites=$.map(this.favorites,function(t){return parseInt(t)}),this.buttons.follow&&$("#follow").addClass("active"),this.buttons.chainWidget.home&&$("#home").addClass("active"),this.buttons.chainWidget.kspace&&$("#k-space").addClass("active"),this.buttons.chainWidget.viewing&&$("#show-viewing").addClass("active"),this.buttons.chainWidget.favorites&&$("#show-favorite").addClass("active"),this.buttons.chainWidget.evescout&&$("#eve-scout").addClass("active"),-1!==$.inArray(parseInt(viewingSystemID),this.favorites)&&$("#system-favorite").attr("data-icon","star").addClass("active"),this.buttons.signaturesWidget.autoMapper&&$("#toggle-automapper").addClass("active"),this.uiscale&&$("body").css("zoom",this.uiscale),this.chain.zoom&&$("#chainParent").css("zoom",this.chain.zoom),this.background){var t=$("<a>",{href:this.background})[0];$("#wrapper").attr("style","background-image: url(https://"+t.hostname+t.pathname+t.search+");")}else $("#wrapper").attr("style","");for(var e in $("#dialog-options #characters").html("<img src='https://image.eveonline.com/Character/"+init.characterID+"_64.jpg' />"),$("#dialog-options input[name='mask']").filter("[value='"+this.masks.active+"']").attr("checked",!0),$("#chainTabs").html(""),this.chain.tabs)if(this.chain.tabs[e]){var a=$("#chainTab .tab").clone();a.attr("id",e).find(".name").data("tab",this.chain.tabs[e].systemID).html(this.chain.tabs[e].name),e==this.chain.active&&a.addClass("current"),$("#chainTabs").append(a)}guidance&&guidance.clearCache(),"undefined"!=typeof tripwire&&chain.redraw()},this.reset.defaults=JSON.parse(JSON.stringify(this.get())),this.load(init&&init.options?init.options:null)};
var grid=$(".gridster ul").gridster({widget_selector:"li.gridWidget",avoid_overlapped_widgets:!1,widget_base_dimensions:[50,50],widget_margins:[5,5],autogrow_cols:!0,helper:"clone",draggable:{start:function(i,e){$("div.gridster").width($("div.gridster ul").width())}},resize:{enabled:!0,handle_class:"grid-resize",min_size:[4,4],start:function(i){$("div.gridster").width($("div.gridster ul").width())},stop:function(i,e,s){switch(s.attr("id")){case"infoWidget":setTimeout("activity.redraw();",300)}}},serialize_params:function(i,e){return{id:i.attr("id"),col:e.col,row:e.row,size_x:e.size_x,size_y:e.size_y,width:i.width(),height:i.height()}}}).data("gridster").disable();grid.disable_resize(),$(".grid-resize").addClass("hidden").attr("data-icon","resize"),$(".gridster").css({visibility:"visible"}),$(".gridster > *").addClass("gridster-transition"),$("#layout").click(function(){$(this).hasClass("active")?(grid.disable(),grid.disable_resize(),$(".grid-resize").addClass("hidden"),$(this).removeClass("active"),options.grid=grid.serialize(),options.save()):(grid.enable(),grid.enable_resize(),$(".grid-resize").removeClass("hidden"),$(this).addClass("active"))});
var tripwire=new function(){this.timer,this.xhr,this.version=version,this.client={signatures:{},wormholes:{}},this.server={signatures:{},wormholes:{}},this.signatures={list:{},undo:JSON.parse(sessionStorage.getItem("tripwire_undo"))||{},redo:JSON.parse(sessionStorage.getItem("tripwire_redo"))||{}},this.serverSignatureCount=0,this.activity={},this.data={tracking:{},esi:{}},this.refreshRate=5e3,this.connected=!0,this.ageFormat="HM",this.instance=window.name?window.name:((new Date).getTime(),window.name=(new Date).getTime()/1e3);var e=this;this.stop=function(){return clearTimeout(this.timer),this.timer},this.start=function(){return this.sync()},this.setAgeFormat=function(e){e=void 0!==e?e:this.ageFormat;return $("span[data-age]").each(function(){$(this).countdown("option",{format:e})}),!0},this.serverTime=function(){this.time,this.serverTime.getTime=function(){return tripwire.serverTime.time}},this.serverTime(),this.chainMap=function(){this.chainMap.parse=function(e){chain.draw(e)}},this.chainMap(),this.pastEOL=function(){var e={since:$(this).countdown("option","until"),format:"HM",layout:"-{hnn}{sep}{mnn}&nbsp;"};$(this).countdown("option",e)},this.whTooltip=function(e){if(viewingSystemID==e.systemID)if($.inArray(e.type,$.map(appData.wormholes,function(e,t){return t}))>=0)var t=e.type,s="";else s="<b>Type:</b> "+((t=e.sig2Type)||"Unknown")+"<br/>";else if($.inArray(e.sig2Type,$.map(appData.wormholes,function(e,t){return t}))>=0)t=e.sig2Type,s="";else s="<b>Type:</b> "+((t=e.type)||"Unknown")+"<br/>";if($.inArray(t,$.map(appData.wormholes,function(e,t){return t}))>=0)var a=!0;else a=!1;if(s+="<b>Life:</b> "+(a?appData.wormholes[t].life:"Unknown")+"<br/>",a){switch(appData.wormholes[t].leadsTo.split("-")[0]){case"High":s+="<b>Leads To:</b> <span class='hisec'>"+appData.wormholes[t].leadsTo+"</span><br/>";break;case"Low":s+="<b>Leads To:</b> <span class='lowsec'>"+appData.wormholes[t].leadsTo+"</span><br/>";break;case"Null":s+="<b>Leads To:</b> <span class='nullsec'>"+appData.wormholes[t].leadsTo+"</span><br/>";break;case"Class":s+="<b>Leads To:</b> <span class='wh'>"+appData.wormholes[t].leadsTo+"</span><br/>";break;default:s+="<b>Leads To:</b> <span>"+appData.wormholes[t].leadsTo+"</span><br/>"}s+="<b>Max Mass</b>: "+Intl.NumberFormat().format(tripwire.wormholes[t].mass)+" Kg<br/>",s+="<b>Max Jumpable</b>: "+Intl.NumberFormat().format(tripwire.wormholes[t].jump)+" Kg<br/>"}return s},this.ageTooltip=function(e){var t=new Date(e.lifeTime),s='<table class="age-tooltip-table"><tr><th>Created:</th><td>'+(t.getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td><td>"+e.createdByName.replace(/'/g,"&#39;").replace(/"/g,"&#34;")+"</td></tr>";return e.lifeTime!=e.modifiedTime&&(s+="<tr><th>Last Modified:</th><td>"+((t=new Date(e.modifiedTime)).getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td><td>"+e.modifiedByName.replace(/'/g,"&#39;").replace(/"/g,"&#34;")+"</td></tr>"),s+="</table>"},this.refresh=function(e,t,s,a){e=e||"refresh";this.sync(e,t,s,a)},this.getSystemIDsByNames=function(t){if(!e.systems)return"";const s=t.split(","),a=[];for(var i=0;i<s.length;i++)for(systemID in e.systems){if(e.systems[systemID].name.toLowerCase()==s[i].toLowerCase()){a.push(systemID);break}}return s.length!=a.length?"":a.join(",")}};
function set_tracking_text(){tripwire.esi.characters[options.tracking.active]?(document.getElementById("user-track-name").textContent=tripwire.esi.characters[options.tracking.active].characterName,document.getElementById("user-track").style.display="",document.getElementById("user-no-track").style.display="none"):(document.getElementById("user-track").style.display="none",document.getElementById("user-no-track").style.display="")}$("body").on("click","a[href^='.?system=']",function(e){e.preventDefault();var t=$(this).attr("href").replace(".?system=",""),i=Object.index(tripwire.systems,"name",t);tripwire.systemChange(i)}),$("body").on("submit","#systemSearch",function(e){e.preventDefault();var t=$(this).find("[name='system']").val(),i=Object.index(tripwire.systems,"name",t,!0)||!1;!1!==i&&(tripwire.systemChange(i),$(this).find("[name='system']").val(""),$("#search").click())}),$("body").on("click","#undo:not(.disabled)",function(){tripwire.undo()}),$("body").on("click","#redo:not(.disabled)",function(){tripwire.redo()}),$("#chainParent").on("mousewheel",function(e){if(e.ctrlKey){e.preventDefault();var t=parseFloat($("#chainParent").css("zoom"))||1;e.originalEvent.wheelDelta/120>0&&t<2?$("#chainParent").css("zoom",t+.1):e.originalEvent.wheelDelta/120<0&&t>.6&&$("#chainParent").css("zoom",t-.1),$("#chain-zoom-reset").fadeIn(200),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout('$("#chain-zoom-reset").fadeOut(200);',3e3),options.chain.zoom=parseFloat($("#chainParent").css("zoom")),options.saveDelay(2e3)}}),$("#chain-zoom-reset").on("click",function(){$("#chainParent").css("zoom",1),options.chain.zoom=1,options.saveDelay(2e3)}),$(document).keydown(function(e){if(!$(document.activeElement).is("textarea, input"))if(e.metaKey||e.ctrlKey)if(89!==e.keyCode||$("#redo").hasClass("disabled"))if(90!==e.keyCode||$("#undo").hasClass("disabled")){if(65===e.keyCode)e.preventDefault(),$("#sigTable tbody tr").addClass("selected"),$("#signaturesWidget #delete-signature").trigger("delete:refresh");else if(67===e.keyCode&&""===window.getSelection().toString()){var t="";$("#sigTable tbody tr.selected").each(function(e){var i=tripwire.client.signatures[$(this).data("id")];e=[];if(i.signatureID?e.push(i.signatureID.substring(0,3).toUpperCase()+"-"+(i.signatureID.substring(3,6)||"###")):e.push("null"),e.push(i.type),"wormhole"===i.type){var a=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0],s=i.id==a.initialID?tripwire.client.signatures[a.secondaryID]:tripwire.client.signatures[a.initialID];e.push(a.type||"null"),e.push(tripwire.systems[i.systemID]?tripwire.systems[i.systemID].name:appData.genericSystemTypes[i.systemID]),e.push(tripwire.systems[s.systemID]?tripwire.systems[s.systemID].name:appData.genericSystemTypes[s.systemID]),e.push(a.life),e.push(a.mass)}else e.push(i.name);e.push(i.createdByName),e.push(i.lifeTime),e.push(i.lifeLength),e.push(i.lifeLeft),e.push(i.modifiedByName),e.push(i.modifiedTime),t+=e.join(options.signatures.copySeparator)+"\r\n"}),$("#clipboard").text(t),$("#clipboard").focus(),$("#clipboard").select()}}else e.preventDefault(),$("#undo").click(),Notify.trigger("Undoing last action");else e.preventDefault(),$("#redo").click(),Notify.trigger("Redoing last undo");else 46==e.keyCode&&$("#sigTable tr.selected").length>0&&$("#delete-signature").click()}),$("#follow").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.follow=$(this).hasClass("active"),options.save()}),$("#show-viewing").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.viewing=$(this).hasClass("active"),options.save()}),$("#show-favorite").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.favorites=$(this).hasClass("active"),options.save()}),$("#system-favorite").click(function(){$(this).hasClass("active")?($(this).removeClass("active").attr("data-icon","star-empty"),options.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)),1)):($(this).attr("data-icon","star").addClass("active"),options.favorites.push(parseInt(viewingSystemID))),$("#show-favorite").hasClass("active")&&chain.redraw(),options.save()}),$("#favorite-dropdown-toggle").click(function(){const e=document.getElementById("favorite-panel");if("none"===e.style.display){document.getElementById("favorite-panel-wrapper").innerHTML=0==options.favorites.length?"<p>You have no favourites. Use the star to add a system.</p>":options.favorites.map(function(e){const t=systemAnalysis.analyse(e);return"<p>"+systemRendering.renderSystem(t)+"</p>"}).join("\n"),e.style.display=""}else e.style.display="none"}),$("#search").click(function(e){$("#searchSpan").toggle(),$(this).hasClass("active")?($(this).removeClass("active"),tripwire.client.EVE&&tripwire.client.EVE.systemName&&$("#currentSpan").show()):($(this).addClass("active"),$("#currentSpan").hide(),$("#searchSpan input[name=system]").focus().select())}),$("#toggle-automapper").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.signaturesWidget.autoMapper=$(this).hasClass("active"),options.save()}),$("#track").on("click",".tracking-clone",function(){var e=$(this).attr("data-characterid");$("#tracking .tracking-clone").removeClass("active"),options.tracking.active==e?(options.tracking.active=null,tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")):(options.tracking.active=e,tripwire.esi.characters[options.tracking.active]&&($("#tracking .tracking-clone[data-characterid='"+options.tracking.active+"']").addClass("active"),tripwire.EVE(tripwire.esi.characters[options.tracking.active],!0)),$("#removeESI").removeAttr("disabled")),set_tracking_text(),options.save()}),$("#login").on("click","#removeESI",function(){var e=options.tracking.active;options.tracking.active=null,tripwire.EVE(!1,!0),options.save(),$("#tracking .tracking-clone[data-characterid='"+e+"']").remove(),$("#removeESI").attr("disabled","disabled"),$.isArray(tripwire.data.esi.delete)?tripwire.data.esiDelete.push(e):tripwire.data.esiDelete=[e]}),$("#user").click(function(e){e.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active"),$("#login > #panel").css({display:"none"})):($(this).addClass("active"),$("#login > #panel").css({display:"inline"}),$("#loginForm input[name=username]").focus().select())}),$("#wrapper").click(function(e){e.originalEvent&&e.originalEvent.isInPanel||($("#login > #panel").css({display:"none"}),$("#user").removeClass("active"))}),$("#login").click(function(e){e.originalEvent.isInPanel=!0}),$("#logout").click(function(){window.location="logout.php"});var Notify=new function(){this.trigger=function(e,t,i,a){t=void 0!==t?t:"blue",i=void 0!==i?i:1e4,a=void 0!==a?a:null;new jBox("Notice",{id:a,content:e,offset:{y:35},animation:"flip",color:t,autoClose:i})}},ValidationTooltips=new jBox("Tooltip",{trigger:null,addClass:"validation-tooltip",animation:"flip",fade:0}),Tooltips=new jBox("Tooltip",{attach:$("[data-tooltip]"),getContent:"data-tooltip",position:{x:"right",y:"center"},outside:"x"}),SystemActivityToolTips=new jBox("Tooltip",{getContent:"data-tooltip",position:{y:"bottom"},appendTo:$("#chainParent"),reposition:!0,repositionOnOpen:!0,createOnInit:!0,onOpen:function(){var e=positionRelativeTo(this.target[0],document.getElementById("chainParent")),t=(this.source.closest("[data-nodeid]").position(),this.source.closest(".nodeActivity").position(),this.source.closest("[data-nodeid]").height(),this.container.parent().width());this.options.position={x:e.left+3-t/2,y:e.top+this.target[0].offsetHeight}}}),WormholeRouteToolTips=new jBox("Tooltip",{getContent:"data-tooltip",position:{y:"bottom"},appendTo:$("#chainParent"),reposition:!0,repositionOnOpen:!0,createOnInit:!0,onOpen:function(){var e=positionRelativeTo(this.target[0],document.getElementById("chainParent")),t=(this.source.closest("[data-nodeid]").height(),this.container.parent().width());this.options.position={x:e.left+3-t/2,y:e.top+this.target[0].offsetHeight}}}),WormholeTypeToolTips=new jBox("Tooltip",{attach:$("#chainMap .whEffect[data-icon]"),getContent:"data-tooltip",position:{x:"left",y:"center"},appendTo:$("#chainParent"),outside:"x",adjustDistance:100,responsiveWidth:!1,reposition:!0,repositionOnOpen:!0,createOnInit:!0,onOpen:function(){var e=positionRelativeTo(this.target[0],document.getElementById("chainParent")),t=this.container.parent().width();this.options.position={x:e.left-t-10,y:e.top-3}}}),OccupiedToolTips=new jBox("Tooltip",{pointer:"top:-3",position:{x:"right",y:"center"},appendTo:$("#chainParent"),outside:"x",minWidth:100,animation:"move",adjustDistance:100,responsiveWidth:!1,reposition:!0,repositionOnOpen:!0,repositionOnContent:!0,createOnInit:!0,onOpen:function(){var e=this;var t=this.source.closest("[data-nodeid]").data("nodeid"),i=positionRelativeTo(this.target[0],document.getElementById("chainParent"));this.options.position={x:i.left+this.target[0].offsetWidth,y:i.top-3},e.setContent("&nbsp;"),$.ajax({url:"occupants.php",dataType:"JSON",data:"systemID="+t,cache:!1}).done(function(t){if(t&&t.occupants){var i="<table>";for(var a in t.occupants.sort(function(e,t){return e.characterName.toLowerCase()<t.characterName.toLowerCase()?-1:e.characterName.toLowerCase()>t.characterName.toLowerCase()?1:0}),t.occupants)i+="<tr><td>"+t.occupants[a].characterName+"</td><td style='padding-left: 10px;'>"+(t.occupants[a].shipTypeName?t.occupants[a].shipTypeName:"")+"</td></tr>";i+="</table>",e.setContent(i)}})}});function formatSignatureID(e){return e?(e.length>=3?e.substring(0,3).toUpperCase():"")+"-"+(6==e.length?e.substring(3,6):"###"):"???-###"}function linkSig(e){return["Average Frontier Deposit","Unexceptional Frontier Deposit","Common Perimeter Deposit","Exceptional Core Deposit","Infrequent Core Deposit","Unusual Core Deposit","Rarified Core Deposit","Isolated Core Deposit","Ordinary Permiter Deposit","Uncommon Core Deposit","Barren Perimeter Reservoir","Minor Perimeter Reservoir","Ordinary Perimeter Reservoir","Sizeable Perimeter Reservoir","Token Perimeter Reservoir","Bountiful Frontier Reservoir","Vast Frontier Reservoir","Instrumental Core Reservoir","Vital Core Reservoir","Perimeter Ambush Point","Perimeter Camp","Phase Catalyst Node","The Line","Forgotten Perimeter Coronation Platform","Forgotten Perimeter Power Array","Unsecured Perimeter Amplifier","Unsecured Perimeter Information Center","Perimeter Checkpoint","Perimeter Hangar","The Ruins of Enclave Cohort 27","Sleeper Data Sanctuary","Forgotten Perimeter Gateway","Forgotten Perimeter Habitation Coils","Unsecured Perimeter Comms Relay","Unsecured Perimeter Transponder Farm","Fortification Frontier Stronghold","Outpost Frontier Stronghold","Solar Cell","The Oruze Construct","Forgotten Frontier Quarantine Outpost","Forgotten Frontier Recursive Depot","Unsecured Frontier Database","Unsecured Frontier Receiver","Frontier Barracks","Frontier Command Post","Integrated Terminus","Sleeper Information Sanctum","Forgotten Frontier Conversion Module","Forgotten Frontier Evacuation Center","Unsecured Frontier Digital Nexus","Unsecured Frontier Trinary Hub","Core Garrison","Core Stronghold","Oruze Osobnyk","Quarantine Area","Forgotten Core Data Field","Forgotten Core Information Pen","Unsecured Frontier Enclave Relay","Unsecured Frontier Server Bank","Core Citadel","Core Bastion","Strange Energy Readings","The Mirror","Forgotten Core Assembly Hall","Forgotten Core Circuitry Disassembler","Unsecured Core Backup Array","Unsecured Core Emergence"].indexOf(e)>-1?'<a href="http://eve-survival.org/wikka.php?wakka='+e.replace(/ /g,"")+'" target="_blank" class="siteLink">'+e+"</a>":e}$("#chainTabs").sortable({items:"> .tab",axis:"x",delay:150,tolerance:"pointer",containment:"parent",update:function(e,t){var i=$("#chainTabs").sortable("toArray"),a=[];for(var s in i)a.push(options.chain.tabs[i[s]]),$("#chainTabs .tab:eq("+s+")").attr("id",s);options.chain.active=$(".tab.current").index(),options.chain.tabs=a,options.save()}}),$("#chainTabs").on("click",".tab",function(e){e.preventDefault(),chain.setActiveTab($(this).hasClass("current")?null:$(this).index())}),$("#chainTabs").on("click",".closeTab",function(e){e.stopPropagation();var t=$(this).closest(".tab");$("#dialog-confirm #msg").html("This tab will be removed, are you sure?"),$("#dialog-confirm").dialog("option",{buttons:{"Remove Tab":function(){var e=t.index();options.chain.active=$(".tab.current").index(),options.chain.tabs.splice(e,1),options.save(),t.remove(),0==$("#chainTabs .tab.current").length&&$("#chainTabs .tab:last").click();for(var i=0,a=$("#chainTabs .tab").length;i<a;i++)$("#chainTabs .tab:eq("+i+")").attr("id",i);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#newTab").on("click",function(){$("#dialog-newTab").hasClass("ui-dialog-content")?$("#dialog-newTab").dialog("isOpen")||$("#dialog-newTab").dialog("open"):$("#dialog-newTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#newTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-newTab .name").val(viewingSystem).focus(),$("#dialog-newTab .sigSystemsAutocomplete").val(viewingSystem)},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-newTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0,renderer:"system"}),$("#newTab_form").submit(function(e){e.preventDefault();var t=$("#chainTab .tab").clone(),i=$("#dialog-newTab .name").val(),a=tripwire.getSystemIDsByNames($("#dialog-newTab .sigSystemsAutocomplete").val()),s=!!$("#tabThera")[0].checked;return i?!a&&$("#tabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-newTab .sigSystemsAutocomplete")}).setContent("Must have valid systems (comma separated if multiple)!"),!1):($("#tabType2")[0].checked&&(a=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",a).html(i),options.chain.tabs.push({systemID:a,name:i,evescout:s}),options.save(),$("#chainTabs").append(t),void $("#dialog-newTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-newTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-newTab .sigSystemsAutocomplete").click(function(e){$("#dialog-newTab #tabType1").click()})}})}),$("#chainTabs").on("click",".editTab",function(e){e.stopPropagation(),$("#dialog-editTab").hasClass("ui-dialog-content")?$("#dialog-editTab").dialog("isOpen")||$("#dialog-editTab").dialog("open"):$("#dialog-editTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#editTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-editTab .name").val(options.chain.tabs[options.chain.active].name).focus(),$("#dialog-editTab .sigSystemsAutocomplete").val(0!=options.chain.tabs[options.chain.active].systemID?lookupMultiple(tripwire.systems,"name",options.chain.tabs[options.chain.active].systemID):""),0!=options.chain.tabs[options.chain.active].systemID?$("#dialog-editTab #editTabType1")[0].checked=!0:$("#dialog-editTab #editTabType2")[0].checked=!0,$("#dialog-editTab #editTabThera")[0].checked=options.chain.tabs[options.chain.active].evescout},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-editTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,renderer:"system",maxSize:10,delay:0}),$("#editTab_form").submit(function(e){e.preventDefault();var t=$("#chainTabs .tab").eq([options.chain.active]),i=$("#dialog-editTab .name").val(),a=tripwire.getSystemIDsByNames($("#dialog-editTab .sigSystemsAutocomplete").val()),s=!!$("#editTabThera")[0].checked;return i?!a&&$("#editTabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-editTab .sigSystemsAutocomplete")}).setContent("Must have valid systems (comma separated if multiple)!"),!1):($("#editTabType2")[0].checked&&(a=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",a).html(i),options.chain.tabs[options.chain.active]={systemID:a,name:i,evescout:s},options.save(),chain.redraw(),tripwire.parse(tripwire.client,"refresh"),void $("#dialog-editTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-editTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-editTab .sigSystemsAutocomplete").click(function(e){$("#dialog-editTab #editTabType1").click()})}})}),$("#signaturesWidget #sigTable thead").contextmenu({delegate:"th.sortable",menu:"#signatureColumnMenu",position:function(e,t){return{my:"left top",at:"center",of:t.target}},select:function(e,t){var i=$(t.target).parent().parent().children().index($(t.target).parent())+1;switch(i){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}switch(t.cmd){case"leftAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+i+")").removeClass("centerAlign rightAlign").addClass("leftAlign"),options.signatures.alignment[colName]="leftAlign";break;case"centerAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+i+")").removeClass("leftAlign rightAlign").addClass("centerAlign"),options.signatures.alignment[colName]="centerAlign";break;case"rightAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+i+")").removeClass("centerAlign leftAlign").addClass("rightAlign"),options.signatures.alignment[colName]="rightAlign"}options.save()},beforeOpen:function(e,t){switch($(t.target).parent().parent().children().index($(t.target).parent())+1){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}$(this).contextmenu("enableEntry","leftAlign",!0),$(this).contextmenu("enableEntry","centerAlign",!0),$(this).contextmenu("enableEntry","rightAlign",!0),$(this).contextmenu("enableEntry",options.signatures.alignment[colName],!1)}}),$("#chainParent").contextmenu({appendTo:"#chainParent",delegate:".nodeSystem a",position:function(e,t){return{my:"left top-1",at:"right top",of:t.target}},menu:"#chainMenu",show:{effect:"slideDown",duration:150},select:function(e,t){const i=$(t.target[0]).closest("[data-nodeid]");var a=i.data("nodeid");i.attr("id").replace("node","");switch(t.cmd){case"showInfo":tripwire.esi.showInfo(a,options.tracking.active);break;case"setDest":tripwire.esi.setDestination(a,options.tracking.active,!0);break;case"addWay":tripwire.esi.setDestination(a,options.tracking.active,!1);break;case"showMap":break;case"red":i.hasClass("redNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"yellow":i.hasClass("yellowNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"green":i.hasClass("greenNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"mass":$("#dialog-mass").data("id",i.data("sigid")).data("systemID",a).dialog("open");break;case"ping":$("#dialog-ping").data("id",i.data("sigid")||null).data("systemID",a).dialog("open");break;case"collapse":var s=!options.chain.tabs[options.chain.active]||-1==$.inArray(a,options.chain.tabs[options.chain.active].collapsed);chain.renderer.collapse(a,s);break;case"makeTab":const e=Object.index(options.chain.tabs,"systemID",""+a,!1);if(void 0!==e)chain.setActiveTab(e);else{const e=tripwire.systems[a].name;options.chain.tabs.push({systemID:""+a,name:e});var n=$("#chainTab .tab").clone();n.attr("id",options.chain.tabs.length-1).find(".name").data("tab",a).html(e),$("#chainTabs").append(n),chain.setActiveTab(options.chain.tabs.length-1)}}},beforeOpen:function(e,t){var i=$(t.target[0]).closest("[data-nodeid]").data("sigid")||null,a=$(t.target[0]).closest("[data-nodeid]").data("nodeid");tripwire.systems[a].class||!tripwire.esi.characters[options.tracking.active]?($(this).contextmenu("enableEntry","setDest",!1),$(this).contextmenu("enableEntry","addWay",!1),$(this).contextmenu("enableEntry","showMap",!1)):($(this).contextmenu("enableEntry","setDest",!0),$(this).contextmenu("enableEntry","addWay",!0),$(this).contextmenu("enableEntry","showMap",!1)),i?$(this).contextmenu("enableEntry","mass",!0):$(this).contextmenu("enableEntry","mass",!1);const s=Object.find(options.chain.tabs,"systemID",""+a,!1);$("#makeTabMenuItem").text(s?"View Tab":"Make Tab")},create:function(e,t){$(this).find(".ui-front").css("width","10em"),$(this).find(".ui-front").css("position",""),$("#dialog-mass").dialog({autoOpen:!1,width:"auto",height:"auto",dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Close:function(){$(this).dialog("close")}},open:function(){var e=$(this).data("id"),t=$(this).data("systemID"),i=tripwire.client.wormholes[e],a=tripwire.client.signatures[i.initialID],s=tripwire.client.signatures[i.secondaryID];$("#dialog-mass").dialog("option","title","From "+tripwire.systems[a.systemID].name+" to "+tripwire.systems[s.systemID].name),$("#dialog-mass #massTable tbody tr").remove();var n={wormholeID:i.id};$.ajax({url:"mass.php",type:"POST",data:n,dataType:"JSON"}).done(function(e){if(e&&e.jumps){var i=0;for(x in e.jumps){const a=parseFloat(appData.mass[e.jumps[x].shipTypeID].mass);i+=a,$("#dialog-mass #massTable tbody").append("<tr><td>"+e.jumps[x].characterName+"</td><td>"+(e.jumps[x].toID==t?"In":"Return")+"</td><td>"+appData.mass[e.jumps[x].shipTypeID].typeName+"</td><td>"+Intl.NumberFormat().format(a)+"Kg</td><td>"+e.jumps[x].time+"</td></tr>")}$("#dialog-mass #massTable tbody").append("<tr><td></td><td></td><td></td><th>"+Intl.NumberFormat().format(i)+"Kg</th><td></td></tr>")}})}}),$.moogle.contextmenu.prototype.setFlare=function(e,t,i){var a={systemID:e,flare:t};$.ajax({url:"flares.php",type:"POST",data:a,dataType:"JSON"}).done(function(i){i&&i.result&&(chain.data.flares.flares.push({systemID:e,flare:t,time:null}),chain.flares(chain.data.flares))})},$.moogle.contextmenu.prototype.removeFlare=function(e,t){var i={systemID:e};$.ajax({url:"flares.php",type:"POST",data:i,dataType:"JSON"}).done(function(t){t&&t.result&&(chain.data.flares.flares.splice(Object.index(chain.data.flares.flares,"systemID",e),1),chain.flares(chain.data.flares))})}}}),$("#sigTable").tablesorter({sortReset:!0,widgets:["saveSort"],textExtraction:{2:function(e){return $(e).find("span").data("age")}}}),$("#sigTable tbody").on("click","tr",function(e){e.metaKey||e.ctrlKey?$(this).toggleClass("selected"):e.shiftKey?($(this).addClass("selected"),$("#sigTable tbody tr.selected:first").nextUntil("#sigTable tbody tr.selected:last").addBack().add("#sigTable tbody tr.selected:last").addClass("selected")):($("#sigTable tbody tr.selected").removeClass("selected"),$(this).addClass("selected"))}),$(document).click(function(e){$(e.target).closest("#sigTable tbody").length||$(e.target).closest("#edit-signature").length||$(e.target).closest("#delete-signature").length||$("#sigTable tbody tr.selected").removeClass("selected")}),$("#sigTable tbody").on("classchange","tr",function(e,t){"selected"===t&&$("#signaturesWidget").trigger("selected:change")}),$("#signaturesWidget").on("selected:change",function(){0===$("#sigTable tr.selected").length?$("#signaturesWidget #delete-signature").addClass("disabled"):$("#signaturesWidget #delete-signature").removeClass("disabled"),1===$("#sigTable tr.selected").length?$("#signaturesWidget #edit-signature").removeClass("disabled"):$("#signaturesWidget #edit-signature").addClass("disabled")}),$("#dialog-error").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}},create:function(){$(this).dialog("option","show",{effect:"shake",duration:150,easing:"easeOutElastic"})}}),$("#dialog-msg").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}}}),$("#dialog-confirm").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Cancel:function(){$(this).dialog("close")}}}),-1!=window.location.href.indexOf("galileo")&&Notify.trigger("This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>");
const wormholeRendering=new function(){function e(e,n){if(!e)return"?";if(e=Array.isArray(e)?e:[e],n){const s=n.name?n:systemAnalysis.analyse(Object.index(appData.systems,"name",n,!0)||n),t=e.filter(function(e){return s.name==e||s.genericSystemType==e});t.length&&(e=t)}return e.map(function(e){const n=Object.index(appData.systems,"name",e,!0)||e,s=systemAnalysis.analyse(n);return s?'<span class="'+s.systemTypeClass+'">'+(s.name||s.systemTypeName)+"</span>":void 0}).filter(function(e){return void 0!==e}).join(",")}this.renderWormholeType=function(n,s,t,r){return(s||n.key?"<b>"+(s||n.key||"")+"</b>: ":"")+e(n.from,t)+"➔"+e(n.leadsTo,r)+(n.jump?" ("+this.renderMass(n.jump)+")":"")},this.renderMass=function(e){return e/1e6+"kt"}};
$.widget("custom.inlinecomplete",$.ui.autocomplete,{_create:function(){return this.options.source=this._coerceSource(this.options.source),this.element.is("input")||this._selectInit(),this._super()},_value:function(){var e=this._superApply(arguments);return this.element.change(),e},_suggest:function(e){return this._super(e)},_coerceSource:function(e){return $.isArray(e)?e:Object.keys(e).map(function(t){return Object.assign({key:t},e[t])}.bind(this))},_initSource:function(){this.source=function(e,t){var o=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term),"i"),s=new Array;const n=this.options.source;for(var i=this.options.maxSize||25,r=0,c=n.length;r<c;r++){const t=n[r].name||n[r].key||n[r];if(o.test(t)&&(s.push({value:t,label:t,content:"object"==typeof n[r]?n[r]:void 0}),i&&""!==e.term&&s.length>i))break}t(s)}},_renderItem:function(e,t){if(t.content&&this.options.renderer){const o=("function"==typeof this.options.renderer?this.options.renderer:renderers[this.options.renderer])(t.content);return $("<li>").html("<span>"+o+"</span>").appendTo(e)}return this._super(e,t)},_close:function(e){return this.options.source=this.options.input_source?this.options.input_source:this.options.source,this._super(e)},addToSelect:function(e){this.options.select_added_value=e,this.options.select_source.unshift(e)},removeFromSelect:function(e){e?this.options.select_source.splice(e,1):this.options.select_added_value&&this.options.select_source.splice(this.options.select_added_value,1),this.options.select_added_value=null},_selectInit:function(){this.element.addClass("custom-combobox"),this.wrapper=this.element,this.element=this.wrapper.find("input:first")||this.element,this.select=this.wrapper.find("select:first").remove(),this.options.input_source=this.options.source,this.options.select_source=this.select.children("option[value!='']").map(function(){return $.trim(this.text)}).toArray(),this._createShowAllButton()},_createShowAllButton:function(){var e=this,t=!1;$("<a>").attr("tabIndex",e.element.prop("tabindex")).attr("title","").appendTo(e.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").on("mousedown",function(){t=e.widget().is(":visible")}).on("click",function(){e.element.trigger("focus"),t||(e.options.customDropdown&&(e.options.select_source=e._coerceSource(e.options.customDropdown())),e.options.source=e.options.select_source,e._search(""))})}});const renderers={system:function(e){return systemRendering.renderSystem(systemAnalysis.analyse(void 0,e),"span")},wormholeType:wormholeRendering.renderWormholeType};
const systemAnalysis=new function(){const e=[];this.addMutator=function(s){e.push(s)},this.analyse=function(s,a){a||(a=appData.systems[s]),a||(a=function(e){const s="string"==typeof e&&e.indexOf("|")>=0?appData.genericSystemTypes[e.substring(0,e.indexOf("|"))]:appData.genericSystemTypes.indexOf(e)>=0?e:appData.genericSystemTypes[e],a=s&&"Class-"==s.substring(0,6)?1*s.substring(6):void 0,t="High-Sec"==s?.8:"Low-Sec"==s?.4:"Null-Sec"==s?-.1:void 0,c="Triglavian"==s?500026:void 0;return{security:t,class:a,factionID:c}}(s)),s||(s=a.systemID);const t=Object.assign({},a);return t.baseSecurity=1*a.security,t.pathSymbol="■",t.systemTypeModifiers=[],t.systemID=s,e.forEach(function(e){e.mutate(t,s)}),t.systemTypeClass=t.class?"wh class-"+t.class:500026==t.factionID?"triglavian":t.security>=.45?"hisec":t.security>0?"lowsec":t.security<=0?"nullsec":"unknown",t.systemTypeName=t.class?"C"+t.class:500026==t.factionID?"Trig":t.baseSecurity>=.45?"HS":t.baseSecurity>0?"LS":t.baseSecurity<=0?"NS":" ",t.genericSystemType=t.class?"Class-"+t.class:500026==t.factionID?"Triglavian":t.baseSecurity>=.45?"High-Sec":t.baseSecurity>0?"Low-Sec":t.baseSecurity<=0?"Null-Sec":" ",t.effectClass="Black Hole"===t.effect?"blackhole":"Cataclysmic Variable"===t.effect?"cataclysmic-variable":"Magnetar"===t.effect?"magnetar":"Pulsar"===t.effect?"pulsar":"Red Giant"===t.effect?"red-giant":"Wolf-Rayet Star"===t.effect?"wolf-rayet":void 0,t}};
const mutator_favourite=new _FavouriteMutator;function _FavouriteMutator(){this.mutate=function(t,a){options.favorites.indexOf(1*a)>=0&&(t.pathSymbol="★",t.systemTypeModifiers.push('<span class="favorite active" data-icon="star"></span>'))}}systemAnalysis.addMutator(mutator_favourite);
const invasions=new _Invasions;function _Invasions(){const s={stellar_reconnaissance:"◆",triglavian_minor_victory:"▽",escalating_liminality:"▽",final_liminality:"▼",edencom_minor_victory:"△",redoubt:"△",bulwark:"△",fortress:"▲"},t={stellar_reconnaissance:"Stellar Reconnaissance",triglavian_minor_victory:"Triglavian Minor Victory",escalating_liminality:"Escalating Liminality",final_liminality:"Final Liminality",edencom_minor_victory:"EDENCOM Minor Victory",redoubt:"Redoubt",bulwark:"Bulwark",fortress:"EDENCOM Fortress"};this.invasions=_.keyBy([{system_id:30003088,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-10-04T12:29:02.888Z",system_name:"Oyonata",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30003894,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-10-01T18:28:09.852Z",system_name:"Sabusi",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30004302,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-30T15:36:50.977Z",system_name:"Omigiav",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30003539,status:"fortress",derived_security_status:null,updated_at:"2020-09-30T14:11:30.759Z",system_name:"Miakie",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30005074,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-30T14:02:33.042Z",system_name:"Daran",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30003570,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-30T13:47:01.992Z",system_name:"Elore",system_security:"0.2",system_sovereignty:"gallente"},{system_id:30003573,status:"fortress",derived_security_status:null,updated_at:"2020-09-28T15:38:24.368Z",system_name:"Pertnineere",system_security:"0.4",system_sovereignty:"gallente"},{system_id:30003463,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-28T15:38:14.299Z",system_name:"Erlendur",system_security:"0.5",system_sovereignty:"minmatar"},{system_id:30002079,status:"final_liminality",derived_security_status:"-0.4",updated_at:"2020-09-28T15:37:20.058Z",system_name:"Krirald",system_security:"0.2",system_sovereignty:"minmatar"},{system_id:30002652,status:"final_liminality",derived_security_status:"-0.4",updated_at:"2020-09-28T15:36:53.719Z",system_name:"Ala",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30045331,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-09-28T15:36:28.616Z",system_name:"Vaaralen",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30003788,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-26T12:44:03.049Z",system_name:"Intaki",system_security:"0.1",system_sovereignty:"gallente"},{system_id:30002724,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-25T00:51:28.251Z",system_name:"Assiettes",system_security:"0.6",system_sovereignty:"gallente"},{system_id:30002999,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-24T12:03:23.037Z",system_name:"Shastal",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30000102,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-23T22:22:21.093Z",system_name:"Dysa",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30003919,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-22T10:22:11.970Z",system_name:"Ashkoo",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30004978,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-22T10:21:30.195Z",system_name:"Pemene",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30004287,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-20T11:25:28.863Z",system_name:"Esubara",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30002051,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-20T11:25:09.478Z",system_name:"Anher",system_security:"0.5",system_sovereignty:"minmatar"},{system_id:30003823,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-20T11:24:54.777Z",system_name:"Kenninck",system_security:"0.1",system_sovereignty:"gallente"},{system_id:30001400,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-09-18T14:03:33.048Z",system_name:"Litiura",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30005251,status:"fortress",derived_security_status:null,updated_at:"2020-09-18T09:42:27.550Z",system_name:"Asanot",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30005267,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-17T11:18:57.960Z",system_name:"Bherdasopt",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30002411,status:"final_liminality",derived_security_status:"-0.3",updated_at:"2020-09-17T00:30:42.544Z",system_name:"Skarkon",system_security:"0.1",system_sovereignty:"minmatar"},{system_id:30003587,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-15T01:16:50.021Z",system_name:"Harner",system_security:"0.1",system_sovereignty:"gallente"},{system_id:30003904,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-14T16:54:07.359Z",system_name:"Col",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30005209,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-14T16:53:54.556Z",system_name:"Sibe",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30004103,status:"fortress",derived_security_status:null,updated_at:"2020-09-14T13:40:36.727Z",system_name:"Kothe",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30005219,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-13T09:34:00.331Z",system_name:"Sigga",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30002755,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-12T20:51:38.354Z",system_name:"Usi",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30003824,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-11T08:28:52.435Z",system_name:"Archavoinet",system_security:"0.6",system_sovereignty:"gallente"},{system_id:30002239,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-11T08:28:42.669Z",system_name:"Rammi",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30005005,status:"final_liminality",derived_security_status:"-0.5",updated_at:"2020-09-10T21:09:12.196Z",system_name:"Ignebaener",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30000021,status:"final_liminality",derived_security_status:"-0.8",updated_at:"2020-09-09T21:16:25.577Z",system_name:"Kuharah",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30000118,status:"fortress",derived_security_status:null,updated_at:"2020-09-09T08:08:17.988Z",system_name:"Uanzin",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30003794,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-07T23:26:42.297Z",system_name:"Stacmon",system_security:"0.6",system_sovereignty:"gallente"},{system_id:30003927,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-07T22:18:47.862Z",system_name:"Zahefeus",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30000109,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-07T20:54:30.351Z",system_name:"Berta",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30002797,status:"final_liminality",derived_security_status:"-0.9",updated_at:"2020-09-06T13:33:29.649Z",system_name:"Kaunokka",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30031392,status:"final_liminality",derived_security_status:"-0.4",updated_at:"2020-09-06T13:33:15.544Z",system_name:"Komo",system_security:"0.8",system_sovereignty:"caldari"},{system_id:30004090,status:"fortress",derived_security_status:null,updated_at:"2020-09-06T06:22:50.377Z",system_name:"Aband",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30000060,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-06T01:54:13.794Z",system_name:"Janus",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003548,status:"fortress",derived_security_status:null,updated_at:"2020-09-05T17:05:22.429Z",system_name:"Barira",system_security:"0.8",system_sovereignty:"amarr"},{system_id:30000160,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-04T23:48:55.626Z",system_name:"Reisen",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30004999,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-04T15:38:27.450Z",system_name:"Ladistier",system_security:"0.3",system_sovereignty:"gallente"},{system_id:30000113,status:"fortress",derived_security_status:null,updated_at:"2020-09-04T07:07:27.574Z",system_name:"Astabih",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30004295,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-09-02T18:09:55.446Z",system_name:"Keba",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30001413,status:"final_liminality",derived_security_status:"-0.2",updated_at:"2020-09-02T08:11:42.869Z",system_name:"Nani",system_security:"0.8",system_sovereignty:"caldari"},{system_id:30002386,status:"fortress",derived_security_status:null,updated_at:"2020-09-01T08:04:35.922Z",system_name:"Gelfiven",system_security:"0.6",system_sovereignty:"minmatar"},{system_id:30004973,status:"fortress",derived_security_status:null,updated_at:"2020-08-31T21:17:02.227Z",system_name:"Caslemon",system_security:"0.6",system_sovereignty:"gallente"},{system_id:30004231,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-31T20:32:52.884Z",system_name:"Shakasi",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30004284,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-31T20:32:43.772Z",system_name:"Defsunun",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30002266,status:"fortress",derived_security_status:null,updated_at:"2020-08-31T10:38:02.368Z",system_name:"Ahmak",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30003932,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-29T23:12:29.549Z",system_name:"Timudan",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30004254,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-28T16:43:28.986Z",system_name:"Fihrneh",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30004244,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-08-28T07:55:35.187Z",system_name:"Onanam",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30002513,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-27T20:59:21.817Z",system_name:"Dammalin",system_security:"0.5",system_sovereignty:"minmatar"},{system_id:30000206,status:"final_liminality",derived_security_status:"-0.5",updated_at:"2020-08-27T14:06:44.066Z",system_name:"Wirashoda",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30002048,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-27T11:14:57.970Z",system_name:"Bei",system_security:"0.6",system_sovereignty:"minmatar"},{system_id:30003090,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-26T23:04:35.948Z",system_name:"Saidusairos",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30003478,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-26T00:06:02.331Z",system_name:"Basan",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30004289,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-25T11:33:32.949Z",system_name:"Vaini",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30045345,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-08-24T21:16:26.292Z",system_name:"Hirri",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30001358,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-08-24T08:44:18.165Z",system_name:"Ossa",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30003061,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-24T07:23:55.183Z",system_name:"Mormelot",system_security:"0.2",system_sovereignty:"gallente"},{system_id:30040141,status:"final_liminality",derived_security_status:"-0.4",updated_at:"2020-08-23T11:05:21.929Z",system_name:"Urhinichi",system_security:"0.8",system_sovereignty:"caldari"},{system_id:30003078,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-22T18:47:39.976Z",system_name:"Erkinen",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30002530,status:"fortress",derived_security_status:null,updated_at:"2020-08-22T15:09:00.523Z",system_name:"Avesber",system_security:"0.8",system_sovereignty:"minmatar"},{system_id:30003900,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-22T07:50:34.044Z",system_name:"Ham",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30002644,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-21T08:26:40.788Z",system_name:"Ambeke",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30001401,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-08-21T00:44:17.584Z",system_name:"Nonni",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30045328,status:"final_liminality",derived_security_status:"-0.7",updated_at:"2020-08-20T14:35:34.268Z",system_name:"Ahtila",system_security:"0.6",system_sovereignty:"caldari"},{system_id:30003480,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-20T11:19:04.711Z",system_name:"Amod",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30004141,status:"fortress",derived_security_status:null,updated_at:"2020-08-20T01:50:23.539Z",system_name:"Hiremir",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30002770,status:"final_liminality",derived_security_status:"-0.1",updated_at:"2020-08-18T14:53:00.972Z",system_name:"Tunudan",system_security:"0.4",system_sovereignty:"caldari"},{system_id:30003504,status:"final_liminality",derived_security_status:"-0.7",updated_at:"2020-08-18T14:46:27.787Z",system_name:"Niarja",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30002253,status:"fortress",derived_security_status:null,updated_at:"2020-08-18T09:31:28.183Z",system_name:"Arshat",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30002737,status:"final_liminality",derived_security_status:"0.0",updated_at:"2020-08-16T21:29:53.121Z",system_name:"Konola",system_security:"0.7",system_sovereignty:"caldari"},{system_id:30003398,status:"fortress",derived_security_status:null,updated_at:"2020-08-16T17:38:55.577Z",system_name:"Anbald",system_security:"0.7",system_sovereignty:"minmatar"},{system_id:30003490,status:"fortress",derived_security_status:null,updated_at:"2020-08-15T20:27:08.919Z",system_name:"Khopa",system_security:"0.8",system_sovereignty:"amarr"},{system_id:30001696,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-14T06:57:31.468Z",system_name:"Iro",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30000192,status:"final_liminality",derived_security_status:"-0.3",updated_at:"2020-08-14T01:51:38.839Z",system_name:"Otanuomi",system_security:"0.4",system_sovereignty:"caldari"},{system_id:30002772,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-13T11:24:31.714Z",system_name:"Rairomon",system_security:"0.6",system_sovereignty:"caldari"},{system_id:30005284,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-13T11:24:24.229Z",system_name:"Promised Land",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30045354,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-08-13T07:37:02.262Z",system_name:"Reitsato",system_security:"0.2",system_sovereignty:"caldari"},{system_id:30005222,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-12T17:58:16.210Z",system_name:"Serren",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003556,status:"fortress",derived_security_status:null,updated_at:"2020-08-10T23:13:52.643Z",system_name:"Arton",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30005086,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-10T06:50:08.222Z",system_name:"Arza",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30000157,status:"final_liminality",derived_security_status:"-0.3",updated_at:"2020-08-10T06:49:46.743Z",system_name:"Otela",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30003918,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-09T15:49:15.024Z",system_name:"Hakana",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30002385,status:"fortress",derived_security_status:null,updated_at:"2020-08-09T00:34:34.831Z",system_name:"Teonusude",system_security:"0.6",system_sovereignty:"minmatar"},{system_id:30002704,status:"fortress",derived_security_status:null,updated_at:"2020-08-07T22:29:26.455Z",system_name:"Adrallezoen",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30001372,status:"final_liminality",derived_security_status:"-0.9",updated_at:"2020-08-07T19:29:54.183Z",system_name:"Kino",system_security:"0.7",system_sovereignty:"caldari"},{system_id:30003908,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-07T07:00:48.775Z",system_name:"Bashyam",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30000012,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-06T09:30:28.248Z",system_name:"Asabona",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30005058,status:"fortress",derived_security_status:null,updated_at:"2020-08-05T21:45:44.898Z",system_name:"Neesher",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30004305,status:"fortress",derived_security_status:null,updated_at:"2020-08-05T21:24:35.293Z",system_name:"Esaeel",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30003883,status:"fortress",derived_security_status:null,updated_at:"2020-08-05T20:44:57.150Z",system_name:"Keberz",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003481,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-05T07:41:10.729Z",system_name:"Unefsih",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30003397,status:"fortress",derived_security_status:null,updated_at:"2020-08-04T16:45:17.206Z",system_name:"Bongveber",system_security:"0.9",system_sovereignty:"minmatar"},{system_id:30002702,status:"final_liminality",derived_security_status:"-0.4",updated_at:"2020-08-04T11:15:48.842Z",system_name:"Archee",system_security:"0.4",system_sovereignty:"gallente"},{system_id:30003460,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-03T22:03:14.542Z",system_name:"Offikatlin",system_security:"0.4",system_sovereignty:"minmatar"},{system_id:30004084,status:"fortress",derived_security_status:null,updated_at:"2020-08-02T17:58:04.736Z",system_name:"Ghesis",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003574,status:"fortress",derived_security_status:null,updated_at:"2020-08-01T20:28:35.755Z",system_name:"Boystin",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30005213,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-01T20:20:33.816Z",system_name:"Hesarid",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30005308,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-08-01T10:42:51.414Z",system_name:"Jufvitte",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30002665,status:"fortress",derived_security_status:null,updated_at:"2020-08-01T02:12:09.248Z",system_name:"Misneden",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30000188,status:"fortress",derived_security_status:null,updated_at:"2020-08-01T02:11:39.811Z",system_name:"Hentogaira",system_security:"0.6",system_sovereignty:"caldari"},{system_id:30002557,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-07-31T18:00:06.264Z",system_name:"Atgur",system_security:"0.5",system_sovereignty:"minmatar"},{system_id:30003058,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-29T09:14:47.194Z",system_name:"Olide",system_security:"0.7",system_sovereignty:"gallente"},{system_id:30005334,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-28T23:28:39.525Z",system_name:"Tierijev",system_security:"0.8",system_sovereignty:"gallente"},{system_id:30003046,status:"final_liminality",derived_security_status:"-0.5",updated_at:"2020-07-28T14:20:51.847Z",system_name:"Angymonne",system_security:"0.6",system_sovereignty:"gallente"},{system_id:30003514,status:"fortress",derived_security_status:null,updated_at:"2020-07-27T18:47:08.094Z",system_name:"Yeeramoun",system_security:"0.8",system_sovereignty:"amarr"},{system_id:30002760,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-07-26T11:44:38.056Z",system_name:"Manjonakko",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30002506,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-23T18:07:27.688Z",system_name:"Osoggur",system_security:"0.5",system_sovereignty:"minmatar"},{system_id:30005052,status:"fortress",derived_security_status:null,updated_at:"2020-07-21T17:37:44.002Z",system_name:"Soumi",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30003931,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-20T16:54:45.398Z",system_name:"Sassecho",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30005255,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-20T09:34:48.342Z",system_name:"Saphthar",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30020141,status:"final_liminality",derived_security_status:"-0.9",updated_at:"2020-07-19T11:16:57.684Z",system_name:"Senda",system_security:"0.9",system_sovereignty:"caldari"},{system_id:30002795,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-07-18T01:59:01.724Z",system_name:"Oshaima",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30000004,status:"fortress",derived_security_status:null,updated_at:"2020-07-17T22:26:00.294Z",system_name:"Jark",system_security:"0.8",system_sovereignty:"amarr"},{system_id:30004263,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-15T21:20:01.593Z",system_name:"Feshur",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30000062,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-15T15:49:03.146Z",system_name:"Iosantin",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30002241,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-13T01:22:41.989Z",system_name:"Rimbah",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30004981,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-07-12T11:24:07.265Z",system_name:"Actee",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30002242,status:"fortress",derived_security_status:null,updated_at:"2020-07-10T19:06:05.853Z",system_name:"Mamenkhanar",system_security:"0.7",system_sovereignty:"amarr"},{system_id:30003558,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-10T13:51:31.889Z",system_name:"Madimal",system_security:"0.7",system_sovereignty:"amarr"},{system_id:30001376,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-09T16:04:24.621Z",system_name:"Nourvukaiken",system_security:"0.8",system_sovereignty:"caldari"},{system_id:30045329,status:"final_liminality",derived_security_status:"-0.4",updated_at:"2020-07-08T10:41:47.622Z",system_name:"Ichoriya",system_security:"0.6",system_sovereignty:"caldari"},{system_id:30005252,status:"fortress",derived_security_status:null,updated_at:"2020-07-07T23:49:41.522Z",system_name:"Anzalaisio",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30004257,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-07T17:15:51.416Z",system_name:"Hakatiz",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30004108,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-05T01:56:57.535Z",system_name:"Chaneya",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30000048,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-03T15:11:36.506Z",system_name:"Ihal",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003482,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-02T20:56:41.226Z",system_name:"Mista",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30002225,status:"final_liminality",derived_security_status:"-0.8",updated_at:"2020-07-01T14:11:27.451Z",system_name:"Harva",system_security:"0.8",system_sovereignty:"amarr"},{system_id:30005263,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-01T13:43:12.530Z",system_name:"Mozzidit",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30005066,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-07-01T06:43:25.457Z",system_name:"Kerying",system_security:"0.2",system_sovereignty:"amarr"},{system_id:30002986,status:"fortress",derived_security_status:null,updated_at:"2020-06-28T17:43:41.096Z",system_name:"Mendori",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30001381,status:"final_liminality",derived_security_status:"-0.1",updated_at:"2020-06-27T00:02:01.315Z",system_name:"Arvasaras",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30001447,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-25T02:19:25.407Z",system_name:"Taisy",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30002700,status:"fortress",derived_security_status:null,updated_at:"2020-06-24T13:40:05.882Z",system_name:"Bawilan",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30001390,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-24T09:42:32.895Z",system_name:"Pakkonen",system_security:"0.4",system_sovereignty:"caldari"},{system_id:30003076,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-23T09:02:12.462Z",system_name:"Gammel",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003050,status:"fortress",derived_security_status:null,updated_at:"2020-06-23T06:32:08.087Z",system_name:"Odixie",system_security:"0.6",system_sovereignty:"gallente"},{system_id:30000163,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-22T19:28:52.910Z",system_name:"Akora",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30003073,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-21T07:12:31.404Z",system_name:"Netsalakka",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30001391,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-20T21:12:20.299Z",system_name:"Piekura",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30002771,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-20T00:41:47.611Z",system_name:"Kulelen",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30000005,status:"fortress",derived_security_status:null,updated_at:"2020-06-19T14:36:55.956Z",system_name:"Sasta",system_security:"0.8",system_sovereignty:"amarr"},{system_id:30005330,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-19T13:21:23.145Z",system_name:"Arraron",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30000205,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-18T22:06:13.302Z",system_name:"Obe",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30003856,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-18T12:10:11.496Z",system_name:"Athounon",system_security:"0.1",system_sovereignty:"gallente"},{system_id:30004250,status:"fortress",derived_security_status:null,updated_at:"2020-06-17T11:42:53.830Z",system_name:"Chibi",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30004268,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-17T08:56:42.286Z",system_name:"Shenda",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30005236,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-17T07:25:26.811Z",system_name:"Noranim",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30003829,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-16T22:17:39.177Z",system_name:"Renarelle",system_security:"0.3",system_sovereignty:"gallente"},{system_id:30005034,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-16T21:32:34.651Z",system_name:"Bridi",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30003074,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-16T21:31:28.344Z",system_name:"Sasiekko",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003392,status:"fortress",derived_security_status:null,updated_at:"2020-06-15T19:26:39.709Z",system_name:"Eygfe",system_security:"0.7",system_sovereignty:"minmatar"},{system_id:30001445,status:"final_liminality",derived_security_status:"0.0",updated_at:"2020-06-15T03:38:02.163Z",system_name:"Nalvula",system_security:"0.4",system_sovereignty:"caldari"},{system_id:30010141,status:"final_liminality",derived_security_status:"-0.2",updated_at:"2020-06-14T01:12:53.428Z",system_name:"Sakenta",system_security:"1.0",system_sovereignty:"caldari"},{system_id:30003809,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-13T20:25:21.879Z",system_name:"Brellystier",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30001718,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-13T05:28:45.485Z",system_name:"Paye",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30004256,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-11T13:37:54.195Z",system_name:"Edilkam",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30002645,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-11T00:28:57.560Z",system_name:"Carrou",system_security:"0.4",system_sovereignty:"gallente"},{system_id:30045338,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-10T22:28:25.084Z",system_name:"Hikkoken",system_security:"0.3",system_sovereignty:"caldari"},{system_id:30004301,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-10T16:44:37.396Z",system_name:"Anath",system_security:"0.1",system_sovereignty:"amarr"},{system_id:30002575,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-10T05:41:23.824Z",system_name:"Sotrenzur",system_security:"0.3",system_sovereignty:"minmatar"},{system_id:30003515,status:"fortress",derived_security_status:null,updated_at:"2020-06-08T06:49:36.637Z",system_name:"Anila",system_security:"0.7",system_sovereignty:"amarr"},{system_id:30004100,status:"fortress",derived_security_status:null,updated_at:"2020-06-08T03:04:19.196Z",system_name:"Halibai",system_security:"0.7",system_sovereignty:"amarr"},{system_id:30002397,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-08T01:10:38.296Z",system_name:"Horaka",system_security:"0.6",system_sovereignty:"minmatar"},{system_id:30002662,status:"fortress",derived_security_status:null,updated_at:"2020-06-07T11:22:11.884Z",system_name:"Pulin",system_security:"0.5",system_sovereignty:"gallente"},{system_id:30001383,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-07T06:16:44.145Z",system_name:"Vaajaita",system_security:"0.5",system_sovereignty:"caldari"},{system_id:30003854,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-06T19:17:57.398Z",system_name:"Alamel",system_security:"0.2",system_sovereignty:"gallente"},{system_id:30003464,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-06T19:16:59.888Z",system_name:"Aldik",system_security:"0.7",system_sovereignty:"minmatar"},{system_id:30000182,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-06T19:04:22.126Z",system_name:"Inaya",system_security:"0.6",system_sovereignty:"caldari"},{system_id:30001660,status:"edencom_minor_victory",derived_security_status:null,updated_at:"2020-06-06T17:38:27.602Z",system_name:"Dabrid",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30001685,status:"triglavian_minor_victory",derived_security_status:null,updated_at:"2020-06-06T17:34:50.620Z",system_name:"Ordat",system_security:"0.3",system_sovereignty:"amarr"},{system_id:30005029,status:"final_liminality",derived_security_status:"-1.0",updated_at:"2020-06-06T15:44:51.914Z",system_name:"Vale",system_security:"0.7",system_sovereignty:"gallente"},{system_id:30045322,status:"fortress",derived_security_status:null,updated_at:"2020-06-06T01:44:55.204Z",system_name:"Samanuni",system_security:"0.7",system_sovereignty:"caldari"},{system_id:30003885,status:"fortress",derived_security_status:null,updated_at:"2020-06-05T17:09:39.066Z",system_name:"Arzanni",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30004248,status:"fortress",derived_security_status:null,updated_at:"2020-06-05T00:49:40.255Z",system_name:"Haimeh",system_security:"0.5",system_sovereignty:"amarr"},{system_id:30003495,status:"final_liminality",derived_security_status:"-1.0",updated_at:"2020-06-04T23:08:13.644Z",system_name:"Raravoss",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30003541,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T16:55:17.838Z",system_name:"Faswiba",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30002651,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T15:38:07.592Z",system_name:"Fasse",system_security:"0.4",system_sovereignty:"gallente"},{system_id:30004150,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Shaggoth",system_security:"0.7",system_sovereignty:"amarr"},{system_id:30002251,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Sadye",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30005260,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Keri",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30000105,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Abha",system_security:"0.4",system_sovereignty:"amarr"},{system_id:30004992,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Palmon",system_security:"0.4",system_sovereignty:"gallente"},{system_id:30002243,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Seiradih",system_security:"0.6",system_sovereignty:"amarr"},{system_id:30003553,status:"fortress",derived_security_status:null,updated_at:"2020-06-03T04:02:40.650Z",system_name:"Warouh",system_security:"0.5",system_sovereignty:"amarr"}],function(s){return s.system_id}),this.mutate=function(e,a){const _=this.invasions[a];if(_){_.derived_security_status&&(e.security=1*_.derived_security_status),e.pathSymbol=s[_.status];const a=t[_.status]+(_.derived_security_status?"<br>Effective security lowered to "+_.derived_security_status:"");e.systemTypeModifiers.push('<span class="invasion '+_.status+'" data-tooltip="'+a+'">'+e.pathSymbol+"</span>")}}}systemAnalysis.addMutator(invasions);
var guidance=function(e){var r=function(e,r){return parseFloat(e)-parseFloat(r)};function n(e,r){var n=systemAnalysis.analyse(3e7+1*r);if(!n)return e;switch(options.chain.routeIgnore.enabled&&options.chain.routeIgnore.systems.indexOf(n.name)>=0&&(e+=100),options.chain.routeSecurity){case"highsec":return e+(n.security<.45?100:0);case"avoid-high":return e+(n.security>=.45?100:0);case"avoid-null":return e+(n.security<=0?100:0);default:return e}}function t(e,r,n){return a.jumpCostModifiers.reduce((n,t)=>t(e,r,n),n)}var i=function(e,i,a,u){Array.isArray(i)||(i=[i]),Array.isArray(a)||(a=[a]),i=i.filter(function(r){return e[r]});const c=(a=a.filter(function(r){return e[r]})).filter(function(e){return i.indexOf(e)>=0});if(c.length)return[c[0]];if(!i.length||!a.length)return null;var s,f={},h={0:[]},l={};i.forEach(function(e){f[e]=0,h[0].push(e)});for(var d=function(e,r){var n=""+e;h[n]||(h[n]=[]),h[n].push(r)};(s=Object.keys(h)).length;){s.sort(r);var p=s[0],v=h[p],y=v.shift(),g=parseFloat(p),m=e[y]||{};if(v.length||delete h[p],g>=u)break;for(var k in m){const e=1*k;if(void 0!==m[e]){var C=1+n(m[e],e),S=C+g,j=f[e];if(((C=t(y,e,C))>0&&void 0===j||j>S)&&(f[e]=S,d(S,e),l[e]=y,a.indexOf(e)>=0))return o(l,e)}}}return null},o=function(e,r){for(var n=[],t=r;t;)n.push(t),predecessor=e[t],t=e[t];return n.reverse(),n},a={kSpaceCache:{},jumpCostModifiers:[],clearCache:function(){a.kSpaceCache={}},findShortestPath:function(e,r,n,t){r>3e7&&(r-=3e7),n>3e7&&(n-=3e7);const o=[r,n].join(",")+(t?"-"+t:""),u=a.kSpaceCache[o];return void 0===u?a.kSpaceCache[o]=i(e,r,n,t):u},connections:function(e,r){return r>3e7&&(r-=3e7),Object.keys(e[r]||{}).map(e=>1*e).map(e=>{const n={systemID:e+3e7};return 0>t(r,e,1)&&(n.closed=!0),n})}};return a}();
const systemRendering=new function(){this.renderPath=function(e){if(e.length<=1||e.length>options.chain.routingLimit)return""+e.length-1;for(var s=e.slice(0,e.length-1).reverse().map(function(e){const s=3e7+1*e,t=systemAnalysis.analyse(s);return'<span class="'+t.systemTypeClass+'" data-tooltip="'+t.name+" ("+t.security+')" onclick="tripwire.systemChange('+s+')">'+t.pathSymbol+"</span>"}),t='<span class="path">',n=0;n<s.length;n++)n>0&&0==n%5&&(t+="|"),t+=s[n];return t+"</span>"},this.renderEffect=function(e,s){return e.effectClass?"<"+s+" class='whEffect' data-icon='"+e.effectClass+"' data-tooltip='"+e.effect+"'></"+s+">":""},this.renderSystem=function(e,s){s=s||"a";const t=e.name||e.genericSystemType;return"<"+s+("a"===s?' href=".?system='+e.name+'"':"")+">"+t+"</"+s+"> ("+this.renderEffect(e,"span")+'<span class="'+e.systemTypeClass+'">'+e.systemTypeName+"</span>)"}};
const ChainMapRendererOrgchart=function(t){const n=this;this.init=function(){n.map=new google.visualization.OrgChart(document.getElementById("chainMap")),n.options={allowHtml:!0,allowCollapse:!0,size:"medium",nodeClass:"node"},google.visualization.events.addListener(n.map,"collapse",n.collapseHandler),n.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}]})),n.options)},this.ready=function(){return!this.drawing&&!!this.map},this.switchTo=function(){document.getElementById("chainGrid").style.display="",n.map||google.charts.setOnLoadCallback(this.init)},this.switchFrom=function(){document.getElementById("chainGrid").style.display="none",n.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}]})),n.options)},this.draw=function(t,n,a){for(var o in this.drawing=!0,this.map.draw(i(t),this.options),a){const t=a[o],n=$("#chainMap [data-nodeid='"+t+"']").attr("id");if(n){const t=n.split("node")[1];this.map.collapse(t-1,!0)}}e(t,n),this.drawing=!1};const i=function(t){return new google.visualization.DataView(new google.visualization.DataTable(t))},e=function(t,i){function e(n,i,e,a){function o(t,n){return r(t,n,function(t,n){t.addClass(n)})}function l(t,n){return r(t,n,function(t,n){t.removeClass(n)})}function r(t,n,i){return(n=n||[]).push(""),n.forEach(function(n){e.forEach(function(e){i(t,(n.length?n+"-":"")+e)})}),t}"string"==typeof e&&(e=[e]);var s=$("#chainMap #node"+n).parent();if(0==s.length)return!1;var c=Math.ceil((s[0].cellIndex+1)/2-1),d=o($(s.parent().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[c]),["left","right"]),h=$("#chainMap #node"+i).parent();if(0==h.length||0==d.length)return!1;var p=0,g=d[0].cellIndex;s.parent().prev().find("td").each(function(t){if(p+=this.colSpan,t==g)return!1});for(var u=Math.ceil((h[0].cellIndex+1)/2-1),f=u,v=0;v<=u;v++){var m=0;s.parent().prev().prev().prev().find("td > [data-nodeid]").each(function(t){if(t==v)return m=$(this).attr("id").replace("node",""),!1}),$.map(t.rows,function(t){return t.c[1].v==m?t:null}).length<=0&&f--}u=f;var w=o($(s.parent().prev().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[u]),["left","right"]),y=0,z=(i=!1,!1);s.parent().prev().prev().find("td").each(function(t,n){if(y+=this.colSpan,z&&i)return!1;if(void 0!==w[0]&&w[0].cellIndex==t){if(i=!0,o($(this),["left"]),z||y==p||o($(this),["bottom"]),p==y)return!1}else if(y==p)z=!0,o($(this),["bottom"]);else if(z||i){var e=0,a=!1,r=!1;if(s.parent().prev().find("td").each(function(t){if((e+=this.colSpan)==y&&($(this).hasClass("google-visualization-orgchart-lineleft")||$(this).hasClass("google-visualization-orgchart-lineright"))){if(0==i)return a=!0,l(w,["left","right"]),!1;1==i&&(l(w,["left","right"]),s.parent().prev().prev().find("td").each(function(t){t>=w[0].cellIndex&&l($(this),["bottom"])}),r=!0)}}),a)return!1;r||o($(this),["bottom"])}})}for(var a in n.lastLineData={map:t,lines:i},i)e(i[a][0],i[a][1],i[a][2].concat(["connection"]),i[a][3])};this.collapseHandler=function(){if(n.drawing)return;const i=n.map.getCollapsedNodes(),a=[];for(x in i){var o=$("#chainMap #node"+(i[x]+1)).data("nodeid");a.push(o)}t.updateCollapsed(a),n.lastLineData&&e(n.lastLineData.map,n.lastLineData.lines)}};
const ChainMapRendererRadial=function(t){this.ready=function(){return!this.drawing},this.switchTo=function(){if(!document.getElementById("map-container")){const t=document.createElement("div");t.id="map-container",t.className="radial-map",document.getElementById("chainMap").appendChild(t)}this.container=document.getElementById("map-container"),this.container.style.display=""},this.switchFrom=function(){const t=document.getElementById("map-container");t&&t.parentNode.removeChild(t),this.container=null},this.collapse=function(e,n){n?this.mapData.collapsed.push(e):this.mapData.collapsed=this.mapData.collapsed.filter(t=>t!=e),t.updateCollapsed(this.mapData.collapsed),i(this.mapData.map,this.mapData.lines,this.mapData.collapsed)},this.draw=function(t,e,n){this.drawing=!0,this.mapData={map:t,lines:e,collapsed:n};try{i(t,e,n)}finally{this.drawing=!1}};const e={x:70,y:60,first_ring_delta:.3,ringX:function(t){return 0==t?0:(t+this.first_ring_delta)*this.x*options.chain.nodeSpacing.x},ringY:function(t){return 0==t?0:(t+this.first_ring_delta)*this.y*options.chain.nodeSpacing.y}},n=this,i=function(t,i,r){const c=[],d={};for(var l=0;l<t.rows.length;l++){const e=t.rows[l],n=e.c[0],o=n.v,s=e.c[1].v,a={id:o,children:[],systemID:n.systemID,minArc:0};if(null==s){const t={circles:[{arc:0,nodes:[a]}]};a.map=t,a.circle=0,c.push(t)}else{const t=d[s];if(!t)throw"Parent id "+s+" not on map yet";t.children.push(a),a.parent=t,a.connection=i.filter(function(t){return t[0]==o})[0]||[o,s,[],"?"],a.styles=["connection"].concat(a.connection[2]),a.map=t.map,a.circle=t.circle+1,a.map.circles.length<=a.circle?a.map.circles.push({arc:0,nodes:[a]}):a.map.circles[a.circle].nodes.push(a)}d[o]=a,a.markup=n.f}for(var p=0;p<c.length;p++){const t=c[p];for(var h=t.circles.length-1;h>=1;h--)for(var m=0;m<t.circles[h].nodes.length;m++){const e=t.circles[h].nodes[m];e.minArc*=h/(h+1),(e.minArc<1||r.indexOf(1*e.systemID)>=0)&&(e.minArc=1),e.parent.minArc+=e.minArc,t.circles[h].arc+=e.minArc}}for(p=0;p<c.length;p++){const t=c[p];var y=document.getElementById("map"+p);y||((y=document.createElement("div")).id="map"+p,y.className="map-chain-wrapper"),y.innerHTML='<div class="map-outer-container"><div class="map-inner-container"><canvas class="map-drawing" id="map-canvas-'+p+'"/></div></div>';const e=y.firstChild.firstChild;document.getElementById("map-container").appendChild(y),t.bounds=o(e,0,t.circles[0].nodes,0,2*Math.PI,r),t.domNode=y,t.innerContainer=e}for(p=0;p<c.length;p++){const t=c[p],i={w:200+t.bounds.x[1]-t.bounds.x[0],h:100+t.bounds.y[1]-t.bounds.y[0],cx:100-t.bounds.x[0],cy:50-t.bounds.y[0]};if(1==c.length){const t=-38+n.container.offsetWidth;i.w<t&&(i.cx+=.5*(t-i.w),i.w=t)}const o=document.getElementById("chainParent").offsetHeight;i.h<o&&(i.cy+=.5*(o-i.h),i.h=o),i.h>=2*(t.bounds.y[1]>-t.bounds.y[0]?t.bounds.y[1]:-t.bounds.y[0])&&(i.cy=i.h/2),i.w>=2*(t.bounds.x[1]>-t.bounds.x[0]?t.bounds.x[1]:-t.bounds.x[0])&&(i.cx=i.w/2),t.domNode.style.width=i.w+"px",t.domNode.style.height=i.h+"px";const r=t.domNode.firstChild;r.style.left=i.cx+"px",r.style.top=i.cy+"px";const d=r.getElementsByTagName("canvas")[0];d.width=1*i.w,d.style.width=i.w+"px",d.height=1*i.h,d.style.height=i.h+"px",d.style.left=-i.cx+"px",d.style.top=-i.cy+"px";const l=d.getContext("2d");l.scale(1,1),l.translate(i.cx,i.cy);for(h=t.bounds.maxCi;h>=1;h--)if(options.chain.gridlines&&(l.beginPath(),l.ellipse&&(l.lineWidth=.5,l.setLineDash([]),l.ellipse(0,0,e.ringX(h),e.ringY(h),0,0,2*Math.PI)),l.strokeStyle=a("grid-default","color"),l.stroke()),!(h>=t.circles.length)){l.save();for(m=0;m<t.circles[h].nodes.length;m++){const e=t.circles[h].nodes[m];if(!e.position)continue;l.beginPath(),l.moveTo(e.position.x,e.position.y);const n=s({r:e.radPosition.r-.5,theta:(e.radPosition.theta+2*e.parent.radPosition.theta)/3}),i=s({r:e.radPosition.r-.5,theta:(2*e.radPosition.theta+e.parent.radPosition.theta)/3});h>1?l.bezierCurveTo(i.x,i.y,n.x,n.y,e.parent.position.x,e.parent.position.y):l.lineTo(e.parent.position.x,e.parent.position.y);e.position.y,e.parent.position;if(options.chain.aura){l.save(),l.lineWidth=1;const t=a(e.styles,"color");l.shadowBlur=11,l.shadowColor=t,l.strokeStyle="black";for(let t=0;t<8;t++)l.stroke();l.restore()}l.lineWidth=parseInt(a(e.styles,"border-width"))||2,l.strokeStyle=a(e.styles,"border-top-color"),l.setLineDash({dashed:[5,3]}[a(e.styles,"border-top-style")]||[]),l.stroke()}l.restore()}}for(p=c.length;;p++){const t=document.getElementById("map"+p);if(!t)break;t.parentNode.removeChild(t)}};function o(t,e,i,a,r,c){const d={x:[0,0],y:[0,0],maxCi:e};if(!i.length)return d;const l=c.indexOf(1*(i[0].parent||{}).systemID)>=0;if(e>0&&!l)for(var p=0;++p<2&&i.length>1.4*e*(r-a);)e++;const h=(r-a)/(l?i.length:i.reduce(function(t,e){return t+e.minArc},0));for(var m=a,y=0,u=0;u<i.length;u++){const a=i[u],r=document.createRange().createContextualFragment('<div class="node-wrapper">'+a.markup+"</div>");a.domNode=r.firstChild,t.appendChild(a.domNode);const p=1*a.systemID;$(a.domNode).dblclick(()=>n.collapse(p,c.indexOf(p)<0));const x=(l?1:a.minArc)*h,f=m+x/2;if(1==e&&0==u&&(y-=f),a.radPosition={r:e,theta:f+y},a.position=s(a.radPosition),a.position.x<d.x[0]&&(d.x[0]=a.position.x),a.position.x>d.x[1]&&(d.x[1]=a.position.x),a.position.y<d.y[0]&&(d.y[0]=a.position.y),a.position.y>d.y[1]&&(d.y[1]=a.position.y),a.domNode.style.left=a.position.x+"px",a.domNode.style.top=a.position.y+"px",l)a.domNode.style.display="none";else{const n=e>0&&x>a.minArc*e?x-a.minArc*e:0;if(a.children.length){const i=o(t,e+1,a.children,m+.5*n+y,m-.5*n+y+x,c);i.x[0]<d.x[0]&&(d.x[0]=i.x[0]),i.x[1]>d.x[1]&&(d.x[1]=i.x[1]),i.y[0]<d.y[0]&&(d.y[0]=i.y[0]),i.y[1]>d.y[1]&&(d.y[1]=i.y[1]),i.maxCi>d.maxCi&&(d.maxCi=i.maxCi)}}m+=x}return d}function s(t){return{x:e.ringX(t.r)*Math.sin(t.theta),y:e.ringY(t.r)*Math.cos(t.theta)}}function a(t,e){Array.isArray(t)&&(t=t.join(" "));var n=document.getElementById("temp-div-"+t);return n||((n=document.createElement("div")).id="temp-div-"+t,n.style.cssText="position:fixed;left:-100px;top:-100px;width:1px;height:1px;",n.className=t+" temp",document.body.appendChild(n)),getComputedStyle(n).getPropertyValue(e)}};
var chain=new function(){var i=this;this.map,this.view,this.drawing,this.data={},thirdPartySuppliers=[eveScout];const e={orgChart:new ChainMapRendererOrgchart(this),radial:new ChainMapRendererRadial(this)};this.renderer=e[options.chain.renderer],this.renderer.switchTo(),this.useRenderer=function(i){if(!e[i])throw"Unknown renderer "+i;this.renderer!=e[i]&&(this.renderer.switchFrom(),this.renderer=e[i],this.renderer.switchTo(),this.redraw())},this.activity=function(i){for(var e=0,s=(t=document.querySelectorAll("#chainMap .nodeActivity span")).length;e<s;++e)t[e].className=t[e].className+" invisible";var t;for(e=0,s=(t=document.querySelectorAll("#chainMap [data-nodeid]")).length;e<s;++e){var a=t[e].getAttribute("data-nodeid");if(i[a]){var n=i[a].shipJumps,r=i[a].podKills,l=i[a].shipKills,c=i[a].npcKills,o=t[e].getElementsByClassName("nodeActivity")[0];if(n>0){var d=o.getElementsByClassName("jumps")[0];d.className=d.className.replace(/invisible/g,""),d.setAttribute("data-tooltip",n+" Jumps")}if(r>0){var h=o.getElementsByClassName("pods")[0];h.className=h.className.replace(/invisible/g,""),h.setAttribute("data-tooltip",r+" Pod Kills")}if(l>0){var p=o.getElementsByClassName("ships")[0];p.className=p.className.replace(/invisible/g,""),p.setAttribute("data-tooltip",l+" Ship Kills")}if(c>0){var m=o.getElementsByClassName("npcs")[0];m.className=m.className.replace(/invisible/g,""),m.setAttribute("data-tooltip",c+" NPC Kills")}}}return SystemActivityToolTips.attachedElements&&SystemActivityToolTips.attachedElements.length>0&&SystemActivityToolTips.detach($("#chainMap .whEffect")),SystemActivityToolTips.attach($("#chainMap .nodeActivity > span[data-tooltip]:not(.invisible)")),i},this.occupied=function(i){for(var e in $("#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge").addClass("invisible"),i)$("#chainMap [data-nodeid='"+i[e].systemID+"'] [data-icon='user']").removeClass("invisible"),$("#chainMap [data-nodeid='"+i[e].systemID+"'] [data-icon='user'] + .badge").removeClass("invisible").html(i[e].count);return OccupiedToolTips.attach($("#chainMap [data-icon='user']:not(.invisible)")),i},this.flares=function(i){if($("#chainMap div.node").removeClass("redNode yellowNode greenNode"),$("#chainGrid tr").removeClass("red yellow green"),i)for(var e in i.flares){var s=i.flares[e].systemID,t=i.flares[e].flare,a=($("#chainMap [data-nodeid="+s+"]").addClass(t+"Node").parent().index()-1)/3*2;a>0&&$("#chainGrid tr:eq("+a+")").addClass(t).next().addClass(t)}return i},this.grid=function(){if(0==options.chain.gridlines)return $("#chainGrid tr").addClass("hidden"),!1;$("#chainGrid tr").removeClass("hidden");var i=Math.max(0,2*$(".google-visualization-orgchart-table tr:has(.node)").length-1);$("#chainGrid tr:gt("+i+")").addClass("hidden")},this.nodes=function(i){var e={cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}],rows:[]},s=[];function t(i,e){if(!i||!tripwire.systems[i])return!1;const s=options.chain.tabs[options.chain.active];return a(i,e,null,null,s&&0!=s.systemID&&0>s.systemID.indexOf(",")?options.chain.tabs[options.chain.active].name:void 0,"&nbsp;",["top-level"])}function a(i,e,s,t,a,n,r){const l=systemAnalysis.analyse(i);var c="<span class='"+l.systemTypeClass+"'>"+l.systemTypeName+l.systemTypeModifiers.join("")+"</span>";a=_.escape(a);const o="name"==options.chain.sigNameLocation?a||(l.name?l.name:"&nbsp;"):"name_prefix"==options.chain.sigNameLocation&&a?a+(l.name?" - "+l.name:""):l.name?l.name:"&nbsp;";var d={v:e,systemID:i},h="<div id='node"+e+"' data-nodeid='"+i+"'"+(s?" data-sigid='"+s+"'":"")+(t?" data-inSigid='"+t+"'":"")+" class='node "+(r||[]).join(" ")+"'><div class='nodeIcons'><div style='float: left;'>"+systemRendering.renderEffect(l,"i")+"</div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>"+c+"</h4><h4 class='nodeSystem'>"+(l.name?"<a href='.?system="+l.name+"'>"+o+"</a>":o)+"</h4><h4 class='nodeType'>"+n+"</h4><div class='statics'>"+function(i){if(!i)return"";if(i.length>4)return'<span class="multi-static">+</span>';const e={"High-Sec":"H","Low-Sec":"L","Null-Sec":"N",Triglavian:"▼","Class-1":"1","Class-2":"2","Class-3":"3","Class-4":"4","Class-5":5,"Class-6":6},s={H:"hisec",L:"lowsec",N:"nullsec","▼":"triglavian"};return i.map(function(i){const t=e[appData.wormholes[i].leadsTo];return'<span class="'+(s[t]||"class-"+t)+'" data-tooltip="'+appData.wormholes[i].leadsTo+" via "+i+'">'+t+"</span>"}).join("")}(l.name?l.statics:[])+"</div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>";return d.f=h,d}function n(i,e,s){var t=guidance.findShortestPath(tripwire.map.shortest,s-3e7,e.child.systemID-3e7);if(!t)return null;var a={calculated:!0,life:"Gate",parent:{}};return a.parent.id=e.child.id,a.parent.systemID=e.child.systemID,a.parent.name=e.child.name,a.parent.type=e.child.type,a.parent.nth=e.child.nth,a.child={},a.child.id=++i,a.child.systemID=s,a.child.name=tripwire.systems[s].name,a.child.path=t,a.child.jumps=t.length-1,a.child.nth=null,{childID:i,calcNode:a}}function r(i){if(i[0]<=0)return!1;var e=parseInt(i[1]),s=c.length;const t=[],a=function(i){$("#show-viewing").hasClass("active")&&tripwire.systems[i.child.systemID]&&!tripwire.systems[viewingSystemID].class&&!tripwire.systems[i.child.systemID].class&&viewingSystemID!=i.child.systemID&&((t=n(s,i,viewingSystemID))&&(s=t.childID,d.push(t.calcNode),c.push([0,s])));if($("#show-favorite").hasClass("active")&&tripwire.systems[i.child.systemID]&&!tripwire.systems[i.child.systemID].class)for(var e in options.favorites){var t;if(!(tripwire.systems[options.favorites[e]].regionID>=11e6||tripwire.systems[i.child.systemID].regionID>=11e6||options.favorites[e]==i.child.systemID))(t=n(s,i,options.favorites[e]))&&(s=t.childID,d.push(t.calcNode),c.push([0,s]))}};for(var r in o){var l=o[r];if(-1==$.inArray(l.id,h)){var p,m,y,u,v,f,g;if("secondary"==l.parent?(p=tripwire.client.signatures[l.secondaryID],m=tripwire.client.signatures[l.initialID]):(p=tripwire.client.signatures[l.initialID],m=tripwire.client.signatures[l.secondaryID]),y=l.type,"K162",p&&p.systemID==i[0])u=p,v=m,f="K162",g=y;else{if(!m||m.systemID!=i[0])continue;u=m,v=p,g="K162",f=y}var I={};I.id=l.id,I.life=l.life,I.mass=l.mass,I.time=u.modifiedTime,I.parent={},I.parent.id=e,I.parent.systemID=tripwire.systems[u.systemID]?u.systemID:u.systemID+"|"+Math.floor(Math.random()*Math.floor(1e4)),I.parent.name=v.name,I.parent.type=f,I.parent.typeBM=null,I.parent.classBM=null,I.parent.nth=null,I.parent.signatureID=v.signatureID,I.parent.sigIndex=v.id,I.child={},I.child.id=++s,I.child.systemID=tripwire.systems[v.systemID]?v.systemID:v.systemID+"|"+Math.floor(Math.random()*Math.floor(1e4)),I.child.name=u.name,I.child.type=g,I.child.typeBM=null,I.child.classBM=null,I.child.nth=null,I.child.signatureID=u.signatureID,I.child.sigIndex=u.id,d.push(I),c.push([I.child.systemID,I.child.id,i[2]]),h.push(I.id),tripwire.systems[v.systemID]&&t.push(1*v.systemID),a(I)}}thirdPartySuppliers.forEach(function(n){const r={parentID:e,nextChildID:++s},l=n.findLinks(1*i[0],r);if(l){s=r.nextChildID-1;for(var o=0;o<l.length;o++){var p=l[o];0>h.indexOf(p.id)&&(0>t.indexOf(p.child.systemID)&&(p.thirdParty=n.nodeNameSuffix,d.push(p),c.push([p.child.systemID,p.child.id,i[2]]),t.push(p.child.systemID),a(p)),h.push(p.id))}}})}if($("#chainTabs .current").length>0){var l=$("#chainTabs .current .name").data("tab").toString().split(","),c=[],o=i,d=[],h=[];if(0==l){let s=0;Object.keys(i).slice().forEach(a=>{const n=tripwire.client.signatures[i[a].initialID],r=tripwire.client.signatures[i[a].secondaryID];n&&tripwire.systems[n.systemID]&&void 0===tripwire.systems[n.systemID].class?(s++,e.rows.push({c:[t(n.systemID,s),{v:null}]}),c.push([n.systemID,s,n.systemID])):r&&tripwire.systems[r.systemID]&&void 0===tripwire.systems[r.systemID].class&&(s++,e.rows.push({c:[t(r.systemID,s),{v:null}]}),c.push([r.systemID,s,r.systemID]))})}else for(var p in l)e.rows.push({c:[t(l[p],parseInt(p)+1),{v:null}]}),c.push([l[p],parseInt(p)+1,l[p]]);for(var m=0;m<c.length;m++)r(c[m])}else{$("#chainError").hide();var y={c:[]},u=viewingSystemID;y.c.push(t(u,1),{v:null}),e.rows.push(y);for(c=[[u,1]],o=i,d=[],h=[],m=0;m<c.length;++m)r(c[m])}const v={};for(var p in d){var f=d[p];y={c:[]};const i="id"==options.chain["node-reference"]?f.child.signatureID?f.child.signatureID.substring(0,3):"???":(f.child.type||"(?)")+sigFormat(f.child.typeBM,"type"),t=f.child.path?systemRendering.renderPath(f.child.path):(f.child.sigIndex?"<a href='#' onclick='sigDialog.openSignatureDialog({data: { signature: "+f.child.sigIndex+', mode: "update" }}); return false;\'>':"")+_.escape(f.child.name&&"ref"==options.chain.sigNameLocation?f.child.name:f.child.name&&"ref_prefix"==options.chain.sigNameLocation?f.child.name+" - "+i:i)+(f.child.sigIndex?"</a>":""),n=f.calculated?["calc"]:v[f.child.systemID]?["loop"]:[];f.thirdParty&&n.push("third-party","third-party-"+f.thirdParty);var g=[];"critical"==f.life&&g.push("eol"),"critical"==f.mass?g.push("critical"):"destab"==f.mass&&g.push("destab");const r=wormholeAnalysis.wormholeFromTypePair(f.parent.type,f.child.type)||wormholeAnalysis.likelyWormhole(f.parent.systemID,f.child.systemID);r.jump&&(g.push("jm-"+r.jump/1e6+"kt"),5e6==r.jump&&g.push("frig"));const l=(v[f.parent.systemID]||{chainModifiers:[]}).chainModifiers;y.chainModifiers=g.concat(l.filter(function(i){return g.indexOf(i)<0})),y.chainModifiers.forEach(function(i){g.push(i+"-chain")});const c=a(f.child.systemID,f.child.id,f.id,f.child.sigIndex,f.child.name,t,n.concat(g));var I={v:f.parent.id};y.c.push(c,I),e.rows.push(y),s.push(Array(c.v,I.v,g,f.id));const o=(v[f.parent.systemID]||{pathHome:[]}).pathHome;y.pathHome=o.concat(f.child),f.calculated||(v[f.child.systemID]=y)}s.reverse();const D=Object.keys(v).filter(function(i){return i<31e6});return{map:e,lines:s,systemsInChainMap:v,exits:D}},this.setActiveTab=function(e){$("#chainTabs .tab").removeClass("current"),options.chain.active=e,null!=e&&$("#chainTabs .tab").eq(e).addClass("current"),options.save(),i.redraw(),tripwire.parse(tripwire.client,"refresh")},this.redraw=function(){this.useRenderer(options.chain.renderer);var i=$.extend(!0,{},this.data);i.map=$.extend(!0,{},i.rawMap),this.draw(i)};var s=null;this.draw=function(e){e=void 0!==e?e:{};if(clearTimeout(s),!this.renderer.ready()||Object.keys(e.map||{}).length&&!tripwire.client.signatures)s=setTimeout(function(){i.draw(e)},100);else{if(e.map){this.drawing=!0,this.data.rawMap=$.extend(!0,{},e.map),Object.sort(e.map,"id"),$.extend(e,this.nodes(e.map)),$.extend(this.data,e);const i=options.chain.tabs[options.chain.active]&&options.chain.tabs[options.chain.active].collapsed||[];this.renderer.draw(e.map,e.lines,i),this.grid(),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attachedElements&&WormholeTypeToolTips.attachedElements.length>0&&WormholeTypeToolTips.detach($("#chainMap .whEffect")),WormholeTypeToolTips.attach($("#chainMap .whEffect[data-icon]")),WormholeRouteToolTips.attach($("#chainMap .path span[data-tooltip]")),SystemActivityToolTips.attach($("#chainMap .nodeClass span[data-tooltip]")),this.drawing=!1,systemPanel.update()}!this.data.activity||new Date>this.data.activity.expires?(e.activity={},tripwire.esi.universeJumps().done(function(i,s,t){e.activity.expires=new Date(t.getResponseHeader("expires")),$.each(i,function(s){e.activity[i[s].system_id]={systemID:i[s].system_id,shipJumps:i[s].ship_jumps}})}).then(function(){return tripwire.esi.universeKills().done(function(i){$.each(i,function(s){e.activity[i[s].system_id]?(e.activity[i[s].system_id].podKills=i[s].pod_kills,e.activity[i[s].system_id].shipKills=i[s].ship_kills,e.activity[i[s].system_id].npcKills=i[s].npc_kills):e.activity[i[s].system_id]={systemID:i[s].system_id,podKills:i[s].pod_kills,shipKills:i[s].ship_kills,npcKills:i[s].npc_kills}})})}).then(function(){i.data.activity=i.activity(e.activity)})):e.map&&i.activity(this.data.activity),e.occupied&&(this.data.occupied=this.occupied(e.occupied)),e.flares&&(this.data.flares=this.flares(e.flares))}},this.updateCollapsed=function(e){options.chain.tabs[options.chain.active]&&(options.chain.tabs[options.chain.active].collapsed=e),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attachedElements&&WormholeTypeToolTips.attachedElements.length>0&&WormholeTypeToolTips.detach($("#chainMap .whEffect")),WormholeTypeToolTips.attach($("#chainMap .whEffect[data-icon]")),i.activity(i.data.activity),i.occupied(i.data.occupied),i.flares(i.data.flares),i.grid(),options.save()}};
var guidance_profiles={blueLootSystems:[17,40,41,55,72,53,74,160,162,163,196,197,164,181,187,133,159,903,905,1002,1013,1021,1026,1032,1038,1045,1290,1359,1390,1361,1397,1395,1391,1676,1679,1677,1840,1842,1847,1848,1852,1854,1855,1858,1866,1868,1873,1874,1881,1883,1894,1896,1897,1901,1902,1907,1914,1918,1922,1931,1932,1938,1946,1951,1952,1958,1959,1961,1939,1978,2415,2418,2414,2558,2559,2560,2568,2569,2571,2572,2769,2815,2816,2771,2800,2975,2977,2980,2988,2993,2992,3017,3018,3024,3030,3048,3055,3025,3029,3053,3271,3275,3279,3280,3281,3283,3284,3287,3305,3307,3312,3317,3318,3321,3322,3324,3329,3333,3335,3338,3339,3342,3344,3361,3363,2058,2065,2067,3394,3404,3412,3447,3449,3467,3469,3389,3402,3413,3409,2059,2190,2252,3553,3554,3555,3556,2191,2193,2187,4077,4078,4079,4084,4111,4112,4114,4083,4239,4240,4241,4288,4291,4296,4621,4623,5010,5011,5020,5009,5018,5017,5030,5031,5034,5035,5039,5040,5043,5052,5054,5276,5275],chainExits:[]};
const systemPanel=new function(){function e(e,t,n,s){const i=e?guidance.findShortestPath(tripwire.map.shortest,viewingSystemID-3e7,e):null;if(i){const e=i.length<=1,r=i[i.length-1]+3e7;return'<div class="'+n+'">'+s+": "+(e?"In chain: ":i.length-1+"j from ")+(t?chain.data.systemsInChainMap[r].pathHome.slice().reverse().map(function(e){return'<a href=".?system='+tripwire.systems[e.systemID].name+'">'+(e.name||tripwire.systems[e.systemID].name||"???")+"</a>"}).join(" &gt; "):'<a href=".?system='+tripwire.systems[r].name+'">'+tripwire.systems[r].name+"</a>")+(e?"":"<br/>"+systemRendering.renderPath(i.slice().reverse()))+"</div>"}return null}this.update=function(){var t=[e((chain.data.exits||[]).map(function(e){return e-3e7}),!0,"chain","To chain"),e(guidance_profiles.blueLootSystems,!1,"blue-loot","Blue loot buyer")].filter(function(e){return e}).join("");$("#infoExtra").html(t),Tooltips.attach($("#infoExtra [data-tooltip]"))}};
tripwire.active=function(t){var i=[],a=[];for(var e in t){var d=JSON.parse(t[e].activity);i.push(parseInt(d.editSig)),a.push(parseInt(d.editComment)),d.editSig&&$("#sigTable tr[data-id='"+d.editSig+"']").addClass("editing").find("td").animate({backgroundColor:"#001b47"},1e3),d.editComment&&$("#commentWrapper .comment[data-id='"+d.editComment+"'] .cke").length>0&&$("#commentWrapper .comment[data-id='"+d.editComment+"']").addClass("editing").find(".commentStatus").html(t[e].characterName+" is editing").fadeIn()}$("#sigTable tr.editing").each(function(){-1==$.inArray($(this).data("id"),i)&&$("#sigTable tr[data-id='"+$(this).data("id")+"']").removeClass("editing").find("td").animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})})}),$("#commentWrapper .editing").each(function(){-1==$.inArray($(this).data("id"),a)&&$("#commentWrapper .editing[data-id='"+$(this).data("id")+"']").removeClass("editing").find(".commentStatus").fadeOut(function(){$(this).html("")})})};
tripwire.makeSigInfo=function(t,e){if(!(e=e||Object.values(tripwire.client.wormholes).find(function(e){return e.initialID==t.id||e.secondaryID==t.id})))return!1;var i=t.id==e.initialID?tripwire.client.signatures[e.secondaryID]:tripwire.client.signatures[e.initialID];if(!i)return!1;let s;s=t.name?tripwire.systems[i.systemID]?"<a href='.?system="+tripwire.systems[i.systemID].name+"'>"+_.escape(t.name)+"</a>":_.escape(t.name):appData.genericSystemTypes[i.systemID]?appData.genericSystemTypes[i.systemID]:tripwire.systems[i.systemID]?"<a href='.?system="+tripwire.systems[i.systemID].name+"'>"+tripwire.systems[i.systemID].name+"</a>":"";const a=e.type||"???";return{id:t.id,leadsTo:s,wormhole:e,formattedType:e[e.parent+"ID"]==t.id?a:e.parent?"["+a+"]":"",lifeText:{critical:"EOL",stable:"Stable"}[e.life]||e.life}},tripwire.addSig=function(t,e,i){var s=void 0===(e=e||{}).animate||e.animate,a=(i=i||!1,{});const n=t.signatureID?'<a class="return-link" href="#" onclick="tripwire.setReturnSig(event, '+t.id+')">&gt;&gt; Set '+t.signatureID.substring(0,3).toUpperCase()+"-"+t.signatureID.substring(3)+" as return</a>":"";if("wormhole"==t.type){const e=tripwire.makeSigInfo(t);if(!e)return!1;a=e.wormhole;const s=e.leadsTo?e.leadsTo:t.signatureID&&t.signatureID.length&&"?"!=t.signatureID[0]?n:"";var r="<tr data-id='"+t.id+"' data-tooltip='' "+(i?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+formatSignatureID(t.signatureID)+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(a)+'">'+e.formattedType+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+s+"</td><td class='"+a.life+" "+options.signatures.alignment.sigLife+"'>"+e.lifeText+"</td><td class='"+a.mass+" "+options.signatures.alignment.sigMass+"'>"+a.mass+"</td></tr>",o=$(r)}else{const e="unknown"===t.type?n:t.name?linkSig(t.name):"";r="<tr data-id='"+t.id+"' data-tooltip='' "+(i?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+formatSignatureID(t.signatureID)+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+e+"</td></tr>",o=$(r)}Tooltips.attach($(o).find("[data-tooltip]")),$("#sigTable").append(o),"critical"==a.life?$(o).find("span[data-age]").countdown({until:moment.utc(t.lifeLeft).toDate(),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(o).find("span[data-age]").countdown({since:moment.utc(t.lifeTime).toDate(),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),s&&($(o).find("td").wrapInner('<div class="hidden" />').parent().find("td > div").slideDown(700,function(){$set=$(this),$set.replaceWith($set.contents())}),$(o).find("td").animate({backgroundColor:"#004D16"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})}))},tripwire.setReturnSig=function(t,e){t.preventDefault();const i=tripwire.signatures.returnSig,s=tripwire.client.signatures[e];i&&s&&sigDialog.overwriteSignature(e,function(t){i.signatureID=s.signatureID;const e={signatures:{update:[{wormhole:"dummy",signatures:[i]}]}};tripwire.refresh("refresh",e)})};
tripwire.API=function(){this.indicator,this.APIrefresh,this.API.expire=function(){var e={since:tripwire.API.APIrefresh,until:null,format:"MS",layout:"-{mnn}{sep}{snn}"};$("#APItimer").countdown("option",e)},this.API.refresh=function(){$.ajax({url:"api_update.php",cache:!1,dataType:"JSON",data:"indicator="+tripwire.API.indicator}).done(function(e){if(e&&e.APIrefresh){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),activity.refresh();var i={until:tripwire.API.APIrefresh,since:null,layout:"{mnn}{sep}{snn}"};$("#APItimer").countdown("option",i),setTimeout("tripwire.API.refresh();",$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)}else"-{mnn}{sep}{snn}"!==$("#APItimer").countdown("option","layout")&&$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))>120?setTimeout("tripwire.API.refresh();",1e3*($.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)):setTimeout("tripwire.API.refresh();",15e3)})},this.API.init=function(){$.ajax({url:"api_update.php",cache:!0,dataType:"JSON",data:"init=true"}).done(function(e){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),$("#APItimer").countdown({until:tripwire.API.APIrefresh,onExpiry:tripwire.API.expire,alwaysExpire:!0,compact:!0,format:"MS",serverSync:tripwire.serverTime.getTime,onTick:function(e){$("#APIclock").val(e[5]+1).trigger("change")}});var i="-{mnn}{sep}{snn}"===$("#APItimer").countdown("option","layout")?15:$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30;setTimeout("tripwire.API.refresh();",1e3*i)})},this.API.init()};
const automapState={pendingDecision:!1};tripwire.autoMapper=function(e,t){console.log("Automapper: Jump from "+e+" to "+t);var i=[];if(!$("#toggle-automapper").hasClass("active")||$("#toggle-automapper").hasClass("disabled"))return!1;if(automapState.pendingDecision)return console.info("Not automapping because there is an automap dialog up"),!1;if(!tripwire.systems[e]||!tripwire.systems[t])return!1;if(e==t)return!1;if(tripwire.systems[e].regionID>12e6||tripwire.systems[t].regionID>12e6)return console.info("Not automapping into abyssal or other special space"),!1;const s=[30000142,30002187];if(s.indexOf(e)>=0||s.indexOf(t)>=0)return console.info("Not automapping into likely pod-out destination"),!1;if(tripwire.client.EVE&&tripwire.client.EVE.stationID)return console.log("Automapper: Not recording because you are in a station"),!1;if(tripwire.client.EVE&&tripwire.client.EVE.shipTypeID&&$.inArray(parseInt(tripwire.client.EVE.shipTypeID),[33328,670])>=0)return console.log("Automapper: Not recording because you are in a pod"),!1;if(void 0!==tripwire.map.shortest[e-3e7]&&void 0!==tripwire.map.shortest[e-3e7][t-3e7])return console.log("Automapper: Not recording because this jump is a stargate"),!1;if($.map(tripwire.client.wormholes,function(i){const s=tripwire.client.signatures[i.initialID],n=tripwire.client.signatures[i.secondaryID];return s&&n&&(s.systemID==e&&n.systemID==t||s.systemID==t&&n.systemID==e)?i:null}).length>0)return console.log("Automapper: Not recording because the connection exists"),!1;function n(e){return chain.data.map.rows.filter(t=>t.c[0].systemID==e).length>0}if(n(e)&&n(t))return console.info("Not automapping because both systems are already in chain"),!1;var r={signatures:{add:[],update:[]}};const a=systemAnalysis.analyse(t).genericSystemType;var o=$.map(tripwire.client.wormholes,function(t){if(void 0!==tripwire.client.signatures[t.initialID]&&void 0!==tripwire.client.signatures[t.secondaryID]&&tripwire.client.signatures[t.initialID].systemID==e&&!tripwire.systems[tripwire.client.signatures[t.secondaryID].systemID]){if(appData.genericSystemTypes[tripwire.client.signatures[t.secondaryID].systemID]==a)return t;if(t.type&&appData.wormholes[t.type]&&appData.wormholes[t.type].leadsTo.replace(" ","-")==a)return t;if(!(null!==tripwire.client.signatures[t.secondaryID].systemID||t.type&&appData.wormholes[t.type]))return t}});if(o.length)if(o.length>1)console.log("Automapper: Multiple sigs matched, asking which one to update"),$("#dialog-select-signature").dialog({autoOpen:!0,title:"Which Signature?",width:390,buttons:{Cancel:function(){$(this).dialog("close")},Ok:function(){var e=$("#dialog-select-signature [name=sig]:checked").val(),s=o[e],n=tripwire.client.signatures[s.initialID],a=tripwire.client.signatures[s.secondaryID];r.signatures.update.push({wormhole:{id:s.id},signatures:[{id:n.id},{id:a.id,systemID:t}]});tripwire.refresh("refresh",r,function(e){e.resultSet&&1==e.resultSet[0].result&&(i.push({wormhole:s,signatures:[n,a]}),$("#dialog-select-signature").dialog("close"))})}},open:function(){function i(e){const t=systemAnalysis.analyse(e);return systemRendering.renderSystem(t)}automapState.pendingDecision=!0,$("#dialog-select-signature .optionsTable tbody").empty(),document.getElementById("select-sig-from").innerHTML=i(e),document.getElementById("select-sig-to").innerHTML=i(t),$.each(o,function(e){const t=tripwire.client.signatures[o[e].initialID],i=tripwire.makeSigInfo(t,o[e]),s="<tr><td><input type='radio' name='sig' value='"+e+"' id='sig"+e+"' /></td><td class='centerAlign'>"+formatSignatureID(t.signatureID)+"</td><td class='centerAlign'>"+i.formattedType+"</td><td class='centerAlign'>"+i.leadsTo+"</td><td class='centerAlign "+o[e].life+"'>"+i.lifeText+"</td><td class='centerAlign "+o[e].mass+"'>"+o[e].mass+"</td></tr>",n=$(s);$(n).find("td").wrapInner("<label for='sig"+e+"' />"),$("#dialog-select-signature .optionsTable tbody").append(n)})},close:function(){automapState.pendingDecision=!1}});else{var l=o[0],u=tripwire.client.signatures[l.initialID],p=tripwire.client.signatures[l.secondaryID];console.log("Automapper: Single signature: w="+JSON.stringify(l)+" s1="+u.id+"/"+u.signatureID+" s2="+p.id+"/"+p.signatureID),r.signatures.update.push({wormhole:{id:l.id},signatures:[{id:u.id},{id:p.id,systemID:t}]}),i.push({wormhole:l,signatures:[u,p]})}else console.log("Automapper: No signatures match, creating a new unknown hole"),r.signatures.add.push({wormhole:{type:null,parent:"initial",life:"stable",mass:"stable"},signatures:[{systemID:e,type:"wormhole"},{systemID:t,type:"wormhole"}]});if(r.signatures.add.length||r.signatures.update.length){tripwire.refresh("refresh",r,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),e.results&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:e.results}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:e.results}]),i.length&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:i}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:i}]),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}};
tripwire.comments=function(){this.comments.data={},this.comments.parse=function(t){for(var e in t){var m=t[e].id;if(Object.find(tripwire.comments.data,"id",m)||0!=$(".comment[data-id='"+m+"']").length){if(Object.find(tripwire.comments.data,"id",m)&&Object.find(tripwire.comments.data,"id",m).modified!=t[e].modified){i=$(".comment[data-id='"+m+"']");try{i.find(".commentBody").html(t[e].comment)}catch(t){i.find(".commentFooter").show(),i.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),i.find(".commentFooter .commentControls").hide()}i.find(".commentModified").html("Edited by "+t[e].modifiedByName+" at "+t[e].modified),i.find(".commentSticky").addClass(t[e].sticky?"active":"")}}else{var i=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(i),i.attr("data-id",m);try{i.find(".commentBody").html(t[e].comment)}catch(t){i.find(".commentFooter").show(),i.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),i.find(".commentFooter .commentControls").hide()}i.find(".commentModified").html("Edited by "+t[e].modifiedByName+" at "+t[e].modified),i.find(".commentCreated").html("Posted by "+t[e].createdByName+" at "+t[e].created),i.find(".commentBody").attr("id","comment"+o),i.find(".commentSticky").addClass(t[e].sticky?"active":""),i.removeClass("hidden"),Tooltips.attach(i.find("[data-tooltip]"))}}for(var e in tripwire.comments.data){m=tripwire.comments.data[e].id;if(!Object.find(t,"id",m))(i=$(".comment[data-id='"+m+"']")).remove()}tripwire.comments.data=t}},tripwire.comments();
tripwire.deleteSig=function(e){var a=$("#sigTable tr[data-id='"+e+"']");$(a).find("td:empty, a:empty").append("&nbsp;"),$(a).find("td").wrapInner("<div />").parent().find("td > div").animate({backgroundColor:"#4D0000"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3).slideUp(700,function(){$(a).find("span[data-age]").countdown("destroy"),$(this).parent().parent().remove(),$("#sigTable").trigger("update")})};
tripwire.editSig=function(t,a){a=a||!1;var i={};if("wormhole"==t.type){const n=tripwire.makeSigInfo(t);if(!n)return!1;i=n.wormhole;var e="<tr data-id='"+t.id+"' data-tooltip='' "+(a?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+formatSignatureID(t.signatureID)+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(i)+'">'+n.formattedType+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+(n.leadsTo||"")+"</td><td class='"+i.life+" "+options.signatures.alignment.sigLife+"'>"+n.lifeText+"</td><td class='"+i.mass+" "+options.signatures.alignment.sigMass+"'>"+i.mass+"</td></tr>",s=$(e)}else e="<tr data-id='"+t.id+"' data-tooltip='' "+(a?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+formatSignatureID(t.signatureID)+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+(0===parseInt(t.lifeLength)?" disabled":"")+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td></tr>",s=$(e);Tooltips.attach($(s).find("[data-tooltip]")),$("#sigTable tr[data-id='"+t.id+"']").find("span[data-age]").countdown("destroy"),$("#sigTable tr[data-id='"+t.id+"']").replaceWith(s),$("#sigTable").trigger("update"),"critical"==i.life?$(s).find("span[data-age]").countdown({until:moment.utc(t.lifeLeft).toDate(),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(s).find("span[data-age]").countdown({since:moment.utc(t.lifeTime).toDate(),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),$(s).effect("pulsate")};
tripwire.esi=function(){var e,a,t,i="https://esi.evetech.net",r="Tripwire Client "+tripwire.version+" ("+window.location.hostname+") - "+window.navigator.userAgent;this.esi.connection=!0,this.esi.characters={},this.esi.oauth={subject:"",accessToken:""};var s=function(e){return moment.utc(e).subtract(5,"minutes").isBefore(moment())};this.esi.location=function(){for(characterID in clearTimeout(e),tripwire.esi.characters){var a=tripwire.esi.characters[characterID];if(s(a.tokenExpire)){tripwire.data.esi={expired:!0};continue}const e=$.ajax({url:i+"/v1/characters/"+characterID+"/location/?"+$.param({token:a.accessToken,user_agent:r}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,t){var i=tripwire.esi.characters[this.characterID];if(i){if(i.locationDate=moment(t.getResponseHeader("last-modified"),"ddd, DD MMMM YYYY HH:mm:ss").format(),i.systemID!=e.solar_system_id){i.systemID=e.solar_system_id||null;const a=systemAnalysis.analyse(e.solar_system_id);i.systemName=a?a.name:null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".system").html(systemRendering.renderSystem(a)||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}}i.stationID!=e.station_id&&(i.stationID=e.station_id||null,e.station_id?tripwire.esi.stationLookup(e.station_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.stationName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".station").html(e.name.substring(0,17)+"..."||"&nbsp;").attr("data-tooltip",e.name),Tooltips.attach($("#tracking .tracking-clone[data-characterid='"+this.reference+"'] .station[data-tooltip]")),tripwire.data.tracking[this.reference]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(i.stationName=null,Tooltips.detach($("#tracking .tracking-clone[data-characterid='"+this.characterID+"'] .station[data-tooltip]")),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName})),options.tracking.active==this.characterID&&tripwire.EVE(tripwire.esi.characters[options.tracking.active])}}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a,t){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"))});e.always(function(){const a=e.getResponseHeader("warning");a&&console.warn("ESI API Warning: ",a,this.url)})}e=setTimeout("tripwire.esi.location()",5e3)},this.esi.ship=function(){for(characterID in clearTimeout(a),tripwire.esi.characters){var e=tripwire.esi.characters[characterID];if(s(e.tokenExpire)){tripwire.data.esi={expired:!0};continue}const a=$.ajax({url:i+"/v1/characters/"+characterID+"/ship/?"+$.param({token:e.accessToken,user_agent:r}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,t){var i=tripwire.esi.characters[this.characterID];i&&(i.shipDate=moment(t.getResponseHeader("last-modified"),"ddd, DD MMMM YYYY HH:mm:ss").format(),i.shipID!=e.ship_item_id&&(i.shipID=e.ship_item_id||null,tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.shipName!=e.ship_name&&(i.shipName=e.ship_name||null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".shipname").html(e.ship_name||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.shipTypeID!=e.ship_type_id&&(i.shipTypeID=e.ship_type_id||null,e.ship_type_id?tripwire.esi.typeLookup(e.ship_type_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.shipTypeName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".ship").html(e.name||"&nbsp;"),tripwire.data.tracking[this.reference]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(i.shipTypeName=null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".ship").html("&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName})))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a,t){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"))});a.always(function(){const e=a.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})}a=setTimeout("tripwire.esi.ship()",5e3)},this.esi.online=function(){for(characterID in clearTimeout(t),tripwire.esi.characters){var e=tripwire.esi.characters[characterID];tripwire.esi.characterStatus(e.characterID,e).done(function(e){e.online?$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("critical").addClass("stable"):$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")}).fail(function(e){var a;e&&403==e.status&&(a=this.reference.characterID,$("#tracking .tracking-clone[data-characterid='"+a+"']").find(".alert").show()),$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")})}t=setTimeout("tripwire.esi.online()",6e4)},this.esi.typeLookup=function(e,a){const t=$.ajax({url:i+"/v3/universe/types/"+e+"/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON",reference:a});return t.always(function(){const e=t.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.stationLookup=function(e,a){const t=$.ajax({url:i+"/v2/universe/stations/"+e+"/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON",reference:a});return t.always(function(){const e=t.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.setDestination=function(e,a,t,s){t=t||!1,s=s||!1;const n=$.ajax({url:i+"/v2/ui/autopilot/waypoint/?"+$.param({destination_id:e,clear_other_waypoints:t,add_to_beginning:s}),headers:{Authorization:"Bearer "+tripwire.esi.characters[a].accessToken,"X-User-Agent":r},type:"POST",dataType:"JSON"});return n.always(function(){const e=n.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.showInfo=function(e,a){const t=$.ajax({url:i+"/v1/ui/openwindow/information/?"+$.param({target_id:e}),headers:{Authorization:"Bearer "+tripwire.esi.characters[a].accessToken,"X-User-Agent":r},type:"POST",dataType:"JSON"});return t.always(function(){const e=t.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.characterStatus=function(e,a){const t=$.ajax({url:i+"/v2/characters/"+e+"/online/?"+$.param({token:tripwire.esi.characters[e].accessToken,user_agent:r}),type:"GET",dataType:"JSON",reference:a});return t.always(function(){const e=t.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.eveStatus=function(){const e=$.ajax({url:i+"/v1/status/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON"});return e.always(function(){const a=e.getResponseHeader("warning");a&&console.warn("ESI API Warning: ",a,this.url)})},this.esi.idLookup=function(e){const a=$.ajax({url:i+"/v2/universe/names/?"+$.param({user_agent:r}),type:"POST",dataType:"JSON",contentType:"application/json",processData:!1,data:JSON.stringify(e)});return a.always(function(){const e=a.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.characterLookup=function(e,a,t){t=void 0===t||t;const s=$.ajax({url:i+"/latest/characters/"+e+"/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON",async:t,eveID:e,reference:a});return s.always(function(){const e=s.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.corporationLookup=function(e,a,t){t=void 0===t||t;const s=$.ajax({url:i+"/v4/corporations/"+e+"/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON",async:t,eveID:e,reference:a});return s.always(function(){const e=s.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.allianceLookup=function(e,a,t){t=void 0===t||t;const s=$.ajax({url:i+"/v3/alliances/"+e+"/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON",async:t,eveID:e,reference:a});return s.always(function(){const e=s.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.search=function(e,a,t){const s=$.ajax({url:i+"/latest/characters/"+tripwire.esi.oauth.subject+"/search/?"+$.param({user_agent:r}),headers:{Authorization:"Bearer "+tripwire.esi.oauth.accessToken},type:"GET",dataType:"JSON",contentType:"application/json",data:{search:e,categories:a,strict:t}});return s.always(function(){const e=s.getResponseHeader("warning");e&&console.warn("ESI API Warning: ",e,this.url)})},this.esi.universeJumps=function(){const e=$.ajax({url:i+"/v1/universe/system_jumps/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON"});return e.always(function(){const a=e.getResponseHeader("warning");a&&console.warn("ESI API Warning: ",a,this.url)})},this.esi.universeKills=function(){const e=$.ajax({url:i+"/v2/universe/system_kills/?"+$.param({user_agent:r}),type:"GET",dataType:"JSON"});return e.always(function(){const a=e.getResponseHeader("warning");a&&console.warn("ESI API Warning: ",a,this.url)})},this.esi.fullLookup=function(e){var a=$.Deferred();return tripwire.esi.idLookup(e).done(function(e){for(item in e)"character"==e[item].category?tripwire.esi.characterLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),tripwire.esi.corporationLookup(a.corporation_id,this.reference,!1).done(function(a){e[item].corporation=a,a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})})}):"corporation"==e[item].category&&tripwire.esi.corporationLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})});a.resolve(e)}),a},this.esi.parseOauth=function(e){const a=e||{};tripwire.esi.oauth={subject:a.subject,accessToken:a.accessToken}},this.esi.parse=function(e){for(characterID in tripwire.esi.characters)characterID in e||(delete tripwire.esi.characters[characterID],$("#tracking .tracking-clone[data-characterid='"+characterID+"']").remove(),options.tracking.active==characterID&&(tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")));for(characterID in e){if("new"==options.tracking.active&&(options.tracking.active=characterID),!(characterID in tripwire.esi.characters)){var a=$("#tracking-clone").clone();a.attr("data-characterid",characterID),a.find(".avatar img").attr("src","https://image.eveonline.com/Character/"+characterID+"_32.jpg"),a.find(".name").html(e[characterID].characterName),a.removeAttr("id"),a.removeClass("hidden"),a.addClass("tracking-clone"),options.tracking.active==characterID&&(a.addClass("active"),$("#removeESI").removeAttr("disabled")),$("#tracking").append(a)}tripwire.esi.characters[characterID]=e[characterID]}set_tracking_text(),tripwire.esi.ship(),tripwire.esi.location(),tripwire.esi.online()}},tripwire.esi();
tripwire.EVE=function(e,t){var s=this.client.EVE&&this.client.EVE.systemChange||!1;e?(t||(this.client.EVE&&this.client.EVE.systemID!=e.systemID||1==s)&&(s=!0,s=!1,tripwire.autoMapper(this.client.EVE.systemID,e.systemID)),!t&&options.buttons.follow&&this.client.EVE&&this.client.EVE.systemID!=e.systemID&&0==$(".ui-dialog:visible").length&&tripwire.systemChange(e.systemID),$("#search").hasClass("active")||$("#currentSpan").show(),$("#toggle-automapper").removeClass("disabled"),e.systemID&&($("#dialog-signature [data-autocomplete='sigSystems']").hasClass("custom-combobox")&&($("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete("removeFromSelect"),$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete("addToSelect",tripwire.systems[e.systemID])),$("#EVEsystem").html(systemRendering.renderSystem(systemAnalysis.analyse(e.systemID))))):($("#EVEsystem").html("Not tracking"),$("#currentSpan").hide(),$("#toggle-automapper").addClass("disabled"),$("#dialog-signature [data-autocomplete='sigSystems']").hasClass("custom-combobox")&&$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete("removeFromSelect")),this.client.EVE={characterID:e.characterID,characterName:e.characterName,systemID:e.systemID,systemName:e.systemName,shipTypeID:e.shipTypeID,shipTypeName:e.shipTypeName,stationID:e.stationID,stationName:e.stationName,locationDate:e.locationDate,shipDate:e.shipDate,systemChange:s}};
appData.genericSystemTypes=["Null-Sec","Low-Sec","High-Sec","Class-1","Class-2","Class-3","Class-4","Class-5","Class-6","Class-13","Triglavian"];
tripwire.parse=function(i,t){var s=$.extend(!0,{},i),e=!1;const r={};if((null==options.chain.active||options.chain.tabs[options.chain.active]&&1!=options.chain.tabs[options.chain.active].evescout)&&"273.0"!=options.masks.active)for(var n in s.signatures)"273.0"==s.signatures[n].mask&&delete s.signatures[n];if("refresh"==t){var a=this.client.EVE;for(var n in this.client=i,this.client.EVE=a,s.signatures)if(s.signatures[n].systemID==viewingSystemID){r[n]=s.signatures[n];var g="273.0"==s.signatures[n].mask&&"273.0"!=options.masks.active;if(tripwire.signatures.list[n]){if(tripwire.signatures.list[n].modifiedTime!==s.signatures[n].modifiedTime){var u=!1;for(column in s.signatures[n])s.signatures[n][column]!=tripwire.signatures.list[n][column]&&"editing"!=column&&(u=!0);u&&this.editSig(s.signatures[n],g)}}else tripwire.signatures.list[n]=s.signatures[n],this.addSig(s.signatures[n],{animate:!0},g),e=!0}for(var n in tripwire.signatures.list)s.signatures[n]||this.deleteSig(n)}else{if("init"!=t&&"change"!=t)return;for(var n in this.client=i,s.signatures)if(s.signatures[n].systemID==viewingSystemID){r[n]=s.signatures[n];g="273.0"==s.signatures[n].mask&&"273.0"!=options.masks.active;tripwire.signatures.list[n]||(this.addSig(s.signatures[n],{animate:!1},g),e=!0),s.signatures[n].editing&&this.sigEditing(s.signatures[n])}}e&&$("#sigTable").trigger("update"),tripwire.signatures.list=s.signatures,tripwire.signatures.currentSystem=r;var o=0;$.map(s.signatures,function(i){i.systemID==viewingSystemID&&o++}),$("#signature-count").html(o)},tripwire.updateReturnStatus=function(){const i=$("#chainMap [data-nodeid='"+viewingSystemID+"']:not(.calc)").attr("data-insigid"),t=$("#chainMap [data-nodeid='"+viewingSystemID+"']:not(.calc)").attr("data-sigid"),s=tripwire.client.wormholes[t]||{},e=s.initialID==i?s.secondaryID:s.initialID;tripwire.signatures.returnSig=tripwire.signatures.list[e];const r=tripwire.signatures.returnSig&&("???"==tripwire.signatures.returnSig.signatureID||""==tripwire.signatures.returnSig.signatureID||null===tripwire.signatures.returnSig.signatureID||void 0===tripwire.signatures.returnSig.signatureID);document.getElementById("sigTableWrapper").className=r?"return-visible":"return-invisible"};
tripwire.pasteSignatures=function(){var e=!1,i=function(e){var i={},t=e.split("\t"),s=["Cosmic Signature","Cosmic Anomaly","Signature cosmique","Anomalie cosmique","Kosmische Anomalie","Kosmische Signatur","宇宙の特異点","宇宙のシグネチャ","코즈믹 시그니처","코즈믹 어노말리","Скрытый сигнал","Космическая аномалия"],r={"Combat Site":"Combat","Data Site":"Data","Gas Site":"Gas","Ore Site":"Ore","Relic Site":"Relic",Wormhole:"Wormhole","Site de combat":"Combat","Site de données":"Data","Site de collecte de gaz":"Gas","Site de minerai":"Ore","Site de reliques":"Relic","Trou de ver":"Wormhole",Kampfgebiet:"Combat",Datengebiet:"Data",Gasgebiet:"Gas",Mineraliengebiet:"Ore",Reliktgebiet:"Relic",Wurmloch:"Wormhole","戦闘サイト":"Combat","データサイト":"Data","ガスサイト":"Gas","鉱石サイト":"Ore","遺物サイト":"Relic","ワームホール":"Wormhole","전투 사이트":"Combat","데이터 사이트":"Data","가스 사이트":"Gas","채광 사이트":"Ore","유물 사이트":"Relic","웜홀":"Wormhole","Боевой район":"Combat","Информационный район":"Data","Газовый район":"Gas","Астероидный район":"Ore","Археологический район":"Relic","Червоточина":"Wormhole"};for(var n in t)t[n].match(/^([A-Z]{3}[-]\d{3})$/)?i.id=t[n].split("-"):t[n].match(/(\d([.|,]\d)?[ ]?(%))/)||t[n].match(/(\d[.|,]?\d+\s?(UA|AU|AE|km|m|а.е.|км|м))/i)||(-1==$.inArray(t[n],s)?r[t[n]]?i.type=r[t[n]]:""!=t[n]&&(i.name=t[n].trim()):i.scanGroup=t[n]);return!(!i.id||2!==i.id.length)&&i};this.pasteSignatures.parsePaste=function(t){t=t.split("\n");var s={signatures:{add:[],update:[]},systemID:viewingSystemID},r=[];for(var n in e=!0,t){var a=i(t[n]);if(a.id){var o=$.map(tripwire.client.signatures,function(e){if(e.signatureID&&e.signatureID.toUpperCase()==a.id[0]+a.id[1]&&e.systemID==viewingSystemID)return e})[0];if(o)if("Wormhole"==a.type&&"wormhole"!=o.type){var u=$.map(tripwire.client.wormholes,function(e){if(e.initialID==o.id||e.secondaryID==o.id)return e})[0]||{},l=u.id?o.id==u.initialID?tripwire.client.signatures[u.secondaryID]:tripwire.client.signatures[u.initialID]:{};s.signatures.update.push({wormhole:{id:u.id||null,type:u.type||null,life:u.life||"stable",mass:u.mass||"stable"},signatures:[{id:o.id,signatureID:o.signatureID,systemID:viewingSystemID,type:"wormhole",name:o.name},{id:l.id||null,signatureID:l.signatureID||null,systemID:l.systemID||null,type:"wormhole",name:l.name}]}),tripwire.client.wormholes[u.id]?r.push({wormhole:tripwire.client.wormholes[u.id],signatures:[tripwire.client.signatures[o.id],tripwire.client.signatures[l.id]]}):r.push(tripwire.client.signatures[o.id])}else"wormhole"!=o.type&&(a.type&&a.type.toLowerCase()!=o.type||a.name&&a.name!=o.name)&&(s.signatures.update.push({id:o.id,systemID:viewingSystemID,type:a.type||"unknown",name:a.name,lifeLength:60*options.signatures.pasteLife*60}),r.push(tripwire.client.signatures[o.id]));else"Wormhole"==a.type?s.signatures.add.push({wormhole:{type:null,parent:"initial",life:"stable",mass:"stable"},signatures:[{signatureID:a.id[0]+a.id[1],systemID:viewingSystemID,type:"wormhole",lifeLength:60*options.signatures.pasteLife*60},{signatureID:null,systemID:null,type:"wormhole",lifeLength:60*options.signatures.pasteLife*60}]}):s.signatures.add.push({signatureID:a.id[0]+a.id[1],systemID:viewingSystemID,type:a.type||"unknown",name:a.name,lifeLength:60*options.signatures.pasteLife*60})}}if(s.signatures.add.length||s.signatures.update.length){tripwire.refresh("refresh",s,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),e.results&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:e.results}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:e.results}]),r.length&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:r}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:r}]),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){e=!1})}else e=!1},this.pasteSignatures.init=function(){$(document).keydown(function(i){if((i.metaKey||i.ctrlKey)&&(86==i.keyCode||91==i.keyCode)&&!e){if($(document.activeElement).is("textarea, input"))return;$("#clipboard").focus()}}),$("body").on("click","#fullPaste",function(e){e.preventDefault();var t=$(this).data("paste").split("\n"),s=[],r=[],n=[];for(var a in t)(scan=i(t[a]))&&s.push((scan.id[0]+scan.id[1]).toLowerCase());for(var a in tripwire.client.signatures){var o=tripwire.client.signatures[a];if(o.systemID==viewingSystemID&&o.signatureID&&-1===$.inArray(o.signatureID.toLowerCase(),s)&&"???"!==o.signatureID)if("wormhole"==o.type){var u=$.map(tripwire.client.wormholes,function(e){if(e.initialID==o.id||e.secondaryID==o.id)return e})[0]||{},l=u.id?o.id==u.initialID?tripwire.client.signatures[u.secondaryID]:tripwire.client.signatures[u.initialID]:{};"GATE"!==u.type&&(r.push(u),n.push({wormhole:u,signatures:[o,l]}))}else r.push(o.id),n.push(o)}if(r.length>0){var p={signatures:{remove:r}};tripwire.refresh("refresh",p,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:n}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:n}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}}),$("#clipboard").on("paste",function(e){e.preventDefault();var i=window.clipboardData?window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData.getData("text/plain");$("#clipboard").blur(),Notify.trigger("Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)"),$("#fullPaste").data("paste",i),tripwire.pasteSignatures.parsePaste(i)})},this.pasteSignatures.init()},tripwire.pasteSignatures();
tripwire.redo=function(){if(tripwire.signatures.redo[viewingSystemID].length>0){$("#redo").addClass("disabled");var i=tripwire.signatures.redo[viewingSystemID].length-1,e={systemID:viewingSystemID,signatures:{add:[],remove:[],update:[]}},r=tripwire.signatures.redo[viewingSystemID][i],t=$.map(r.signatures,function(i){if(i.wormhole&&tripwire.client.wormholes[i.wormhole.id])return{wormhole:tripwire.client.wormholes[i.wormhole.id],signatures:[tripwire.client.signatures[i.signatures[0].id],tripwire.client.signatures[i.signatures[1].id]]};if(tripwire.client.signatures[i.id]&&"wormhole"==tripwire.client.signatures[i.id].type){var e=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0];return{wormhole:e,signatures:[tripwire.client.signatures[e.initialID],tripwire.client.signatures[e.secondaryID]]}}return i.wormhole&&tripwire.client.signatures[i.signatures[0].id]?tripwire.client.signatures[i.signatures[0].id]:tripwire.client.signatures[i.id]});switch(r.action){case"add":e.signatures.add=e.signatures.add.concat(r.signatures);break;case"remove":e.signatures.remove=e.signatures.remove.concat($.map(r.signatures,function(i){return i.wormhole?i.wormhole:i.id}));break;case"update":e.signatures.update=e.signatures.update.concat(r.signatures)}tripwire.refresh("refresh",e,function(i){i.resultSet&&1==i.resultSet[0].result&&(tripwire.signatures.redo[viewingSystemID].pop(),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?"add"==r.action?tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:i.results}):"update"==r.action?tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:t}):tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:r.signatures}):"add"==r.action?tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:i.results}]:"update"==r.action?tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:t}]:tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:r.signatures}],sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){tripwire.signatures.redo[viewingSystemID].length>0&&$("#redo").removeClass("disabled")})}};
tripwire.serverStatus=function(){this.data,this.timer,clearTimeout(tripwire.serverStatus.timer),tripwire.esi.eveStatus().always(function(e){e&&e.players&&e.players>0?(tripwire.serverStatus.data&&tripwire.serverStatus.data.players===e.players||($("#serverStatus").html("<span class='"+(e.players>0?"stable":"critical")+"'>TQ</span>: "+Intl.NumberFormat().format(e.players)),tripwire.serverStatus.data&&$("#serverStatus").effect("pulsate",{times:5})),tripwire.serverStatus.data=e):$("#serverStatus").html("<span class='critical'>TQ</span>"),tripwire.serverStatus.timer=setTimeout("tripwire.serverStatus();",15e3)})},tripwire.serverStatus(),tripwire.updateServerTime=function(){document.getElementById("serverTime").innerText=moment.utc().format("HH:mm")},setInterval(tripwire.updateServerTime,5e3),tripwire.updateServerTime();
tripwire.sync=function(e,i,t,r){i="object"==typeof i?$.extend(!0,{},i):{};return $.extend(!0,i,tripwire.data),this.timer&&clearTimeout(this.timer),this.xhr?(console.log("Awaiting existing XHR "+this.xhr.data.mode+": ",this.xhr),tripwire.data=i,this.timer=setTimeout(function(){tripwire.sync(e,i,t,r)},50),!1):("refresh"==e||"change"==e?(i.signatureCount=tripwire.serverSignatureCount,i.signatureTime=Object.maxTime(this.client.signatures,"modifiedTime"),i.flareCount=chain.data.flares?chain.data.flares.flares.length:0,i.flareTime=chain.data.flares?chain.data.flares.last_modified:0,i.commentCount=Object.keys(this.comments.data||{}).length,i.commentTime=Object.maxTime(this.comments.data,"modified"),i.activity=this.activity):($.extend(this,appData),this.aSigSystems=Object.assign(appData.genericSystemTypes.reduce(function(e,i,t){return e[t]=systemAnalysis.analyse(i),e[t].name=i,e},{}),this.systems),$(".systemsAutocomplete").inlinecomplete({source:this.systems,renderer:"system",maxSize:10,delay:0})),i.mode="init"!=e?"refresh":"init",i.systemID=viewingSystemID,i.systemName=viewingSystem,i.instance=tripwire.instance,i.version=tripwire.version,this.xhr=$.ajax({url:"refresh.php",data:i,type:"POST",dataType:"JSON",cache:!1}).done(function(i){if(i){if(tripwire.server=i,i.signatures&&(tripwire.serverSignatureCount=Object.keys(i.signatures||{}).length),i.wormholes){var r={},s={};for(var n in Object.values(i.wormholes).forEach(function(e){r[parseInt(e.initialID)]=e.id,s[parseInt(e.secondaryID)]=e.id}),i.signatures)if("wormhole"==i.signatures[n].type){var a=i.signatures[n].id;void 0===r[a]&&void 0===s[a]&&delete i.signatures[n]}}i.esi&&tripwire.esi.parse(i.esi),i.oauth&&tripwire.esi.parseOauth(i.oauth),i.sync&&(tripwire.serverTime.time=new Date(i.sync)),i.signatures&&tripwire.parse(i,e),i.comments&&tripwire.comments.parse(i.comments),i.wormholes||i.occupied||i.flares?tripwire.chainMap.parse({map:i.wormholes||null,occupied:i.occupied||null,flares:i.flares||null}):chain.data.occupied&&chain.data.occupied.length&&!i.occupied&&tripwire.chainMap.parse({occupied:[]}),tripwire.updateReturnStatus(),tripwire.active(i.activity),i.notify&&!$("#serverNotification")[0]&&Notify.trigger(i.notify,"yellow",!1,"serverNotification"),$("[data-command=ping]")[i.discord_integration?"show":"hide"]()}tripwire.data={tracking:{},esi:{}},t&&t(i)}).always(function(e,i){tripwire.timer=setTimeout("tripwire.refresh();",tripwire.refreshRate),r&&r(e),403==e.status?window.location.href=".":"success"!=i&&"abort"!=i&&1==tripwire.connected?(tripwire.connected=!1,$("#ConnectionSuccess").click(),Notify.trigger("Error syncing with server","red",!1,"connectionError")):"success"==i&&0==tripwire.connected&&(tripwire.connected=!0,$("#connectionError").click(),Notify.trigger("Successfully reconnected with server","green",5e3,"connectionSuccess")),tripwire.xhr=null}),this.xhr.data=i,!0)},tripwire.sync("init");
tripwire.systemChange=function(e,t){const s=systemAnalysis.analyse(e);if(s){if("init"!=t&&($("#infoSecurity").removeClass(),$("#infoStatics").empty(),viewingSystem=s.name,viewingSystemID=e,activity.refresh(!0),$("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=null,chain.redraw(),$("#notesWidget .content .comment:visible").remove(),tripwire.comments.data=null,history.replaceState(null,null,"?system="+viewingSystem),tripwire.refresh("change")),document.title=s.name+" - "+app_name,$("#infoSystem").text(s.name),-1!=$.inArray(parseInt(viewingSystemID),options.favorites)?$("#system-favorite").attr("data-icon","star").addClass("active"):$("#system-favorite").attr("data-icon","star-empty").removeClass("active"),s.class){if($("#infoSecurity").html("<span class='wh pointer'>Class "+s.class+"</span>"),s.effect){var i='<table cellpadding="0" cellspacing="1">';for(var a in tripwire.effects[s.effect]){var n=tripwire.effects[s.effect][a].name,r=tripwire.effects[s.effect][a].base,o=tripwire.effects[s.effect][a].bad,l=s.class>6?6:s.class,c=0;switch(Math.abs(r)){case 15:c=r>0?7:-7;break;case 30:c=r>0?14:-14;break;case 60:c=r>0?28:-28}i+="<tr><td>"+n+'</td><td style="padding-left: 25px; text-align: right;" class="'+(o?"critical":"stable")+'">',i+=r+c*(l-1)+"%</td></tr>"}i+="</table>",$("#infoSecurity").append("&nbsp;<span class='pointer' data-tooltip='"+i+"'>"+s.effect+"</span>")}for(var a in s.statics){var d=s.statics[a],p=appData.wormholes[d],m="wh";switch(p.leadsTo){case"High-Sec":m="hisec";break;case"Low-Sec":m="lowsec";break;case"Null-Sec":m="nullsec"}$("#infoStatics").append("<div><span class='"+m+"'>&#9679;</span> <b class='"+m+"'>"+p.leadsTo+"</b> via <span>"+wormholeRendering.renderWormholeType(p,d,s)+"</span></div>")}$("#infoFaction").html("&nbsp;")}else{const e={HS:"High-Sec",LS:"Low-Sec",NS:"Null-Sec",Trig:"Triglavian"}[s.systemTypeName];$("#infoSecurity").addClass(s.systemTypeClass).html(e+" "+s.baseSecurity.toFixed(2)+s.systemTypeModifiers.join(" ")),fw&&$("#infoFaction").html(fw.factionMarkup(s));const t=guidance.connections(tripwire.map.shortest,viewingSystemID);for(var f in t.length&&$("#infoStatics").append("<p><b>Gates</b>: "+t.map(e=>{const t=systemAnalysis.analyse(e.systemID);return e.closed?"<s>"+t.name+"</s> (closed)":systemRendering.renderSystem(t)}).join(", ")+"</p>"),options.favorites){const e=options.favorites[f],t=guidance.findShortestPath(tripwire.map.shortest,e,viewingSystemID);t&&$("#infoStatics").append('<p><b><a href=".?system='+tripwire.systems[e].name+'">'+tripwire.systems[e].name+"</a></b>: "+systemRendering.renderPath(t)+"</p>")}}Tooltips.attach($("#infoStatics [data-tooltip]")),Tooltips.attach($("#infoSecurity [data-tooltip]")),$("#infoRegion").text(tripwire.regions[s.regionID].name),$("#infoWidget .infoLink").each(function(){this.href=$(this).data("href").replace(/\$systemName/gi,s.name).replace(/\$systemID/gi,e)}),tripwire.signatures.undo[e]&&tripwire.signatures.undo[e].length>0?$("#undo").removeClass("disabled"):$("#undo").addClass("disabled"),tripwire.signatures.redo[e]&&tripwire.signatures.redo[e].length>0?$("#redo").removeClass("disabled"):$("#redo").addClass("disabled"),0==$("#sigTable tr.selected").length?$("#signaturesWidget #delete-signature").addClass("disabled"):$("#signaturesWidget #delete-signature").removeClass("disabled")}},setTimeout(()=>tripwire.systemChange(viewingSystemID,"init"),0);
var tutorial;$("#infoWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#infoWidget"),intro:"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>"},{element:document.querySelector("#infoGeneral"),intro:"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>"},{element:document.querySelector("#activityGraph"),intro:"<p>For K space systems, a graph is shown here containing hourly ship jump and kill information from the EVE API.</p><br/><p>Each category can be toggled by clicking the keys above the graph, and the time period selected with the links below.</p>"},{element:document.querySelector("#infoStatics"),intro:"<p>If a wormhole system is selected, its static wormhole types will appear here. (A static is a wormhole which is always present; when it is closed or expires, a new one will spawn.)</p><br/><p>In K space, the route to each of your favorite systems is shown here.</p>"},{element:document.querySelector("#favorite-control-wrapper"),intro:"<p>Use the star to toggle whether this is a 'favorite' system. It shows orange when the current system is a favorite. The other button shows the Favorites panel which will show you all your favorite systems.</p><br/><p>'Favorite' systems in K space can be shown in the chain map, and in the routing panel to the lower left.</p>"},{element:document.querySelector("#show-favorite"),intro:"<p>Use this toggle to show favorite systems and their routes on the chain map.</p>"},{element:document.querySelector("#infoExtra"),intro:"<p>For K space systems, the shortest route to the currently visible chain will be shown here, along with the route within the chain.</p>"},{element:document.querySelector("#infoLinks"),intro:"<p>These are some quick links to various sites for this specific system.</p>"}]}).start()}),$("#signaturesWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#signaturesWidget"),intro:"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>"},{element:document.querySelector("#add-signature"),intro:"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>"},{element:document.querySelector("#delete-signature"),intro:"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>"},{element:document.querySelector("#signature-count"),intro:"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>"},{element:document.querySelector("#undo"),intro:"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#redo"),intro:"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#toggle-automapper"),intro:"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>"},{element:document.querySelector("#sigTable"),intro:"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>"}]}).start()}),$("#notesWidget .tutorial").click(function(e){e.preventDefault(),(tutorial=introJs().setOptions({showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,skipLabel:"Abort",steps:[{element:document.querySelector("#notesWidget"),intro:"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>"},{element:document.querySelector("#add-comment"),intro:"<p>Now click the + icon to begin adding a new comment in this system ("+viewingSystem+").</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Type some basic text now and click save.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Click on the <b>Edit</b> now on our comment.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>"}]}).start()).onchange(function(e){switch(tutorial._currentStep){case 1:$(".introjs-prevbutton, .introjs-nextbutton").hide(),console.log("switch mask to private"),tutorial.previousMask=options.masks.active,options.masks.active=options.character.id+".1",options.save(),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[2].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(3),tutorial.exiting=!0},200)},$("#notesWidget #add-comment").on("click",tutorial.stepFunc);break;case 2:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),tutorial.stepFunc=function(){tutorial.comment=$(this).closest(".comment"),setTimeout(function(){tutorial._options.steps[3].element=tutorial.comment[0],tutorial._options.steps[4].element=tutorial.comment.find(".commentSticky")[0],tutorial._options.steps[5].element=tutorial.comment.find(".commentControls")[0],tutorial._options.steps[6].element=tutorial.comment.find(".commentControls")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(4),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentSave",tutorial.stepFunc);break;case 6:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[7].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial._options.steps[8].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(8),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentEdit",tutorial.stepFunc)}}),tutorial.onexit(function(){if(tutorial.exiting){if($(".commentCancel:visible").click(),tutorial.comment){var e={mode:"delete",commentID:tutorial.comment.data("id")};$.ajax({url:"comments.php",type:"POST",data:e,dataType:"JSON"}).done(function(e){e&&1==e.result&&tutorial.comment.remove()})}tutorial.previousMask&&setTimeout(function(){console.log("change mask back, delete comment",tutorial.previousMask),options.masks.active=tutorial.previousMask,options.save()},200),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),$("#notesWidget").off("click",".commentEdit",tutorial.stepFunc),$("#notesWidget").off("click",".cke_toolgroup:has(.cke_button__toolbarswitch)",tutorial.stepFunc)}}),tutorial.previousMask,tutorial.comment,tutorial.stepFunc,tutorial.exiting=!0});
tripwire.undo=function(){if(tripwire.signatures.undo[viewingSystemID].length>0){$("#undo").addClass("disabled");var i=tripwire.signatures.undo[viewingSystemID].length-1,e={systemID:viewingSystemID,signatures:{add:[],remove:[],update:[]}},r=tripwire.signatures.undo[viewingSystemID][i],t=$.map(r.signatures,function(i){if(i.wormhole&&tripwire.client.wormholes[i.wormhole.id])return{wormhole:tripwire.client.wormholes[i.wormhole.id],signatures:[tripwire.client.signatures[i.signatures[0].id],tripwire.client.signatures[i.signatures[1].id]]};if(tripwire.client.signatures[i.id]&&"wormhole"==tripwire.client.signatures[i.id].type){var e=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0];return{wormhole:e,signatures:[tripwire.client.signatures[e.initialID],tripwire.client.signatures[e.secondaryID]]}}return i.wormhole&&tripwire.client.signatures[i.signatures[0].id]?tripwire.client.signatures[i.signatures[0].id]:tripwire.client.signatures[i.id]});switch(r.action){case"add":e.signatures.remove=e.signatures.remove.concat($.map(r.signatures,function(i){return i.wormhole?i.wormhole:i.id}));break;case"remove":e.signatures.add=e.signatures.add.concat(r.signatures);break;case"update":e.signatures.update=e.signatures.update.concat(r.signatures)}tripwire.refresh("refresh",e,function(i){i.resultSet&&1==i.resultSet[0].result&&(tripwire.signatures.undo[viewingSystemID].pop(),$("#redo").removeClass("disabled"),viewingSystemID in tripwire.signatures.redo?"remove"==r.action?tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:i.results}):"update"==r.action?tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:t}):tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:r.signatures}):"remove"==r.action?tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:i.results}]:"update"==r.action?tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:t}]:tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:r.signatures}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)))},function(i){tripwire.signatures.undo[viewingSystemID].length>0&&$("#undo").removeClass("disabled")})}};
var activity=new function(){this.graph,this.options,this.view,this.span=24,this.columns=[{id:"time",label:"Time",role:"domain",type:"string",calc:function(t,i){return t.getValue(i,0)+"h"}},{id:"jumps",label:"Jumps",role:"data",type:"number",sourceColumn:1,column:1,title:"Jumps"},{id:"podkills",label:"Pod Kills",role:"data",type:"number",sourceColumn:2,column:2,title:"Pod Kills"},{id:"shipkills",label:"Ship Kills",role:"data",type:"number",sourceColumn:3,column:3,title:"Ship Kills"},{id:"npckills",label:"NPC Kills",role:"data",type:"number",sourceColumn:4,column:4,title:"NPC Kills"}],this.getData=function(t,i){t=void 0!==t?t:this.span,i=void 0===i||i;return activity.graph?$.ajax({url:"activity_graph.php",data:{systemID:viewingSystemID,time:t},type:"GET",dataType:"JSON",cache:i}).done(function(t){t&&(t.rows.reverse(),activity.view=new google.visualization.DataView(new google.visualization.DataTable(t)),activity.view.setColumns(activity.columns),activity.graph.draw(activity.view,activity.options))}):(setTimeout(function(){activity.getData(t,i)},500),!1)},this.selectHandler=function(){var t=activity.graph.getSelection();if(t[0]&&null==t[0].row){var i=t[0].column;activity.columns[i].sourceColumn?(activity.columns[i].label=activity.columns[i].title+" (off)",delete activity.columns[i].sourceColumn):(activity.columns[i].sourceColumn=activity.columns[i].column,activity.columns[i].label=activity.columns[i].title),activity.view.setColumns(activity.columns),activity.options.animation.duration=0,activity.graph.draw(activity.view,activity.options),activity.options.animation.duration=500}},this.init=function(){activity.graph=new google.visualization.AreaChart(document.getElementById("activityGraph")),activity.options={isStacked:!1,backgroundColor:"transparent",hAxis:{textStyle:{color:"#999",fontName:"Verdana",fontSize:10},showTextEvery:3},vAxis:{textStyle:{color:"#666",fontName:"Verdana",fontSize:10},viewWindowMode:"maximized",viewWindow:{min:0},maxValue:5},gridlineColor:"#454545",pointSize:2,lineWidth:1,height:150,chartArea:{left:"10%",top:"5%",width:"88%",height:"85%"},legend:{position:"in",textStyle:{color:"#CCC",fontName:"Verdana",fontSize:8.5}},animation:{duration:500,easing:"inAndout"},tooltip:{showColorCode:!0},annotations:{style:"line",textStyle:{fontSize:12,color:"#ccc"},domain:0},focusTarget:"category"},google.visualization.events.addListener(activity.graph,"select",activity.selectHandler),activity.getData(activity.span)},this.time=function(t){switch(t){case 24:this.options.hAxis.showTextEvery=3;break;case 48:this.options.hAxis.showTextEvery=6;break;case 168:this.options.hAxis.showTextEvery=24}this.span=t,this.getData(t)},this.redraw=function(){this.graph.draw(this.view,this.options)},this.refresh=function(t){this.getData(this.span,t)},google.charts.setOnLoadCallback(this.init)};
var CKConfig={skin:"custom",height:100,allowedContent:!0,extraPlugins:"toolbarswitch,autogrow,autolink",enterMode:CKEDITOR.ENTER_BR,removeDialogTabs:"link:advanced",autoGrow_onStartup:!0,autoGrow_minHeight:100,toolbar_minToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike"]},{name:"paragraph",items:["BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize"]},{name:"tools",items:["Toolbarswitch"]}],toolbar_maxToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize","Font"]},{name:"tools",items:["Source","Toolbarswitch"]}],toolbar:"minToolbar",smallToolbar:"minToolbar",maximizedToolbar:"maxToolbar",fontSize_style:{element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]}};CKEDITOR.on("instanceLoaded",function(e){e.editor.on("contentDom",function(){e.editor.on("key",function(t){return 27==t.data.keyCode?($(e.editor.element.$).closest(".comment").find(".commentCancel").click(),!1):t.data.domEvent.$.altKey&&83==t.data.domEvent.$.keyCode?($(e.editor.element.$).closest(".comment").find(".commentSave").click(),!1):void 0})}),$(".cke_combo__font a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>'),$(".cke_combo__fontsize a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>')}),CKEDITOR.on("instanceReady",function(e){e.editor.focus();var t=e.editor.getSelection(),o=t.getRanges(),n=o[0].startContainer,a=n.getParents(!0);if(!(n=a[a.length-2].getFirst()))return!1;for(;;){var i=n.getNext();if(null==i)break;n=i}t.selectElement(n),(o=t.getRanges())[0].collapse(!1),t.selectRanges(o)}),CKEDITOR.on("dialogDefinition",function(e){"link"==e.data.name&&(e.data.definition.getContents("target").get("linkTargetType").default="_blank")});
function commentSortHandler(t){const e=document.getElementById("comment-sort"),o=document.getElementById("comment-container");switch(t=t||e.nextSort||getCookie("commentSort")||"asc"){case"asc":e.nextSort="desc",e.setAttribute("data-icon","sort-asc"),o.style.flexDirection="column";break;case"desc":e.nextSort="asc",e.setAttribute("data-icon","sort-desc"),o.style.flexDirection="column-reverse";break;default:throw"sort order somehow wrong"}setCookie("commentSort",t,3650)}$("body").on("dblclick",".comment",function(t){t.preventDefault(),document.getSelection().removeAllRanges(),$(this).find(".commentEdit").click()}),$("body").on("click",".commentEdit",function(t){if(t.preventDefault(),$(".cke").length)return!1;var e=$(this).closest(".comment");e.find(".commentToolbar").hide(),CKEDITOR.replace(e.find(".commentBody").attr("id"),CKConfig).on("instanceReady",function(){e.find(".commentStatus").html(""),e.find(".commentFooter").show(),e.find(".commentFooter .commentControls").show()}),tripwire.activity.editComment=e.data("id"),tripwire.refresh("refresh")}),$("body").on("click",".commentSave, .commentCancel",function(t){t.preventDefault();var e=$(this);if(e.attr("disabled"))return!1;var o=e.closest(".comment");if(e.attr("disabled","true"),e.hasClass("commentSave")){var n={mode:"save",commentID:o.data("id"),systemID:o.find(".commentSticky").hasClass("active")?0:viewingSystemID,comment:CKEDITOR.instances[o.find(".commentBody").attr("id")].getData()};$.ajax({url:"comments.php",type:"POST",data:n,dataType:"JSON"}).done(function(t){t&&1==t.result&&(o.find(".commentModified").html("Edited by "+t.comment.modifiedByName+" at "+t.comment.modifiedDate),o.find(".commentCreated").html("Posted by "+t.comment.createdByName+" at "+t.comment.createdDate),Tooltips.attach(o.find("[data-tooltip]")),CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!1),o.attr("data-id",t.comment.id),o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),e.removeAttr("disabled"))})}else CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!0),o.attr("data-id")?(o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),e.removeAttr("disabled")):o.remove();o.find(".commentStatus").html(""),delete tripwire.activity.editComment,tripwire.refresh("refresh")}),$("body").on("click",".commentDelete",function(t){t.preventDefault();var e=$(this).closest(".comment");$("#dialog-deleteComment").hasClass("ui-dialog-content")?$("#dialog-deleteComment").dialog("isOpen")||$("#dialog-deleteComment").data("comment",e).dialog("open"):$("#dialog-deleteComment").data("comment",e).dialog({resizable:!1,minHeight:0,position:{my:"center",at:"center",of:$("#notesWidget")},dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("disable");var t=$(this).data("comment"),e={mode:"delete",commentID:t.data("id")};$.ajax({url:"comments.php",type:"POST",data:e,dataType:"JSON"}).done(function(e){e&&1==e.result&&($("#dialog-deleteComment").dialog("close"),t.remove())}).always(function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}}})}),$("body").on("click","#add-comment",function(t){if(t.preventDefault(),$(".cke").length)return!1;var e=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(e),e.find(".commentBody").attr("id","comment"+o),e.removeClass("hidden").find(".commentEdit").click()}),$("body").on("click",".commentSticky",function(t){t.preventDefault();var e=$(this).closest(".comment"),o={mode:"sticky",commentID:e.data("id"),systemID:e.find(".commentSticky").hasClass("active")?viewingSystemID:0};$.ajax({url:"comments.php",type:"POST",data:o,dataType:"JSON"}).done(function(t){t&&1==t.result&&(e.find(".commentSticky").hasClass("active")?e.find(".commentSticky").removeClass("active"):e.find(".commentSticky").addClass("active"))})}),$("body").on("click","#comment-sort",function(t){commentSortHandler(void 0)}),commentSortHandler();
const fw=new _FactionWarfare;function _FactionWarfare(){const t=this;this.listeners=[],this.data=null,this.systems={},this.SamanuniAthounonGateOpen=!0,this.refresh=function(){$.ajax({url:"cached_third_party.php?key=fw",type:"GET",dataType:"JSON"}).done(function(s,e,n){_.isEqual(s,t.data)||(console.info("Updating faction warfare status"),t.data=s,t.parse(s),tripwire.systemChange(viewingSystemID),guidance.clearCache())}).fail(function(t,s,e){console.warn("Failed to fetch FW data from ESI: "+s,e)})},this.parse=function(t){this.systems={};for(var s=0;s<t.length;s++)this.systems[t[s].solar_system_id]=t[s];this.SamanuniAthounonGateOpen=500001==this.systems[30003856].occupier_faction_id},this.adjustJumpCost=function(t,s,e){return this.SamanuniAthounonGateOpen||!(3856==t&&45322==s||3856==s&&45322==t)?e:-1}.bind(this),guidance.jumpCostModifiers.push(this.adjustJumpCost),this.factionMarkup=function(s){return s.factionID?t.systems[s.systemID]?appData.factions[t.systems[s.systemID].occupier_faction_id].name+" (FW: "+("uncontested"==t.systems[s.systemID].contested?"uncontested":Math.floor(100*t.systems[s.systemID].victory_points/t.systems[s.systemID].victory_points_threshold)+"% contested")+")":appData.factions[s.factionID].name:"&nbsp;"},setInterval(this.refresh,36e5),this.refresh()}
const wormholeAnalysis=new function(){function e(e,s){return e&&Object.assign({key:s},e)}this.targetSystemID=function(e,s){const o=e||(appData.wormholes[(s+"").toUpperCase()]||{}).leadsTo;return o?Object.index(appData.systems,"name",o,!0)?Object.index(appData.systems,"name",o,!0):s&&appData.wormholes[s.toUpperCase()]?appData.genericSystemTypes.findIndex(e=>o.replace(" ","-").toLowerCase()===e.toLowerCase())>-1?appData.genericSystemTypes.findIndex(e=>o.replace(" ","-").toLowerCase()===e.toLowerCase()):void 0:-1!==appData.genericSystemTypes.findIndex(e=>o.toLowerCase()===e.toLowerCase())?appData.genericSystemTypes.findIndex(s=>e.toLowerCase()===s.toLowerCase()):null:null},this.eligibleWormholeTypes=function(s,o,t){const n=function(e){return null==e||e.genericSystemType?e:systemAnalysis.analyse(e)},a=n(s),r=n(o);if(!a&&!r)return null;const i=[],m=[],l=function(e,s,o){return"string"==typeof e&&(e=[e]),!o||(!e||e.indexOf(o.name)>=0||e.indexOf(o.genericSystemType)>=0)&&(!s||s.indexOf(o.genericSystemType)<0)};return Object.entries(t||appData.wormholes).forEach(function(s){const o=s[1],t=s[0];l(o.from,o.notFrom,a)&&l(o.leadsTo,o.notLeadsTo,r)&&i.push(e(o,t)),l(o.from,o.notFrom,r)&&l(o.leadsTo,o.notLeadsTo,a)&&m.push(e(o,t))}),{from:i,to:m}},this.dummyWormholes={GATE:{from:["Null-Sec","Low-Sec","High-Sec","Triglavian"],leadsTo:["Null-Sec","Low-Sec","High-Sec","Triglavian"]},SML:{jump:5e6},MED:{jump:62e6},LRG:{jump:375e6},XLG:{jump:2e9}},this.wormholeFromTypePair=function(e,s){return appData.wormholes[e]||appData.wormholes[s]||this.dummyWormholes[e]||this.dummyWormholes[s]||void 0},this.likelyWormhole=function(e,s){const o=systemAnalysis.analyse(e).class,t=systemAnalysis.analyse(s).class;return this.dummyWormholes[13==o||13==t?"SML":1==o||1==t?"MED":o>=5&&t>=5?"XLG":"LRG"]}};
$("#admin").click(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return!1;if($("#dialog-admin").hasClass("ui-dialog-content"))$("#dialog-admin").dialog("isOpen")||$("#dialog-admin").dialog("open");else{var i=null,d=null,t=null;function o(){t&&t.abort(),d.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length),t=$.ajax({url:"admin.php",type:"POST",data:{mode:$("#dialog-admin .menu .active").attr("data-window")},dataType:"JSON"}).done(function(a){if(a&&a.results){for(var i=a.results,t=[],o=0,e=i.length;o<e;o++){var n=$("#dialog-admin .window .hasFocus tbody tr[data-id='"+i[o].id+"']");if(t.push(i[o].id),n.length)for(col in i[o]){(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?Intl.NumberFormat().format(i[o][col]):i[o][col])||"&nbsp;")}else{for(col in(n=$("#dialog-admin .window .hasFocus table tr.hidden").clone()).attr("data-id",i[o].id),i[o]){var l;(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?Intl.NumberFormat().format(i[o][col]):i[o][col])||"&nbsp;")}n.removeClass("hidden"),$("#dialog-admin .window .hasFocus tbody").append(n)}}$("#dialog-admin .window .hasFocus table tr[data-id]").each(function(){-1==$.inArray($(this).data("id").toString(),t)&&$(this).remove()}),$("#dialog-admin .window .hasFocus table").trigger("update",[!0])}else $("#dialog-admin .window .hasFocus table tr[data-id]").remove();d.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length)}),$("#dialog-admin").dialog("isOpen")&&$("#dialog-admin .menu .active").attr("data-refresh")&&(i=setTimeout(o,$("#dialog-admin .menu .active").attr("data-refresh")))}$("#dialog-admin").dialog({autoOpen:!0,modal:!0,height:350,width:800,buttons:{Close:function(){$(this).dialog("close")}},create:function(){$("#dialog-admin").on("click",".menu li",function(a){a.preventDefault(),$menuItem=$(this),clearTimeout(i),$("#dialog-admin .menu .active").removeClass("active"),$menuItem.addClass("active"),$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane").html(""),$("#dialog-admin .window [data-window]").removeClass("hasFocus").hide(),$("#dialog-admin .window [data-window='"+$menuItem.data("window")+"']").addClass("hasFocus").show(),o()}),$("#dialog-admin [data-sortable='true']").tablesorter({sortReset:!0,widgets:["saveSort"],sortList:[[0,0]]}),$($(this)[0].parentElement).find(".ui-dialog-buttonpane").append("<div class='ui-dialog-traypane'></div>"),d=$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane")},open:function(){$menuItem=$("#dialog-admin .menu li.active"),o()},close:function(){clearTimeout(i)}})}});
$("#wrapper").addClass("transition"),$(document).on("dialogopen",".ui-dialog",function(i,s){2==$(".ui-dialog:visible").length&&$(this).hasClass("dialog-modal")?$("body").append($("<div id='overlay' class='overlay' />").css("z-index",$(this).css("z-index")-1)):$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-1),$(this).hasClass("dialog-noeffect")||$("#wrapper").addClass("blur")}),$(document).on("dialogclose",".ui-dialog",function(i,s){$(".ui-dialog").is(":visible")||$("#wrapper").removeClass("blur"),1==$(".ui-dialog:visible").length?$("#overlay").remove():$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-2)});
$(".options").click(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return!1;$("#dialog-options").dialog({autoOpen:!1,width:450,minHeight:400,modal:!0,buttons:{Save:function(){JSON.stringify(options);var a=!1;$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!0).addClass("ui-state-disabled"),options.chain.typeFormat=$("#dialog-options #typeFormat").val(),options.chain.classFormat=$("#dialog-options #classFormat").val(),options.chain.sigNameLocation=$("#dialog-options #chainSigNameLocation").val(),options.chain.routingLimit=1*$("#dialog-options #chainRoutingLimit").val(),options.chain.routeSecurity=$("#dialog-options #chainRouteSecurity").val(),options.chain.routeIgnore.enabled=$("#dialog-options #route-ignore-enabled").prop("checked"),options.chain.routeIgnore.systems=$("#dialog-options #route-ignore").val().split(",").map(a=>a.trim()),options.chain.gridlines=JSON.parse($("#dialog-options input[name=gridlines]:checked").val()),options.chain.aura=JSON.parse($("#dialog-options input[name=aura]:checked").val()),options.chain.nodeSpacing.x=$("#dialog-options #node-spacing-x-slider").slider("value"),options.chain.nodeSpacing.y=$("#dialog-options #node-spacing-y-slider").slider("value"),options.chain["node-reference"]=$("#dialog-options input[name=node-reference]:checked").val(),options.chain.renderer=$("#dialog-options #renderer").val(),options.signatures.editType=$("#dialog-options #editType").val(),options.signatures.pasteLife=$("#dialog-options #pasteLife").val(),options.signatures.copySeparator=$("#dialog-options #copySeparator").val(),options.background=$("#dialog-options #background-image").val(),options.uiscale=$("#dialog-options #uiscale-slider").slider("value"),options.masks.active!=$("#dialog-options input[name='mask']:checked").val()&&(a=!0),options.masks.active=$("#dialog-options input[name='mask']:checked").val(),options.apply(),options.save().done(function(){a&&($("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=[],tripwire.refresh("change"))}),$("#dialog-options").dialog("close"),$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!1).removeClass("ui-state-disabled"),$("#dialog-options input[name='mask']:checked").data("admin")?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")},Reset:function(){$("#dialog-confirm #msg").html("Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>"),$("#dialog-confirm").dialog("option",{buttons:{Reset:function(){options.reset(),options.apply(),$("#dialog-options").dialog("close"),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")},Close:function(){$(this).dialog("close")}},open:function(){$.ajax({url:"user_stats.php",type:"POST",dataType:"JSON"}).done(function(a){for(i in a.stats)for(x in a.stats[i])$("#optionsAccordion #"+x).text(a.stats[i][x]);$("#optionsAccordion #systems_visited").text(a.system_visits),$("#optionsAccordion #logins").text(a.account.logins),$("#optionsAccordion #lastLogin").text(a.account.lastLogin),$("#optionsAccordion #username").text(a.username)}),$.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(a){if(a&&a.masks){for(var e in $("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html(""),a.masks){var o=a.masks[e],i=$('<input type="radio" name="mask" id="mask'+e+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+e+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+a.masks[a.active].mask+"']").attr("checked",!0).trigger("change"),a.masks[a.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-options #editType").val(options.signatures.editType),$("#dialog-options #pasteLife").val(options.signatures.pasteLife),$("#dialog-options #copySeparator").val(options.signatures.copySeparator),$("#dialog-options #typeFormat").val(options.chain.typeFormat),$("#dialog-options #chainRoutingLimit").val(options.chain.routingLimit),$("#dialog-options #chainSigNameLocation").val(options.chain.sigNameLocation),$("#dialog-options #chainRouteSecurity").val(options.chain.routeSecurity),$("#dialog-options #route-ignore-enabled").prop("checked",options.chain.routeIgnore.enabled),$("#dialog-options #route-ignore").val(options.chain.routeIgnore.systems.join(",")),$("#dialog-options #renderer").val(options.chain.renderer),$("#dialog-options #classFormat").val(options.chain.classFormat),$("#dialog-options input[name='node-reference'][value='"+options.chain["node-reference"]+"']").prop("checked",!0),$("#dialog-options input[name='gridlines'][value='"+options.chain.gridlines+"']").prop("checked",!0),$("#dialog-options input[name='aura'][value='"+options.chain.aura+"']").prop("checked",!0),$("#dialog-options #node-spacing-x-slider").slider("value",options.chain.nodeSpacing.x),$("#dialog-options #node-spacing-y-slider").slider("value",options.chain.nodeSpacing.y),$("#dialog-options #background-image").val(options.background)},create:function(){function a(a,e,o){$("#"+a).slider({min:.7,max:1.4,step:.05,value:e||1,change:o,slide:function(e,o){$("label[for='"+a+"']").html(o.value)}}),$("label[for='"+a+"']").html($("#"+a).slider("value"))}$("#optionsAccordion").accordion({heightStyle:"content",collapsible:!0,active:!1}),a("uiscale-slider",options.uiscale,function(a,e){$("body").css("zoom",e.value)}),a("node-spacing-x-slider",options.chain.nodeSpacing.x),a("node-spacing-y-slider",options.chain.nodeSpacing.y),$("#dialog-pwChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#pwForm").submit()},Cancel:function(){$(this).dialog("close")}},close:function(){$("#pwForm input[name='password'], #pwForm input[name='confirm']").val(""),$("#pwError").text("").hide()}}),$("#pwChange").click(function(){$("#dialog-pwChange").dialog("open")}),$("#pwForm").submit(function(a){a.preventDefault(),$("#pwError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?($("#dialog-msg #msg").text("Password changed"),$("#dialog-msg").dialog("open"),$("#dialog-pwChange").dialog("close")):a&&a.error?$("#pwError").text(a.error).show("slide",{direction:"up"}):$("#pwError").text("Unknown error").show("slide",{direction:"up"})})}),$("#dialog-usernameChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#usernameForm").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#usernameForm #username").html($("#dialog-options #username").html())},close:function(){$("#usernameForm [name='username']").val(""),$("#usernameError").text("").hide()}}),$("#usernameChange").click(function(){$("#dialog-usernameChange").dialog("open")}),$("#usernameForm").submit(function(a){a.preventDefault(),$("#usernameError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?($("#dialog-msg #msg").text("Username changed"),$("#dialog-msg").dialog("open"),$("#dialog-options #username").html(a.result),$("#dialog-usernameChange").dialog("close")):a&&a.error?$("#usernameError").text(a.error).show("slide",{direction:"up"}):$("#usernameError").text("Unknown error").show("slide",{direction:"up"})})}),$("#masks").on("change","input.selector:checked",function(){$(this).data("owner")?($("#maskControls #edit").removeAttr("disabled"),$("#maskControls #delete").removeAttr("disabled")):($("#maskControls #edit").attr("disabled","disabled"),$("#maskControls #delete").attr("disabled","disabled")),0!=$(this).val()&&0==$(this).val().split(".")[1]?$("#dialog-options #leave").removeAttr("disabled"):$("#dialog-options #leave").attr("disabled","disabled")}),$("#dialog-joinMask").dialog({autoOpen:!1,resizable:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){var a=$("#dialog-joinMask #results input:checked"),e=$("#dialog-joinMask #results input:checked+label");$.ajax({url:"masks.php",type:"POST",data:{mask:a.val(),mode:"join"},dataType:"JSON"}).done(function(o){o&&o.result&&(e.css("width",""),e.find(".info").remove(),e.append('<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>'),$("#dialog-options #masks #"+o.type+" input.selector:last").before(a).before(e),$("#dialog-joinMask").dialog("close"))})},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-joinMask form").submit(function(a){a.preventDefault(),$("#dialog-joinMask #results").html(""),$("#dialog-joinMask #loading").show(),$("#dialog-joinMask input[type='submit']").attr("disabled","disabled"),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).then(function(a){if(a&&a.results&&a.results.length)return tripwire.esi.fullLookup(a.eveIDs).done(function(e){if(e)for(var o in e){var i=a.results[o],t=$('<input type="radio" name="mask" id="mask'+i.mask+'" value="'+i.mask+'" class="selector" data-owner="false" data-admin="'+i.admin+'" /><label for="mask'+i.mask+'" style="width: 100%; margin-left: -5px;">\t<img src="'+i.img+'" />\t<span class="selector_label">'+i.label+'</span>\t<div class="info">\t\t'+e[o].name+"<br/>\t\t"+("character"==e[o].category?e[o].corporation.name+"<br/>":null)+"\t\t"+(e[o].alliance?e[o].alliance.name:"")+"<br/>\t</div></label>");$("#dialog-joinMask #results").append(t)}});a&&a.error?($("#dialog-error #msg").text(a.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))}).then(function(){$("#dialog-joinMask #loading").hide(),$("#dialog-joinMask input[type='submit']").removeAttr("disabled")})})},close:function(){$("#dialog-joinMask #results").html(""),$("#dialog-joinMask input[name='name']").val("")}}),$("#dialog-options #masks").on("click","input[name='find']+label",function(){$("#dialog-joinMask input[name='find']").val($(this).prev().val()),$("#dialog-joinMask").dialog("open")}),$("#dialog-options #masks").on("click",".closeIcon",function(){var a=$(this).closest("input.selector+label").prev();$("#dialog-confirm #msg").text("Are you sure you want to remove this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Remove:function(){var e={mode:"leave",mask:a.val()};$.ajax({url:"masks.php",type:"POST",data:e,dataType:"JSON"}).done(function(e){e&&e.result?(a.next().remove(),a.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#maskControls #delete").click(function(){var a=$("#masks input.selector:checked");$("#dialog-confirm #msg").text("Are you sure you want to delete this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Delete:function(){var e={mode:"delete",mask:a.val()};$.ajax({url:"masks.php",type:"POST",data:e,dataType:"JSON"}).done(function(e){e&&e.result?(a.next().remove(),a.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#dialog-createMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Create:function(){$("#dialog-createMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-createMask #accessList").on("click","#create_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-createMask form").submit(function(a){a.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?($.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(a){if(a&&a.masks){for(var e in $("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html(""),a.masks){var o=a.masks[e],i=$('<input type="radio" name="mask" id="mask'+e+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+e+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+a.masks[a.active].mask+"']").attr("checked",!0).trigger("change"),a.masks[a.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-createMask").dialog("close")):a&&a.error?($("#dialog-error #msg").text(a.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})}),$("#dialog-createMask select").selectmenu({width:100})},open:function(){$("#dialog-createMask input[name='name']").val(""),$("#dialog-createMask #accessList :not(.static)").remove()}}),$("#maskControls #create").click(function(){$("#dialog-createMask").dialog("open")}),$("#dialog-createMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().remove(),$(this).closest("label").remove()}),$("#dialog-editMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#dialog-editMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-editMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().attr("name","deletes[]").hide(),$(this).closest("label").hide()}),$("#dialog-editMask #accessList").on("click","#edit_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-editMask form").submit(function(a){a.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?$("#dialog-editMask").dialog("close"):a&&a.error?($("#dialog-error #msg").text(a.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})})},open:function(){var a=$("#dialog-options input[name='mask']:checked").val();$("#dialog-editMask input[name='mask']").val(a),$("#dialog-editMask #accessList label.static").hide(),$("#dialog-editMask #loading").show(),$("#dialog-editMask #name").text($("#dialog-options input[name='mask']:checked+label .selector_label").text()),$.ajax({url:"masks.php",type:"POST",data:{mode:"edit",mask:a},dataType:"JSON"}).then(function(a){if(a&&a.results&&a.results.length)return tripwire.esi.fullLookup(a.results).done(function(a){if(a)for(var e in a)if("character"==a[e].category){var o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+a[e].id+'_1373" value="'+a[e].id+'_1373" class="selector" /><label for="edit_'+a[e].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+a[e].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+a[e].corporation.name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}else if("corporation"==a[e].category){o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+a[e].id+'_2" value="'+a[e].id+'_2" class="selector" /><label for="edit_'+a[e].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+a[e].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}})}).then(function(a){$("#dialog-editMask #accessList label.static").show(),$("#dialog-editMask #loading").hide()})},close:function(){$("#dialog-editMask #accessList :not(.static)").remove()}}),$("#maskControls #edit").click(function(){$("#dialog-editMask").dialog("open")}),$("#dialog-EVEsearch").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){if($("#accessList input[value='"+$("#EVESearchResults input").val()+"']").length)return $("#dialog-error #msg").text("Already has access"),$("#dialog-error").dialog("open"),!1;$("#EVESearchResults .info").append('<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />'),$("#EVESearchResults input:checked").attr("checked","checked"),$("#EVESearchResults input:checked").attr("onclick","return false");var a=$("#EVESearchResults .maskNode:has(input:checked)");$("#dialog-createMask").dialog("isOpen")?$("#dialog-createMask #accessList .static:first").before(a):$("#dialog-editMask").dialog("isOpen")&&$("#dialog-editMask #accessList .static:first").before(a),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},create:function(){$("#EVEsearch").submit(function(a){if(a.preventDefault(),""==$("#EVEsearch input[name='name']").val())return!1;$("#EVESearchResults, #searchCount").html(""),$("#EVEsearch #searchSpinner").show(),$("#EVEsearch input[type='submit']").attr("disabled","disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").attr("disabled",!0).addClass("ui-state-disabled"),tripwire.esi.search($("#EVEsearch input[name='name']").val(),$("#EVEsearch input[name='category']:checked").val(),$("#EVEsearch input[name='exact']")[0].checked).done(function(a){if(a&&(a.character||a.corporation))return a=$.merge(a.character||[],a.corporation||[]),total=a.length,a=a.slice(0,10),tripwire.esi.fullLookup(a).done(function(a){if($("#EVEsearch #searchCount").html("Found: "+total+"<br/>Showing: "+(total<10?total:10)),a)for(var e in a)if("character"==a[e].category){var o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+a[e].id+'_1373" value="'+a[e].id+'_1373" class="selector" /><label for="find_'+a[e].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+a[e].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+a[e].corporation.name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}else if("corporation"==a[e].category){o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+a[e].id+'_2" value="'+a[e].id+'_2" class="selector" /><label for="find_'+a[e].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+a[e].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}}).always(function(){$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")});$("#dialog-error #msg").text("No Results"),$("#dialog-error").dialog("open"),$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")})})},close:function(){$("#EVEsearch input[name='name']").val(""),$("#EVESearchResults, #searchCount").html("")}})}}),$("#dialog-options").dialog("open")});
$("#dialog-ping").dialog({autoOpen:!1,height:"auto",dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Send:function(){var t={systemName:this.systemName,systemText:this.systemText,message:$("#ping-text").val()};const e=this;$.ajax({url:"ping.php",type:"POST",data:t,dataType:"text"}).done(function(t){$(e).dialog("close")}).fail(function(t,e,i){console.log(e,i)})},Cancel:function(){$(this).dialog("close")}},open:function(){const t=$(this).data("id"),e=$(this).data("systemID"),i=tripwire.client.wormholes[t],s=i?tripwire.client.signatures[i.initialID]:{name:null};this.systemName=tripwire.systems[e].name,this.systemText=this.systemName+(null!==s.name&&s.name.length?" ("+s.name+")":""),$("#dialog-ping").dialog("option","title","Ping about "+this.systemText),$("#ping-text").val(""),$("#ping-text").focus()}});
$("#signaturesWidget").on("click","#delete-signature",function(e){return e.preventDefault(),!$(this).closest("tr").attr("disabled")&&(0!=$("#sigTable tr.selected").length&&($("#dialog-sigEdit").hasClass("ui-dialog-content")&&$("#dialog-sigEdit").dialog("isOpen")?($("#dialog-sigEdit").parent().effect("shake",300),!1):void($("#dialog-deleteSig").hasClass("ui-dialog-content")?$("#dialog-deleteSig").dialog("isOpen")||$("#dialog-deleteSig").dialog("open"):$("#dialog-deleteSig").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("disable");var e={signatures:{remove:[]},systemID:viewingSystemID},i=[],t=$.map($("#sigTable tr.selected"),function(e){var t=tripwire.client.signatures[$(e).data("id")];if("wormhole"!=t.type)return i.push(t),t.id;var s=$.map(tripwire.client.wormholes,function(e){if(e.initialID==t.id||e.secondaryID==t.id)return e})[0];return i.push({wormhole:s,signatures:[tripwire.client.signatures[s.initialID],tripwire.client.signatures[s.secondaryID]]}),s});e.signatures.remove=t;tripwire.refresh("refresh",e,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#dialog-deleteSig").dialog("close"),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:i}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:i}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(e){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}},close:function(){$("#sigTable tr.selected").removeClass("selected")}}))))});
const sigDialog={},sigDialogVM={};sigDialog.openSignatureDialog=function(e){switch(e.preventDefault&&e.preventDefault(),sigDialogVM.mode=e.data.mode,sigDialogVM.mode){case"update":if("sig-row"==e.data.source)$("#sigTable tr.selected").removeClass("selected"),$(this).closest("tr").addClass("selected"),sigDialogVM.sigId=$(this).data("id");else if("edit-sig"==e.data.source){var i=$("#sigTable tbody tr.selected");if(1!==i.length)return!1;sigDialogVM.sigId=$(i[0]).data("id")}else sigDialogVM.sigId=e.data.signature;break;default:delete sigDialogVM.sigId}sigDialogVM.viewingSystemID=sigDialogVM.sigId?tripwire.client.signatures[sigDialogVM.sigId].systemID:viewingSystemID,sigDialogVM.viewingSystem=tripwire.systems[sigDialogVM.viewingSystemID],$("#dialog-signature").hasClass("ui-dialog-content")?$("#dialog-signature").dialog("isOpen")||$("#dialog-signature").dialog("open"):$("#dialog-signature").dialog({autoOpen:!0,resizable:!1,dialogClass:"dialog-noeffect ui-dialog-shadow",position:{my:"center",at:"center",of:$("#signaturesWidget")},buttons:{Save:function(){$("#form-signature").submit()},Add:function(){$("#form-signature").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){var e=Object.assign({},appData.wormholes,wormholeAnalysis.dummyWormholes,{K162:{}});function i(){return $("#dialog-signature .leadsTo:visible").val()}function t(e){return function(){const t=wormholeAnalysis.eligibleWormholeTypes(sigDialogVM.viewingSystemID,wormholeAnalysis.targetSystemID(i(),void 0));return e(t)}}$("#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']").selectmenu({width:100}),$("#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']").selectmenu({width:80}),$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete({source:tripwire.aSigSystems,renderer:"system",maxSize:10,delay:0}),$("#dialog-signature [data-autocomplete='sigTypeFrom']").inlinecomplete({source:e,renderer:function(e){return wormholeRendering.renderWormholeType(e,e.key,sigDialogVM.viewingSystem.name,i())},maxSize:10,delay:0,customDropdown:t(function(e){return e.from})}),$("#dialog-signature [data-autocomplete='sigTypeTo']").inlinecomplete({source:e,renderer:function(e){return wormholeRendering.renderWormholeType(e,e.key,i(),sigDialogVM.viewingSystem.name)},maxSize:10,delay:0,customDropdown:t(function(e){return e.to})}),$("#dialog-signature #durationPicker").durationPicker(),$("#dialog-signature #durationPicker").on("change",function(){this.value<0&&(this.value=0,$(this).change())}),$("#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']").on("input",function(){for(;!/^[a-zA-Z?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature [name='signatureID_Alpha']").on("input",function(){3===this.value.length&&$("#dialog-signature [name='signatureID_Numeric']").select()}),$("#dialog-signature [name='signatureID2_Alpha']").on("input",function(){3===this.value.length&&$("#dialog-signature [name='signatureID2_Numeric']").select()}),$("#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']").on("input",function(){for(;!/^[0-9?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature .signatureID, #dialog-signature .wormholeType").on("click",function(){$(this).select()}),$("#dialog-signature .wormholeType").on("input, change",function(){this.value.length>0&&-1!=e[this.value.toUpperCase()]&&"K162"!=this.value.toUpperCase()?($("#dialog-signature .wormholeType").not(this).val("K162"),appData.wormholes[this.value.toUpperCase()]&&$("#dialog-signature #durationPicker").val(60*appData.wormholes[this.value.toUpperCase()].life.substring(0,2)*60).change()):"K162"===this.value.toUpperCase()?(e[$("#dialog-signature .wormholeType").not(this).val().toUpperCase()]||"K162"===$("#dialog-signature .wormholeType").not(this).val().toUpperCase())&&$("#dialog-signature .wormholeType").not(this).val("????"):"????"==this.value&&$("#dialog-signature .wormholeType").not(this).val("K162")}),$("#dialog-signature").on("selectmenuchange","[name='signatureType']",function(){"wormhole"==this.value?($("#dialog-signature #site").slideUp(200,function(){$(this).hide(0)}),$("#dialog-signature #wormhole").slideDown(200,function(){$(this).show(200)})):($("#dialog-signature #site").slideDown(200,function(){$(this).show(200)}),$("#dialog-signature #wormhole").slideUp(200,function(){$(this).hide(0)})),ValidationTooltips.close()}),$("#form-signature").submit(function(i){i.preventDefault();var t=$(this).serializeObject(),a=!0;if(ValidationTooltips.close(),$.each($("#dialog-signature .signatureID:visible"),function(){if(this.value.length>0&&this.value.length<3)return ValidationTooltips.open({target:$(this)}).setContent("Must be 3 characters in length!"),$(this).select(),a=!1,!1}),!a)return!1;if(3===t.signatureID_Alpha.length&&3===t.signatureID_Numeric.length)for(var s in tripwire.client.signatures){const e=tripwire.client.signatures[s];if(e.id!=sigDialogVM.sigId&&e.signatureID==t.signatureID_Alpha.toLowerCase()+t.signatureID_Numeric&&e.systemID==sigDialogVM.viewingSystemID)return ValidationTooltips.open({target:$("#dialog-signature .signatureID:first")}).setContent("Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='"+s+"' />"),$("#overwrite").focus(),a=!1,!1}if(!a)return!1;if($.each($("#dialog-signature .wormholeType:visible"),function(){if(this.value.length>0&&!e[this.value.toUpperCase()]&&"????"!=this.value)return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid wormhole type!"),$(this).select(),a=!1,!1}),!a)return!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if(this.value.length>0&&-1==appData.genericSystemTypes.findIndex(e=>this.value.toLowerCase()===e.toLowerCase())&&!findSystemID(this.value))return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid leads to system!"),$(this).select(),a=!1,!1}),!a)return!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if(this.value.length>0&&this.value.toLowerCase()===sigDialogVM.viewingSystem.name.toLowerCase())return ValidationTooltips.open({target:$(this)}).setContent("Wormhole cannot lead to the same system it comes from!"),$(this).select(),a=!1,!1}),!a)return!1;var n={},r=[];if("wormhole"===t.signatureType){var o={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:sigDialogVM.viewingSystemID,type:"wormhole",name:t.wormholeName,lifeLength:t.signatureLength},l=wormholeAnalysis.targetSystemID(t.leadsTo,t.wormholeType),g={signatureID:t.signatureID2_Alpha+t.signatureID2_Numeric,systemID:l,type:"wormhole",name:t.wormholeName2,lifeLength:t.signatureLength},u=null,d=null;t.wormholeType.length>0&&e[t.wormholeType.toUpperCase()]&&"K162"!=t.wormholeType.toUpperCase()?(d="initial",u=t.wormholeType.toUpperCase()):t.wormholeType2.length>0&&e[t.wormholeType2.toUpperCase()]&&"K162"!=t.wormholeType2.toUpperCase()?(d="secondary",u=t.wormholeType2.toUpperCase()):"K162"==t.wormholeType.toUpperCase()?(d="secondary",u="????"):"K162"==t.wormholeType2.toUpperCase()&&(d="initial",u="????");var p={type:u,parent:d,life:t.wormholeLife,mass:t.wormholeMass};"update"==sigDialogVM.mode?(o.id=$("#dialog-signature").data("signatureid"),g.id=$("#dialog-signature").data("signature2id"),p.id=$("#dialog-signature").data("wormholeid"),tripwire.client.wormholes[p.id]&&(t.wormholeType.length>0&&e[t.wormholeType.toUpperCase()]&&"K162"!=t.wormholeType.toUpperCase()?(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"initial":"secondary",p.type=t.wormholeType.toUpperCase()):t.wormholeType2.length>0&&e[t.wormholeType2.toUpperCase()]&&"K162"!=t.wormholeType2.toUpperCase()?(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"secondary":"initial",p.type=t.wormholeType2.toUpperCase()):"K162"==t.wormholeType.toUpperCase()?(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"secondary":"initial",p.type="????"):"K162"==t.wormholeType2.toUpperCase()&&(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"initial":"secondary",p.type="????")),n={signatures:{update:[{wormhole:p,signatures:[o,g]}]}},tripwire.client.wormholes[p.id]?r.push({wormhole:tripwire.client.wormholes[p.id],signatures:[tripwire.client.signatures[o.id],tripwire.client.signatures[g.id]]}):r.push(tripwire.client.signatures[o.id])):n={signatures:{add:[{wormhole:p,signatures:[o,g]}]}}}else{if("update"==sigDialogVM.mode)if(n={signatures:{update:[o={id:$("#dialog-signature").data("signatureid"),signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:sigDialogVM.viewingSystemID,type:t.signatureType,name:t.signatureName,lifeLength:t.signatureLength}]}},"wormhole"==tripwire.client.signatures[o.id].type){p=$.map(tripwire.client.wormholes,function(e){if(e.initialID==o.id||e.secondaryID==o.id)return e})[0],g=o.id==p.initialID?tripwire.client.signatures[p.secondaryID]:tripwire.client.signatures[p.initialID];r.push({wormhole:tripwire.client.wormholes[p.id],signatures:[tripwire.client.signatures[o.id],tripwire.client.signatures[g.id]]})}else r.push(tripwire.client.signatures[o.id]);else n={signatures:{add:[o={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:sigDialogVM.viewingSystemID,type:t.signatureType,name:t.signatureName,lifeLength:t.signatureLength}]}}}$("#dialog-signature").parent().find(":button:contains('Save')").button("disable");tripwire.refresh("refresh",n,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#dialog-signature").dialog("close"),$("#undo").removeClass("disabled"),"add"==sigDialogVM.mode&&(r=e.results),sigDialogVM.viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[sigDialogVM.viewingSystemID].push({action:sigDialogVM.mode,signatures:r}):tripwire.signatures.undo[sigDialogVM.viewingSystemID]=[{action:sigDialogVM.mode,signatures:r}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(){$("#sigEditForm input[type=submit]").removeAttr("disabled"),$("#dialog-signature").parent().find(":button:contains('Save')").button("enable")})})},open:function(){$("#dialog-signature").data("signatureid",""),$("#dialog-signature").data("signature2id",""),$("#dialog-signature").data("wormholeid",""),$("#dialog-signature input").val(""),$("#dialog-signature [name='signatureType']").val("unknown").selectmenu("refresh"),$("#dialog-signature [name='wormholeLife']").val("stable").selectmenu("refresh"),$("#dialog-signature [name='wormholeMass']").val("stable").selectmenu("refresh"),$("#dialog-signature #site").show(),$("#dialog-signature #wormhole").hide(),$("#dialog-signature .sideLabel:first").html(sigDialogVM.viewingSystem.name+" Side"),$("#dialog-signature .sideLabel:last").html("Other Side"),$("#dialog-signature #durationPicker").val(60*options.signatures.pasteLife*60).change();var e=sigDialogVM.sigId;if("update"==sigDialogVM.mode&&e&&tripwire.client.signatures[e]){var i=tripwire.client.signatures[e];if($("#dialog-signature").data("signatureid",e),$("#dialog-signature").parent().find("button:contains('Add')").hide(),$("#dialog-signature").parent().find("button:contains('Save')").show(),$("#dialog-signature").dialog("option","title","Edit Signature"),"wormhole"==i.type){var t=$.map(tripwire.client.wormholes,function(i){if(i.initialID==e||i.secondaryID==e)return i})[0],a=e==t.initialID?tripwire.client.signatures[t.secondaryID]:tripwire.client.signatures[t.initialID];$("#dialog-signature").data("signature2id",a.id),$("#dialog-signature").data("wormholeid",t.id);const s=i.signatureID?i.signatureID.substr(0,3):"???";$("#dialog-signature input[name='signatureID_Alpha']").val(s),$("#dialog-signature input[name='signatureID_Numeric']").val(i.signatureID?i.signatureID.substr(3,5):""),$("#dialog-signature [name='signatureType']").val(i.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='wormholeName']").val(i.name),$("#dialog-signature [name='leadsTo']").val(tripwire.systems[a.systemID]?tripwire.systems[a.systemID].name:appData.genericSystemTypes[a.systemID]?appData.genericSystemTypes[a.systemID]:""),$("#dialog-signature input[name='signatureID2_Alpha']").val(a.signatureID?a.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID2_Numeric']").val(a.signatureID?a.signatureID.substr(3,5):""),$("#dialog-signature [name='wormholeName2']").val(a.name),$("#dialog-signature [name='wormholeLife']").val(t.life).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='wormholeMass']").val(t.mass).selectmenu("refresh").trigger("selectmenuchange"),t[t.parent+"ID"]==i.id?$("#dialog-signature input[name='wormholeType']").val(t.type).change():t[t.parent+"ID"]==a.id&&$("#dialog-signature input[name='wormholeType2']").val(t.type).change(),$("#dialog-signature #durationPicker").val(i.lifeLength).change(),"???"!=s?$("#dialog-signature input[name='wormholeName']").select():$("#dialog-signature input[name='signatureID_Alpha']").select()}else $("#dialog-signature input[name='signatureID_Alpha']").val(i.signatureID?i.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID_Numeric']").val(i.signatureID?i.signatureID.substr(3,5):""),$("#dialog-signature [name='signatureType']").val(i.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='signatureName']").val(i.name),$("#dialog-signature #durationPicker").val(i.lifeLength).change(),$("#dialog-signature input[name='signatureID_Alpha']").select()}else $("#dialog-signature").parent().find("button:contains('Add')").show(),$("#dialog-signature").parent().find("button:contains('Save')").hide(),$("#dialog-signature").dialog("option","title","Add Signature"),$("#dialog-signature [name='signatureType']").val(options.signatures.editType||"unknown").selectmenu("refresh"),"wormhole"===$("#dialog-signature [name='signatureType']").val()&&($("#dialog-signature #site").hide(),$("#dialog-signature #wormhole").show())},close:function(){ValidationTooltips.close(),$("#sigTable tr.selected").removeClass("selected"),$("#dialog-signature").data("signatureid",""),$("#dialog-signature").data("signature2id",""),$("#dialog-signature").data("wormholeid","")}})},$("#sigTable tbody").on("dblclick","tr",{mode:"update",source:"sig-row"},sigDialog.openSignatureDialog),$("#edit-signature").on("click",{mode:"update",source:"edit-sig"},sigDialog.openSignatureDialog),$("#add-signature").click({mode:"add"},sigDialog.openSignatureDialog),sigDialog.overwriteSignature=function(e,i,t){var a={signatures:{remove:[]},systemID:viewingSystemID},s=[],n=tripwire.client.signatures[e];if("wormhole"!=n.type)s.push(n),a.signatures.remove.push(n.id);else{var r=$.map(tripwire.client.wormholes,function(e){if(e.initialID==n.id||e.secondaryID==n.id)return e})[0];s.push({wormhole:r,signatures:[tripwire.client.signatures[r.initialID],tripwire.client.signatures[r.secondaryID]]}),a.signatures.remove.push(r)}tripwire.refresh("refresh",a,function(e){$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:s}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:s}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),i(e)},t)},sigDialog.delegateSave=function(e){e.resultSet&&1==e.resultSet[0].result&&(ValidationTooltips.close(),$("#dialog-signature").parent().find(":button:contains('Save')")?$("#dialog-signature").parent().find(":button:contains('Save')").click():$("#dialog-signature").parent().find(":button:contains('Add')").click())},$(document).on("click","#overwrite",function(){$("#overwrite").attr("disable",!0),sigDialog.overwriteSignature($(this).data("id"),sigDialog.delegateSave,function(){$("#overwrite").removeAttr("disable")})});
//# sourceMappingURL=app.min.js.map
